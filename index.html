<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S&P 500 Mozes Ranker</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#070c12; --surface:#0c1520; --surface2:#111d2b; --surface3:#162436;
  --border:#1d2e40; --border2:#243a50;
  --gold:#f5a623; --gold2:#ffbf3b;
  --cyan:#39c3ff; --green:#34d399; --red:#fb7185; --purple:#a78bfa;
  --text:#e5e7eb; --muted:#9aa4b2; --muted2:#7b8794;
  --shadow: 0 20px 60px rgba(0,0,0,.45);
  --radius:18px;
}
* { box-sizing:border-box; }
html,body { height:100%; }
body{
  margin:0;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: radial-gradient(1200px 700px at 20% 10%, rgba(245,166,35,.12), transparent 55%),
              radial-gradient(900px 600px at 80% 20%, rgba(57,195,255,.10), transparent 55%),
              radial-gradient(900px 700px at 50% 90%, rgba(167,139,250,.08), transparent 55%),
              var(--bg);
  color:var(--text);
}
a{color:inherit}
.wrap{
  max-width: 1320px;
  margin: 0 auto;
  padding: 28px 18px 40px;
}
.header{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:18px;
  margin-bottom:14px;
}
.brand h1{
  margin:0;
  font-size:28px;
  letter-spacing:-0.02em;
  font-weight:900;
}
.brand .sub{
  margin-top:4px;
  color:var(--muted);
  font-size:13px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.04);
  border:1px solid var(--border);
  color:var(--muted);
  font-size:12px;
}
.dot{
  width:8px;height:8px;border-radius:50%;
  background:var(--gold);
  box-shadow:0 0 0 3px rgba(245,166,35,.14);
}
.live-dot{
  width:8px;height:8px;border-radius:50%;
  background:var(--green);
  box-shadow:0 0 0 3px rgba(52,211,153,.14);
  display:inline-block;
  margin-inline-end:8px;
}
.header-right{
  display:flex;
  align-items:center;
  gap:10px;
}
.lang-toggle{
  display:flex;
  background:rgba(255,255,255,.04);
  border:1px solid var(--border);
  border-radius:12px;
  overflow:hidden;
}
.lang-toggle button{
  appearance:none;
  background:transparent;
  border:0;
  padding:8px 10px;
  color:var(--muted);
  font-weight:700;
  cursor:pointer;
  font-size:12px;
}
.lang-toggle button.active{
  background:rgba(245,166,35,.15);
  color:var(--gold2);
}
.card{
  background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
  border:1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
}
.stats{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:12px;
  padding:14px;
  margin: 14px 0;
}
.stat{
  padding:14px 14px 12px;
  border-radius:14px;
  background:rgba(0,0,0,.18);
  border:1px solid rgba(255,255,255,.06);
  min-height:84px;
}
.stat .label{
  color:var(--muted);
  font-size:12px;
  letter-spacing:.02em;
  margin-bottom:10px;
}
.stat .value{
  font-size:22px;
  font-weight:900;
  letter-spacing:-0.02em;
}
.stat .hint{
  margin-top:6px;
  color:var(--muted2);
  font-size:12px;
  font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
}
.controls{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:14px;
  flex-wrap:wrap;
}
.search{
  flex:1;
  min-width:260px;
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--border2);
  background:rgba(0,0,0,.20);
}
.search input{
  width:100%;
  background:transparent;
  border:0;
  outline:0;
  color:var(--text);
  font-size:14px;
}
.pills{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
}
.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.03);
  border:1px solid var(--border2);
  color:var(--muted);
  font-size:12px;
  cursor:pointer;
  user-select:none;
}
.pill.active{
  background:rgba(57,195,255,.12);
  border-color: rgba(57,195,255,.35);
  color: #cfefff;
}
.pill .mini{
  width:7px;height:7px;border-radius:50%;
  background:var(--cyan);
}
.btn{
  background:rgba(245,166,35,.12);
  border:1px solid rgba(245,166,35,.35);
  color:var(--gold2);
  padding:9px 12px;
  border-radius:12px;
  font-weight:800;
  cursor:pointer;
  font-size:12px;
}
.tablewrap{
  padding: 10px 12px 16px;
}
.table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  overflow:hidden;
  border-radius: 16px;
  border:1px solid rgba(255,255,255,.06);
}
.table thead th{
  position:sticky;
  top:0;
  z-index:5;
  background:rgba(8,14,22,.92);
  backdrop-filter: blur(10px);
  color:var(--muted);
  font-size:12px;
  text-align:left;
  padding:12px 10px;
  border-bottom:1px solid rgba(255,255,255,.06);
  cursor:pointer;
  white-space:nowrap;
}
.table tbody td{
  padding:12px 10px;
  border-bottom:1px solid rgba(255,255,255,.06);
  vertical-align:top;
}
.table tbody tr:hover td{
  background:rgba(255,255,255,.03);
}
.ticker{
  font-weight:900;
  letter-spacing:.02em;
}
.company{
  color:var(--muted);
  font-size:12px;
  margin-top:3px;
  max-width: 380px;
}
.score{
  font-family:"JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-weight:800;
  padding:6px 10px;
  border-radius:999px;
  display:inline-flex;
  align-items:center;
  gap:8px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.16);
}
.score .bar{
  width:60px;
  height:8px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  overflow:hidden;
}
.score .bar span{
  display:block;
  height:100%;
  width:50%;
  background: linear-gradient(90deg, rgba(57,195,255,.85), rgba(245,166,35,.9));
}
.kpi{
  font-family:"JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  color:#d8e6f5;
  font-weight:800;
  font-size:12px;
}
.muted{ color:var(--muted); }
.tag{
  display:inline-flex;
  padding:6px 9px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.03);
  color:var(--muted);
  font-size:12px;
  margin-right:6px;
}
.tag.good{ border-color: rgba(52,211,153,.35); background:rgba(52,211,153,.10); color:#baf7df; }
.tag.bad{ border-color: rgba(251,113,133,.35); background:rgba(251,113,133,.10); color:#ffd0d8; }
.detail{
  margin-top:8px;
  display:none;
  border-top:1px dashed rgba(255,255,255,.10);
  padding-top:10px;
}
.row-open .detail{ display:block; }
.detail-tabs{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom:10px;
}
.detail-tab{
  padding:7px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.03);
  color:var(--muted);
  font-size:12px;
  cursor:pointer;
  user-select:none;
}
.detail-tab.active{
  background:rgba(167,139,250,.12);
  border-color: rgba(167,139,250,.35);
  color:#efe9ff;
}
.grid{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:10px;
}
.kcard{
  padding:10px 10px 9px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.16);
}
.kcard .k{ color:var(--muted); font-size:11px; }
.kcard .v{ margin-top:6px; font-weight:900; font-size:15px; }
.kcard .s{ margin-top:4px; color:var(--muted2); font-size:11px; font-family:"JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
.pillars{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:10px;
}
.pillcard{
  padding:12px 12px 10px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.16);
}
.pillcard .head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  margin-bottom:10px;
}
.pillcard .name{ font-weight:900; font-size:12px; color:#dbe8f7; letter-spacing:.02em;}
.pillcard .num{ font-family:"JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-weight:900; }
.pillcard .bar{ height:9px; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden; }
.pillcard .bar span{ display:block; height:100%; width:50%; background: linear-gradient(90deg, rgba(52,211,153,.85), rgba(57,195,255,.85)); }
.pillcard .meta{ margin-top:8px; display:flex; justify-content:space-between; gap:10px; color:var(--muted2); font-size:11px; }
.tr-grid{ display:grid; grid-template-columns: repeat(3,1fr); gap:10px; }
.tr-card{
  padding:12px 12px 10px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.16);
}
.tr-card .t{ color:var(--muted); font-size:11px; }
.tr-card .v{ margin-top:8px; font-weight:900; font-size:16px; }
.tr-card .b{ margin-top:6px; height:8px; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden; }
.tr-card .b span{ display:block; height:100%; width:60%; background: linear-gradient(90deg, rgba(245,166,35,.9), rgba(57,195,255,.85)); }
.loading{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:14px;
  padding:60px 18px;
  text-align:center;
}
.spinner{
  width:48px;height:48px;border-radius:50%;
  border:4px solid rgba(255,255,255,.10);
  border-top-color: var(--gold);
  animation: spin 1s linear infinite;
}
@keyframes spin{ to{ transform: rotate(360deg);} }
.error{
  display:none;
  padding:18px;
  margin-top:14px;
  border-radius:16px;
  border:1px solid rgba(251,113,133,.35);
  background:rgba(251,113,133,.08);
  color:#ffd0d8;
}
.footer{
  margin-top:14px;
  color:var(--muted2);
  font-size:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}
.small{
  font-family:"JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
}
.view-tabs{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  padding: 0 14px 14px;
}
.view-tab{
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.03);
  color:var(--muted);
  font-size:12px;
  cursor:pointer;
  user-select:none;
}
.view-tab.active{
  background:rgba(52,211,153,.10);
  border-color: rgba(52,211,153,.30);
  color:#c7fbe4;
}
@media (max-width: 1080px){
  .stats{ grid-template-columns: repeat(2,1fr); }
  .grid{ grid-template-columns: repeat(2,1fr); }
  .pillars{ grid-template-columns: repeat(2,1fr); }
  .tr-grid{ grid-template-columns: 1fr; }
  .company{ max-width: 240px; }
}
@media (max-width: 560px){
  .stats{ grid-template-columns: 1fr; }
  .grid{ grid-template-columns: 1fr; }
  .pillars{ grid-template-columns: 1fr; }
}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="brand">
      <h1><span style="color:var(--gold)">S&P 500</span> Mozes Ranker</h1>
      <div class="sub">
        <span class="badge"><span class="dot"></span> v5.3 ‚Ä¢ 9-Pillar + Breakout Scanner</span>
        <span class="badge" id="lastUpdated"><span class="live-dot"></span></span>
      </div>
    </div>
    <div class="header-right">
      <div class="lang-toggle" dir="ltr">
        <button id="btnEn" class="active" onclick="setLang('en')">EN</button>
        <button id="btnHe" onclick="setLang('he')">◊¢◊ë◊®◊ô◊™</button>
      </div>
    </div>
  </div>

  <div id="loading" class="card loading">
    <div class="spinner"></div>
    <div style="font-weight:900;letter-spacing:-.01em;">LOADING MARKET DATA...</div>
    <div class="muted small">Fetching sp500_data.json</div>
  </div>

  <div id="error-msg" class="error card">
    <div style="font-weight:900; margin-bottom:8px;">Could not load market data.</div>
    <div class="muted">Open DevTools ‚Üí Console to see the exact error.</div>
  </div>

  <div id="statsBar" class="card stats" style="display:none">
    <div class="stat">
      <div class="label" id="statLabelRanked">Stocks Ranked</div>
      <div class="value" id="statCount">‚Äî</div>
      <div class="hint" id="statCountHint">stocks</div>
    </div>
    <div class="stat">
      <div class="label" id="statLabelAvg">Avg Composite</div>
      <div class="value" id="statAvg">‚Äî</div>
      <div class="hint small">0‚Äì100</div>
    </div>
    <div class="stat">
      <div class="label" id="statLabelTopSector">Top Sector</div>
      <div class="value" id="statTopSector">‚Äî</div>
      <div class="hint small">by composite</div>
    </div>
    <div class="stat">
      <div class="label" id="statLabelSS8">SmartScore ‚â• 8</div>
      <div class="value" id="statSS8">‚Äî</div>
      <div class="hint small">TipRanks coverage</div>
    </div>
  </div>

  <div id="controls" class="card controls" style="display:none">
    <div class="search">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:.7"><path d="M21 21l-4.3-4.3m1.8-5.2a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      <input id="q" placeholder="Search ticker or company‚Ä¶" oninput="applyFilters()"/>
    </div>
    <div class="pills">
      <div class="pill" id="pSS8" onclick="togglePill('ss8')"><span class="mini"></span><span id="pSS8Label">SmartScore ‚â• 8</span></div>
      <div class="pill" id="pBreakout" onclick="togglePill('breakout')"><span class="mini"></span><span id="pBreakoutLabel">Breakout only</span></div>
      <div class="pill" id="pTR" onclick="togglePill('tr')"><span class="mini"></span><span id="pTRLabel">TR Coverage</span></div>
      <button class="btn" onclick="resetAll()" id="btnReset">‚úï Reset</button>
    </div>
  </div>

  <div id="viewTabs" class="view-tabs" style="display:none">
    <div class="view-tab active" data-view="score" onclick="setView('score')" id="vtScore">üìä Score</div>
    <div class="view-tab" data-view="valuation" onclick="setView('valuation')" id="vtVal">üí∞ Valuation</div>
    <div class="view-tab" data-view="profitability" onclick="setView('profitability')" id="vtProf">üíπ Profitability</div>
    <div class="view-tab" data-view="growth" onclick="setView('growth')" id="vtGrowth">üöÄ Growth</div>
    <div class="view-tab" data-view="cashflow" onclick="setView('cashflow')" id="vtCF">üíµ Cash Flow</div>
    <div class="view-tab" data-view="health" onclick="setView('health')" id="vtHealth">üè¶ Balance Sheet</div>
    <div class="view-tab" data-view="momentum" onclick="setView('momentum')" id="vtMom">‚ö° Momentum</div>
    <div class="view-tab" data-view="analyst" onclick="setView('analyst')" id="vtAnalyst">üî≠ Analyst</div>
    <div class="view-tab" data-view="tipranks" onclick="setView('tipranks')" id="vtTR">üéØ TipRanks</div>
    <div class="view-tab" data-view="breakout" onclick="setView('breakout')" id="vtBreakout">‚ö° Breakout</div>
  </div>

  <div class="card tablewrap" style="margin-top:12px">
    <table class="table" id="tbl">
      <thead>
        <tr id="thead"></tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <div class="footer">
    <div class="muted">Data sources: yfinance + TipRanks (via pipeline)</div>
    <div class="muted small">Click a row to expand details ‚Ä¢ Sort by clicking headers</div>
  </div>
</div>

<script>
const T={en:{ranked:'Stocks Ranked',avg:'Avg Composite',topsec:'Top Sector',ss8:'SmartScore ‚â• 8',tr:'TR Coverage',stocks:'stocks',searchph:'Search ticker or company‚Ä¶',filters:'FILTERS',reset:'‚úï Reset',fcomposite:'Composite Score',fss:'SmartScore Min',fconsensus:'Consensus',fpe:'P/E Max',fperf:'12M Return Min %',fval:'Val. Score Min',loading:'LOADING MARKET DATA...',allsectors:'ALL SECTORS',topSectors:{'Information Technology':'Info Tech','Communication Services':'Comm Svcs','Consumer Discretionary':'Cons Disc','Consumer Staples':'Cons Staples','Health Care':'Health'},tabs:{score:'üìä Score',valuation:'üí∞ Valuation',profitability:'üíπ Profitability',growth:'üöÄ Growth',cashflow:'üíµ Cash Flow',health:'üè¶ Balance Sheet',momentum:'‚ö° Momentum',analyst:'üî≠ Analyst',tipranks:'üéØ TipRanks',breakout:'‚ö° Breakout'},dtabs:{overview:'Overview',pillars:'Pillars',valuation:'Valuation',tipranks:'TipRanks'},cols:{rank:'#',ticker:'Ticker',company:'Company',sector:'Sector',composite:'Composite',valuation:'Valuation',smartscore:'SmartScore',consensus:'Consensus',pe:'P/E',fwd_pe:'Fwd P/E',peg:'PEG',ps:'P/S',pb:'P/B',ev_ebitda:'EV/EBITDA',fcf_yield:'FCF Yield %',pt_upside:'PT Upside %',div_yield:'Div Yield %',pillar_prof:'Pillar',roe:'ROE %',roa:'ROA %',roic:'ROIC %',net_margin:'Net Margin %',gross_margin:'Gross Margin %',op_margin:'Op. Margin %',eq_score:'EQ Score',piotroski_f:'Piotroski F',pillar_growth:'Pillar',rev_growth:'Rev Growth %',eps_growth:'EPS Growth %',fcf_margin:'FCF Margin %',tr_asset_gr:'Asset Growth %',pillar_fcf:'FCF Pillar',fcf_to_ni:'FCF/NI',payout_ratio:'Payout %',pillar_health:'Health Pillar',current_ratio:'Current Ratio',debt_equity:'Debt/Equity',altman_z:'Altman Z',beta:'Beta',pillar_mom:'Mom. Pillar',perf_12m:'12M %',perf_6m:'6M %',perf_3m:'3M %',perf_1m:'1M %',momentum:'Composite Mom.',tr_mom_12m:'TR Tech Mom.',pillar_analyst:'Analyst Pillar',analyst_mean:'Yahoo Rating',analysts:'# Analysts',tr_consensus:'TR Consensus',tr_pt_upside:'TR PT Upside %',tr_smartscore:'SmartScore',tr_news_bull:'News Bull. %',tr_blogger_bull:'Blogger Bull. %',tr_insider:'Insider',tr_hedge:'Hedge Fund',tr_inv_chg_30d:'Inv. 30D %',tr_inv_chg_7d:'Inv. 7D %',breakout_score:'Breakout Score',breakout_rank:'Scan Rank',breakout_phase:'Phase',breakout_rr:'Risk/Reward',breakout_rs:'Rel. Strength',breakout_stop:'Stop Loss',has_vcp:'VCP Pattern',vcp_quality:'VCP Quality',breakout_entry:'Entry Quality',vs_sector:'vs Sector',coverage:'Coverage %',p_profitability:'Profitab.',p_growth:'Growth',p_eq:'EQ Qual.',p_fcf:'FCF',p_health:'Health',p_momentum:'Momentum',p_analyst:'Analyst',p_piotroski:'Piotroski'},tips:{composite:'Weighted average of all 9 pillars (10‚Äì100). Higher = better overall quality + value.',valuation:'How cheap vs expensive vs sector peers. 100 = deeply undervalued.',smartscore:'TipRanks SmartScore 1‚Äì10: AI aggregation of analyst, news, insider and hedge fund signals.',pe:'Price / Earnings (trailing 12M). Lower = potentially cheaper.',fwd_pe:'Forward P/E on next 12M EPS estimate.',peg:'PEG Ratio = P/E √∑ EPS Growth. Below 1 = potentially undervalued relative to growth.',ps:'Price / Sales. Useful for high-growth companies with low/no profits.',pb:'Price / Book Value. Below 1 = trading below asset value.',ev_ebitda:'Enterprise Value / EBITDA. Key metric for comparing companies across capital structures.',fcf_yield:'Free Cash Flow / Market Cap. Higher = more cash generated per dollar invested.',pt_upside:'Analyst price target vs current price. % upside potential.',div_yield:'Annual dividend / share price. Income return on investment.',pillar_prof:'Profitability Pillar (0‚Äì100): composite of ROE, ROA, ROIC, net/gross/operating margins.',p_profitability:'Profitability Pillar (0‚Äì100): composite of ROE, ROA, ROIC, net/gross/operating margins.',roe:'Return on Equity: net income / equity.',roa:'Return on Assets: net income / total assets.',roic:'Return on Invested Capital: NOPAT / (equity + debt ‚àí cash).',net_margin:'Net income / revenue. % of each dollar of revenue that ends as profit.',gross_margin:'Gross profit / revenue. Efficiency of core production.',op_margin:'Operating income / revenue. Efficiency before interest & taxes.',eq_score:'Earnings Quality Score: measures sustainability of reported earnings (accruals, cash conversion).',piotroski_f:'Piotroski F-Score (0‚Äì9): 9 binary signals for financial strength. ‚â•7 = strong, ‚â§2 = weak.',pillar_growth:'Growth Pillar (0‚Äì100): composite of revenue growth, EPS growth, FCF margin, asset growth.',p_growth:'Growth Pillar (0‚Äì100): composite of revenue growth, EPS growth, FCF margin, asset growth.',rev_growth:'Year-over-year revenue growth.',eps_growth:'Year-over-year EPS (earnings per share) growth.',fcf_margin:'Free Cash Flow / Revenue. % of revenue converted to free cash.',tr_asset_gr:'Asset growth rate. Rapid asset growth can dilute returns.',pillar_fcf:'FCF Pillar (0‚Äì100): measures free cash flow yield, margin, conversion ratio, and dividend sustainability.',p_fcf:'FCF Pillar (0‚Äì100): measures free cash flow yield, margin, conversion ratio, and dividend sustainability.',fcf_to_ni:'FCF / Net Income. Ratio > 1 = earnings backed by real cash. < 0.5 = low quality earnings.',payout_ratio:'Dividends / Earnings. High payout limits reinvestment; negative = paying dividend at a loss.',pillar_health:'Balance Sheet Pillar (0‚Äì100): current ratio, debt/equity, Altman Z-Score.',p_health:'Balance Sheet Pillar (0‚Äì100): current ratio, debt/equity, Altman Z-Score.',current_ratio:'Current Assets / Current Liabilities. > 1.5 = healthy short-term liquidity.',debt_equity:'Total Debt / Equity. Higher = more leveraged. Industry-dependent.',altman_z:'Altman Z-Score: > 3 = safe, 1.8‚Äì3 = grey zone, < 1.8 = financial distress.',beta:'Price volatility vs S&P 500. > 1 = amplified moves (more risk & reward).',pillar_mom:'Momentum Pillar (0‚Äì100): composite of 12/6/3/1M returns vs sector peers.',p_momentum:'Momentum Pillar (0‚Äì100): composite of 12/6/3/1M returns vs sector peers.',perf_12m:'12-month price return. Strongest predictor in momentum factor investing.',perf_6m:'6-month price return.',perf_3m:'3-month price return.',perf_1m:'1-month price return. Short-term momentum indicator.',momentum:'Composite momentum: weighted average of 12M/6M/3M/1M returns.',tr_mom_12m:'TipRanks technical momentum score (12-month).',pillar_analyst:'Analyst Pillar (0‚Äì100): analyst rating, # of analysts, price target upside, TR consensus.',p_analyst:'Analyst Pillar (0‚Äì100): analyst rating, # of analysts, price target upside, TR consensus.',analyst_mean:'Yahoo Finance analyst mean rating. 1=Strong Buy, 3=Hold, 5=Strong Sell.',analysts:'Number of Wall Street analysts covering this stock.',tr_consensus:'TipRanks analyst consensus: Strong Buy / Buy / Hold / Sell.',tr_pt_upside:'TipRanks price target implied upside from current price.',tr_smartscore:'TipRanks SmartScore 1‚Äì10: AI aggregation of analyst, news, insider and hedge fund signals.',tr_news_bull:'% of recent news articles with bullish sentiment.',tr_blogger_bull:'% of financial bloggers with bullish outlook.',tr_insider:'Insider trading direction: Positive = buying, Negative = selling.',tr_hedge:'Hedge fund activity trend.',tr_inv_chg_30d:'Change in institutional investor holdings over 30 days.',tr_inv_chg_7d:'Change in institutional investor holdings over 7 days.',breakout_score:'Breakout Score (0‚Äì110): Minervini Trend Template score. Measures Stage 2 uptrend strength, RS momentum, volume, and fundamentals.',breakout_rank:'Rank among all breakout candidates in the scan.',breakout_phase:'Market stage: 1=Base, 2=Uptrend (buy zone), 3=Distribution (sell zone), 4=Downtrend.',breakout_rr:'Risk/Reward ratio. Minimum 2:1 required for inclusion. Higher = better setup.',breakout_rs:'Relative Strength vs SPY (63-day slope). > 1 = outperforming market.',breakout_stop:'Calculated stop loss price (ATR-based or swing low). Risk is managed to max 10%.',has_vcp:'VCP = Volatility Contraction Pattern (Minervini). Series of tighter contractions = institutional accumulation.',vcp_quality:'VCP quality score (0‚Äì100). Higher = tighter contractions, better setup.',breakout_entry:'Entry quality assessment: Ideal / Good / OK.',p_eq:'Earnings Quality Pillar (0‚Äì100): measures reliability and sustainability of reported earnings.',p_piotroski:'Piotroski F-Score Pillar (0‚Äì100): based on 9-point financial health score.',vs_sector:'Composite score minus the sector median. Positive = outperforming peers.',coverage:'Data completeness: % of the 17 core metrics available from data sources.'},detailLabels:{Price:'Price',MktCap:'Mkt Cap',AltmanZ:'Altman Z',PiotroskiF:'Piotroski F',DivYield:'Div Yield',vsSector:'vs Sector',Beta:'Beta',Analysts:'# Analysts',SmartScore:'SmartScore',Consensus:'TR Consensus',TRUpside:'TR PT Upside',Coverage:'Coverage'},sectors:{'Information Technology':'IT','Health Care':'Health','Financials':'Financials','Consumer Discretionary':'Cons D','Communication Services':'Comm','Industrials':'Industrials','Consumer Staples':'Cons S','Energy':'Energy','Real Estate':'Real Est.','Materials':'Materials','Utilities':'Utilities'},pillarNames:{VALUATION:'VALUATION',PROFITAB:'PROFITAB.',GROWTH:'GROWTH',EQ_QUAL:'EQ QUAL',FCF:'FCF',HEALTH:'HEALTH',MOMENTUM:'MOMENTUM',ANALYST:'ANALYST',PIOTROSKI:'PIOTROSKI'}},he:{ranked:'◊û◊†◊ô◊ï◊™ ◊û◊ì◊ï◊®◊í◊ï◊™',avg:'◊¶◊ô◊ï◊ü ◊û◊û◊ï◊¶◊¢',topsec:'◊°◊ß◊ò◊ï◊® ◊û◊ï◊ë◊ô◊ú',ss8:'◊¶◊ô◊ï◊ü ◊ó◊õ◊ù ‚â• 8',tr:'◊õ◊ô◊°◊ï◊ô TipRanks',stocks:'◊û◊†◊ô◊ï◊™',searchph:'◊ó◊§◊© ◊ò◊ô◊ß◊® ◊ê◊ï ◊ó◊ë◊®◊î‚Ä¶',filters:'◊§◊ô◊ú◊ò◊®◊ô◊ù',reset:'‚úï ◊ê◊ô◊§◊ï◊°',fcomposite:'◊¶◊ô◊ï◊ü ◊ß◊ï◊û◊§◊ï◊ñ◊ô◊ò',fss:'◊¶◊ô◊ï◊ü ◊ó◊õ◊ù ◊û◊ô◊†.',fconsensus:'◊ß◊ï◊†◊¶◊†◊ñ◊ï◊°',fpe:'P/E ◊û◊ß◊°◊ô◊û◊ï◊ù',fperf:'◊™◊©◊ï◊ê◊î 12M ◊û◊ô◊†. %',fval:'◊¶◊ô◊ï◊ü ◊©◊ï◊ï◊ô ◊û◊ô◊†.',loading:'◊ò◊ï◊¢◊ü ◊†◊™◊ï◊†◊ô ◊©◊ï◊ß...',allsectors:'◊õ◊ú ◊î◊°◊ß◊ò◊ï◊®◊ô◊ù',topSectors:{'Information Technology':'◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊î','Communication Services':'◊™◊ß◊©◊ï◊®◊™','Consumer Discretionary':'◊¶◊®◊ô◊õ◊î ◊û◊ó◊ñ◊ï◊®◊ô◊™','Consumer Staples':'◊¶◊®◊ô◊õ◊î ◊ë◊°◊ô◊°◊ô◊™','Health Care':'◊ë◊®◊ô◊ê◊ï◊™'},tabs:{score:'üìä ◊¶◊ô◊ï◊ü',valuation:'üí∞ ◊©◊ï◊ï◊ô',profitability:'üíπ ◊®◊ï◊ï◊ó◊ô◊ï◊™',growth:'üöÄ ◊¶◊û◊ô◊ó◊î',cashflow:'üíµ ◊™◊ñ◊®◊ô◊ù',health:'üè¶ ◊û◊ê◊ñ◊ü',momentum:'‚ö° ◊û◊ï◊û◊†◊ò◊ï◊ù',analyst:'üî≠ ◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù',tipranks:'üéØ TipRanks',breakout:'‚ö° ◊§◊®◊ô◊¶◊î'},dtabs:{overview:'◊°◊ß◊ô◊®◊î',pillars:'◊§◊ô◊ú◊®◊ô◊ù',valuation:'◊©◊ï◊ï◊ô',tipranks:'TipRanks'},cols:{rank:'#',ticker:'◊ò◊ô◊ß◊®',company:'◊ó◊ë◊®◊î',sector:'◊°◊ß◊ò◊ï◊®',composite:'◊¶◊ô◊ï◊ü ◊ß◊ï◊û◊§◊ï◊ñ◊ô◊ò',valuation:'◊©◊ï◊ï◊ô',smartscore:'◊¶◊ô◊ï◊ü ◊ó◊õ◊ù',consensus:'◊ß◊ï◊†◊¶◊†◊ñ◊ï◊°',pe:'P/E',fwd_pe:'P/E ◊¢◊™◊ô◊ì◊ô',peg:'PEG',ps:'P/S',pb:'P/B',ev_ebitda:'EV/EBITDA',fcf_yield:'◊™◊©◊ï◊ê◊™ FCF %',pt_upside:'◊ô◊¢◊ì ◊û◊ó◊ô◊® %',div_yield:'◊™◊©◊ï◊ê◊™ ◊ì◊ô◊ë. %',pillar_prof:'◊§◊ô◊ú◊®',roe:'ROE %',roa:'ROA %',roic:'ROIC %',net_margin:'◊û◊®◊í◊≥◊ô◊ü ◊†◊ò◊ï %',gross_margin:'◊û◊®◊í◊≥◊ô◊ü ◊í◊ï◊ú◊û◊ô %',op_margin:'◊û◊®◊í◊≥◊ô◊ü ◊™◊§◊¢◊ï◊ú◊ô %',eq_score:'◊ê◊ô◊õ◊ï◊™ ◊®◊ï◊ï◊ó',piotroski_f:'Piotroski F',pillar_growth:'◊§◊ô◊ú◊®',rev_growth:'◊¶◊û◊ô◊ó◊™ ◊î◊õ◊†◊°◊ï◊™ %',eps_growth:'◊¶◊û◊ô◊ó◊™ EPS %',fcf_margin:'◊û◊®◊í◊≥◊ô◊ü FCF %',tr_asset_gr:'◊¶◊û◊ô◊ó◊™ ◊†◊õ◊°◊ô◊ù %',pillar_fcf:'◊§◊ô◊ú◊® FCF',fcf_to_ni:'FCF/◊®◊ï◊ï◊ó',payout_ratio:'◊ô◊ó◊° ◊ó◊ú◊ï◊ß◊î %',pillar_health:'◊§◊ô◊ú◊® ◊ë◊®◊ô◊ê◊ï◊™',current_ratio:'◊ô◊ó◊° ◊©◊ï◊ò◊£',debt_equity:'◊ó◊ï◊ë/◊î◊ï◊ü',altman_z:'Altman Z',beta:'◊ë◊ò◊ê',pillar_mom:'◊§◊ô◊ú◊® ◊û◊ï◊û◊†◊ò◊ï◊ù',perf_12m:'12M %',perf_6m:'6M %',perf_3m:'3M %',perf_1m:'1M %',momentum:'◊û◊ï◊û◊†◊ò◊ï◊ù ◊û◊©◊ï◊ß◊ú◊ú',tr_mom_12m:'◊û◊ï◊û◊†◊ò◊ï◊ù TR',pillar_analyst:'◊§◊ô◊ú◊® ◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù',analyst_mean:'◊ì◊ô◊®◊ï◊í Yahoo',analysts:'◊û◊°◊≥ ◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù',tr_consensus:'◊ß◊ï◊†◊¶◊†◊ñ◊ï◊° TR',tr_pt_upside:'◊ô◊¢◊ì TR %',tr_smartscore:'◊¶◊ô◊ï◊ü ◊ó◊õ◊ù',tr_news_bull:'◊ó◊ì◊©◊ï◊™ ◊ó◊ô◊ï◊ë◊ô◊ï◊™ %',tr_blogger_bull:'◊ë◊ú◊ï◊í◊®◊ô◊ù ◊ó◊ô◊ï◊ë◊ô◊ô◊ù %',tr_insider:'◊û◊°◊ó◊® ◊§◊†◊ô◊ù',tr_hedge:'◊ß◊®◊†◊ï◊™ ◊í◊ô◊ì◊ï◊®',tr_inv_chg_30d:'◊û◊ï◊°◊ì◊ô 30◊ô %',tr_inv_chg_7d:'◊û◊ï◊°◊ì◊ô 7◊ô %',breakout_score:'◊¶◊ô◊ï◊ü ◊§◊®◊ô◊¶◊î',breakout_rank:'◊ì◊ô◊®◊ï◊í ◊°◊ß◊ê◊†◊®',breakout_phase:'◊§◊ê◊ñ◊î',breakout_rr:'◊°◊ô◊õ◊ï◊ô/◊°◊ô◊õ◊ï◊ü',breakout_rs:'◊ó◊ï◊ñ◊ß ◊ô◊ó◊°◊ô',breakout_stop:'◊°◊ò◊ï◊§ ◊ú◊ï◊°',has_vcp:'◊ì◊§◊ï◊° VCP',vcp_quality:'◊ê◊ô◊õ◊ï◊™ VCP',breakout_entry:'◊ê◊ô◊õ◊ï◊™ ◊õ◊†◊ô◊°◊î',vs_sector:'◊û◊ï◊ú ◊°◊ß◊ò◊ï◊®',coverage:'◊õ◊ô◊°◊ï◊ô ◊†◊™◊ï◊†◊ô◊ù %',p_profitability:'◊®◊ï◊ï◊ó◊ô◊ï◊™',p_growth:'◊¶◊û◊ô◊ó◊î',p_eq:'◊ê◊ô◊õ◊ï◊™ ◊®◊ï◊ï◊ó',p_fcf:'FCF',p_health:'◊ë◊®◊ô◊ê◊ï◊™',p_momentum:'◊û◊ï◊û◊†◊ò◊ï◊ù',p_analyst:'◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù',p_piotroski:'Piotroski'},tips:{composite:'◊û◊û◊ï◊¶◊¢ ◊û◊©◊ï◊ß◊ú◊ú ◊©◊ú 9 ◊§◊ô◊ú◊®◊ô◊ù (10‚Äì100). ◊í◊ë◊ï◊î ◊ô◊ï◊™◊® = ◊ê◊ô◊õ◊ï◊™ ◊ï◊¢◊®◊ö ◊õ◊ï◊ú◊ú◊ô◊ù ◊ò◊ï◊ë◊ô◊ù ◊ô◊ï◊™◊®.',valuation:'◊¢◊ì ◊õ◊û◊î ◊î◊û◊†◊ô◊î ◊ñ◊ï◊ú◊î ◊ë◊ô◊ó◊° ◊ú◊¢◊û◊ô◊™◊ô ◊î◊°◊ß◊ò◊ï◊®. 100 = ◊ñ◊ï◊ú◊î ◊û◊ê◊ï◊ì.',smartscore:'◊¶◊ô◊ï◊ü ◊ó◊õ◊ù ◊©◊ú TipRanks 1‚Äì10: ◊ê◊í◊®◊í◊¶◊ô◊î ◊©◊ú ◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù, ◊ó◊ì◊©◊ï◊™, ◊û◊°◊ó◊® ◊§◊†◊ô◊ù ◊ï◊ß◊®◊†◊ï◊™ ◊í◊ô◊ì◊ï◊®.',pe:'◊û◊ó◊ô◊® / ◊®◊ï◊ï◊ó (12 ◊ó◊ï◊ì◊©◊ô◊ù ◊ê◊ó◊®◊ï◊†◊ô◊ù). ◊†◊û◊ï◊ö ◊ô◊ï◊™◊® = ◊§◊ï◊ò◊†◊¶◊ô◊ê◊ú◊ô◊™ ◊ñ◊ï◊ú ◊ô◊ï◊™◊®.',fwd_pe:'P/E ◊¢◊™◊ô◊ì◊ô ◊ú◊§◊ô ◊™◊ó◊ñ◊ô◊™ EPS ◊ú◊©◊†◊î ◊î◊ë◊ê◊î.',peg:'◊ô◊ó◊° PEG = P/E ◊ó◊ú◊ß◊ô ◊¶◊û◊ô◊ó◊™ EPS. ◊û◊™◊ó◊™ ◊ú-1 = ◊§◊ï◊ò◊†◊¶◊ô◊ê◊ú◊ô◊™ ◊ñ◊ï◊ú ◊ë◊ô◊ó◊° ◊ú◊¶◊û◊ô◊ó◊î.',ps:'◊û◊ó◊ô◊® / ◊û◊õ◊ô◊®◊ï◊™. ◊©◊ô◊û◊ï◊©◊ô ◊ú◊ó◊ë◊®◊ï◊™ ◊¶◊û◊ô◊ó◊î ◊¢◊ù ◊®◊ï◊ï◊ó◊ô◊ù ◊†◊û◊ï◊õ◊ô◊ù.',pb:'◊û◊ó◊ô◊® / ◊¢◊®◊ö ◊°◊§◊®◊ô◊ù. ◊û◊™◊ó◊™ ◊ú-1 = ◊†◊°◊ó◊® ◊û◊™◊ó◊™ ◊ú◊©◊ï◊ï◊ô ◊î◊†◊õ◊°◊ô◊ù.',ev_ebitda:'EV/EBITDA - ◊û◊ì◊ì ◊û◊®◊õ◊ñ◊ô ◊ú◊î◊©◊ï◊ï◊ê◊™ ◊ó◊ë◊®◊ï◊™ ◊ú◊ú◊ê ◊™◊ú◊ï◊™ ◊ë◊û◊ë◊†◊î ◊î◊î◊ï◊ü.',fcf_yield:'◊™◊ñ◊®◊ô◊ù ◊û◊ñ◊ï◊û◊†◊ô◊ù ◊ó◊ï◊§◊©◊ô / ◊©◊ï◊ï◊ô ◊©◊ï◊ß. ◊í◊ë◊ï◊î ◊ô◊ï◊™◊® = ◊ô◊ï◊™◊® ◊û◊ñ◊ï◊û◊ü ◊ú◊õ◊ú ◊©◊ß◊ú ◊î◊©◊ß◊¢◊î.',pt_upside:'◊ô◊¢◊ì ◊û◊ó◊ô◊® ◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù ◊ú◊¢◊ï◊û◊™ ◊î◊û◊ó◊ô◊® ◊î◊†◊ï◊õ◊ó◊ô. % ◊§◊ï◊ò◊†◊¶◊ô◊ê◊ú ◊¢◊ú◊ô◊ô◊î.',div_yield:'◊ì◊ô◊ë◊ô◊ì◊†◊ì ◊©◊†◊™◊ô / ◊û◊ó◊ô◊® ◊î◊û◊†◊ô◊î. ◊™◊©◊ï◊ê◊™ ◊î◊õ◊†◊°◊î ◊¢◊ú ◊î◊î◊©◊ß◊¢◊î.',pillar_prof:'◊§◊ô◊ú◊® ◊®◊ï◊ï◊ó◊ô◊ï◊™ (0‚Äì100): ROE, ROA, ROIC, ◊û◊®◊í◊≥◊ô◊†◊ô◊ù ◊©◊ï◊†◊ô◊ù.',p_profitability:'◊§◊ô◊ú◊® ◊®◊ï◊ï◊ó◊ô◊ï◊™ (0‚Äì100): ROE, ROA, ROIC, ◊û◊®◊í◊≥◊ô◊†◊ô◊ù ◊©◊ï◊†◊ô◊ù.',roe:'◊™◊©◊ï◊ê◊î ◊¢◊ú ◊î◊î◊ï◊ü: ◊®◊ï◊ï◊ó ◊†◊ß◊ô / ◊î◊ï◊ü ◊¢◊¶◊û◊ô.',roa:'◊™◊©◊ï◊ê◊î ◊¢◊ú ◊î◊†◊õ◊°◊ô◊ù: ◊®◊ï◊ï◊ó ◊†◊ß◊ô / ◊°◊ö ◊†◊õ◊°◊ô◊ù.',roic:'◊™◊©◊ï◊ê◊î ◊¢◊ú ◊î◊î◊ï◊ü ◊î◊û◊ï◊©◊ß◊¢: NOPAT / (◊î◊ï◊ü + ◊ó◊ï◊ë - ◊û◊ñ◊ï◊û◊ü).',net_margin:'◊®◊ï◊ï◊ó ◊†◊ß◊ô / ◊î◊õ◊†◊°◊ï◊™. % ◊û◊õ◊ú ◊©◊ß◊ú ◊î◊õ◊†◊°◊ï◊™ ◊©◊†◊î◊§◊ö ◊ú◊®◊ï◊ï◊ó.',gross_margin:'◊®◊ï◊ï◊ó ◊í◊ï◊ú◊û◊ô / ◊î◊õ◊†◊°◊ï◊™. ◊ô◊¢◊ô◊ú◊ï◊™ ◊î◊ô◊ô◊¶◊ï◊® ◊î◊ë◊°◊ô◊°◊ô◊™.',op_margin:'◊®◊ï◊ï◊ó ◊™◊§◊¢◊ï◊ú◊ô / ◊î◊õ◊†◊°◊ï◊™. ◊ô◊¢◊ô◊ú◊ï◊™ ◊ú◊§◊†◊ô ◊®◊ô◊ë◊ô◊™ ◊ï◊û◊°◊ô◊ù.',eq_score:'◊¶◊ô◊ï◊ü ◊ê◊ô◊õ◊ï◊™ ◊®◊ï◊ï◊ó◊ô◊ù: ◊û◊ï◊ì◊ì ◊¢◊ì ◊õ◊û◊î ◊î◊®◊ï◊ï◊ó◊ô◊ù ◊î◊û◊ì◊ï◊ï◊ó◊ô◊ù ◊û◊í◊ï◊ë◊ô◊ù ◊ë◊û◊ñ◊ï◊û◊ü ◊ê◊û◊ô◊™◊ô.',piotroski_f:'Piotroski F-Score (0‚Äì9): 9 ◊ê◊ô◊†◊ì◊ô◊ß◊ò◊ï◊®◊ô◊ù ◊ë◊ô◊†◊ê◊®◊ô◊ô◊ù ◊ú◊ë◊®◊ô◊ê◊ï◊™ ◊§◊ô◊†◊†◊°◊ô◊™. ‚â•7 = ◊ó◊ñ◊ß, ‚â§2 = ◊ó◊ú◊©.',pillar_growth:'◊§◊ô◊ú◊® ◊¶◊û◊ô◊ó◊î (0‚Äì100): ◊¶◊û◊ô◊ó◊™ ◊î◊õ◊†◊°◊ï◊™, EPS, FCF ◊ï◊†◊õ◊°◊ô◊ù.',p_growth:'◊§◊ô◊ú◊® ◊¶◊û◊ô◊ó◊î (0‚Äì100): ◊¶◊û◊ô◊ó◊™ ◊î◊õ◊†◊°◊ï◊™, EPS, FCF ◊ï◊†◊õ◊°◊ô◊ù.',rev_growth:'◊¶◊û◊ô◊ó◊™ ◊î◊õ◊†◊°◊ï◊™ ◊©◊†◊î ◊¢◊ú ◊©◊†◊î.',eps_growth:'◊¶◊û◊ô◊ó◊™ EPS (◊®◊ï◊ï◊ó ◊ú◊û◊†◊ô◊î) ◊©◊†◊î ◊¢◊ú ◊©◊†◊î.',fcf_margin:'FCF / ◊î◊õ◊†◊°◊ï◊™. % ◊û◊î◊î◊õ◊†◊°◊ï◊™ ◊©◊û◊ï◊û◊® ◊ú◊™◊ñ◊®◊ô◊ù ◊ó◊ï◊§◊©◊ô.',tr_asset_gr:'◊ß◊¶◊ë ◊¶◊û◊ô◊ó◊™ ◊†◊õ◊°◊ô◊ù. ◊¶◊û◊ô◊ó◊î ◊û◊î◊ô◊®◊î ◊û◊ì◊ô ◊¢◊ú◊ï◊ú◊î ◊ú◊ì◊ú◊ú ◊™◊©◊ï◊ê◊ï◊™.',pillar_fcf:'◊§◊ô◊ú◊® FCF (0‚Äì100): ◊™◊©◊ï◊ê◊™ FCF, ◊û◊®◊í◊≥◊ô◊ü FCF, ◊ô◊ó◊° ◊î◊û◊®◊î ◊ï◊ô◊¶◊ô◊ë◊ï◊™ ◊ì◊ô◊ë◊ô◊ì◊†◊ì.',p_fcf:'◊§◊ô◊ú◊® FCF (0‚Äì100): ◊™◊©◊ï◊ê◊™ FCF, ◊û◊®◊í◊≥◊ô◊ü FCF, ◊ô◊ó◊° ◊î◊û◊®◊î ◊ï◊ô◊¶◊ô◊ë◊ï◊™ ◊ì◊ô◊ë◊ô◊ì◊†◊ì.',fcf_to_ni:'FCF / ◊®◊ï◊ï◊ó ◊†◊ß◊ô. > 1 = ◊®◊ï◊ï◊ó◊ô◊ù ◊û◊í◊ï◊ë◊ô◊ù ◊ë◊û◊ñ◊ï◊û◊ü. < 0.5 = ◊ê◊ô◊õ◊ï◊™ ◊®◊ï◊ï◊ó◊ô◊ù ◊†◊û◊ï◊õ◊î.',payout_ratio:'◊ì◊ô◊ë◊ô◊ì◊†◊ì◊ô◊ù / ◊®◊ï◊ï◊ó◊ô◊ù. ◊í◊ë◊ï◊î ◊û◊ì◊ô = ◊§◊ó◊ï◊™ ◊î◊©◊ß◊¢◊î ◊ó◊ï◊ñ◊®◊™ ◊ë◊¢◊°◊ß.',pillar_health:'◊§◊ô◊ú◊® ◊û◊ê◊ñ◊ü (0‚Äì100): ◊ô◊ó◊° ◊©◊ï◊ò◊£, ◊ó◊ï◊ë/◊î◊ï◊ü, Altman Z-Score.',p_health:'◊§◊ô◊ú◊® ◊û◊ê◊ñ◊ü (0‚Äì100): ◊ô◊ó◊° ◊©◊ï◊ò◊£, ◊ó◊ï◊ë/◊î◊ï◊ü, Altman Z-Score.',current_ratio:'◊†◊õ◊°◊ô◊ù ◊©◊ï◊ò◊§◊ô◊ù / ◊î◊™◊ó◊ô◊ô◊ë◊ï◊ô◊ï◊™ ◊©◊ï◊ò◊§◊ï◊™. > 1.5 = ◊†◊ñ◊ô◊ú◊ï◊™ ◊ë◊®◊ô◊ê◊î ◊ú◊ò◊ï◊ï◊ó ◊ß◊¶◊®.',debt_equity:'◊ó◊ï◊ë ◊õ◊ï◊ú◊ú / ◊î◊ï◊ü ◊¢◊¶◊û◊ô. ◊í◊ë◊ï◊î ◊ô◊ï◊™◊® = ◊û◊û◊ï◊†◊£ ◊ô◊ï◊™◊®. ◊™◊ú◊ï◊ô ◊ë◊¢◊†◊£.',altman_z:'Altman Z-Score: > 3 = ◊ë◊ò◊ï◊ó, 1.8‚Äì3 = ◊ê◊ñ◊ï◊® ◊ê◊§◊ï◊®, < 1.8 = ◊û◊¶◊ï◊ß◊î ◊§◊ô◊†◊†◊°◊ô◊™.',beta:'◊™◊†◊ï◊ì◊™◊ô◊ï◊™ ◊ë◊ô◊ó◊° ◊ú-S&P 500. > 1 = ◊™◊†◊ï◊¢◊ï◊™ ◊û◊ï◊í◊ë◊®◊ï◊™ (◊ô◊ï◊™◊® ◊°◊ô◊õ◊ï◊ü ◊ï◊™◊©◊ï◊ê◊î).',pillar_mom:'◊§◊ô◊ú◊® ◊û◊ï◊û◊†◊ò◊ï◊ù (0‚Äì100): ◊™◊©◊ï◊ê◊ï◊™ 12/6/3/1 ◊ó◊ï◊ì◊©◊ô◊ù ◊ú◊¢◊ï◊û◊™ ◊¢◊û◊ô◊™◊ô ◊î◊°◊ß◊ò◊ï◊®.',p_momentum:'◊§◊ô◊ú◊® ◊û◊ï◊û◊†◊ò◊ï◊ù (0‚Äì100): ◊™◊©◊ï◊ê◊ï◊™ 12/6/3/1 ◊ó◊ï◊ì◊©◊ô◊ù ◊ú◊¢◊ï◊û◊™ ◊¢◊û◊ô◊™◊ô ◊î◊°◊ß◊ò◊ï◊®.',perf_12m:'◊™◊©◊ï◊ê◊™ ◊û◊ó◊ô◊® ◊ú-12 ◊ó◊ï◊ì◊©◊ô◊ù. ◊î◊í◊ï◊®◊ù ◊î◊û◊†◊ë◊ê ◊î◊ó◊ñ◊ß ◊ë◊ô◊ï◊™◊® ◊ë◊î◊©◊ß◊¢◊™ ◊û◊ï◊û◊†◊ò◊ï◊ù.',perf_6m:'◊™◊©◊ï◊ê◊™ ◊û◊ó◊ô◊® ◊ú-6 ◊ó◊ï◊ì◊©◊ô◊ù.',perf_3m:'◊™◊©◊ï◊ê◊™ ◊û◊ó◊ô◊® ◊ú-3 ◊ó◊ï◊ì◊©◊ô◊ù.',perf_1m:'◊™◊©◊ï◊ê◊™ ◊û◊ó◊ô◊® ◊ú-1 ◊ó◊ï◊ì◊©.',momentum:'◊û◊ï◊û◊†◊ò◊ï◊ù ◊û◊©◊ï◊ß◊ú◊ú: ◊û◊û◊ï◊¶◊¢ ◊©◊ú ◊™◊©◊ï◊ê◊ï◊™ 12M/6M/3M/1M.',tr_mom_12m:'◊¶◊ô◊ï◊ü ◊û◊ï◊û◊†◊ò◊ï◊ù ◊ò◊õ◊†◊ô ◊©◊ú TipRanks (12 ◊ó◊ï◊ì◊©◊ô◊ù).',pillar_analyst:'◊§◊ô◊ú◊® ◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù (0‚Äì100): ◊ì◊ô◊®◊ï◊í, ◊û◊°◊§◊® ◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù, ◊ô◊¢◊ì ◊û◊ó◊ô◊®, ◊ß◊ï◊†◊¶◊†◊ñ◊ï◊° TR.',p_analyst:'◊§◊ô◊ú◊® ◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù (0‚Äì100): ◊ì◊ô◊®◊ï◊í, ◊û◊°◊§◊® ◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù, ◊ô◊¢◊ì ◊û◊ó◊ô◊®, ◊ß◊ï◊†◊¶◊†◊ñ◊ï◊° TR.',analyst_mean:'◊ì◊ô◊®◊ï◊í ◊û◊û◊ï◊¶◊¢ Yahoo Finance. 1=◊ß◊†◊ô◊ô◊î ◊ó◊ñ◊ß◊î, 3=◊î◊ó◊ñ◊ß◊î, 5=◊û◊õ◊ô◊®◊î ◊ó◊ñ◊ß◊î.',analysts:'◊û◊°◊§◊® ◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù ◊©◊ú ◊ï◊ï◊ú ◊°◊ò◊®◊ô◊ò ◊î◊û◊õ◊°◊ô◊ù ◊û◊†◊ô◊î ◊ñ◊ï.',tr_consensus:'◊ß◊ï◊†◊¶◊†◊ñ◊ï◊° TipRanks: Strong Buy / Buy / Hold / Sell.',tr_pt_upside:'◊ô◊¢◊ì ◊û◊ó◊ô◊® TipRanks - % ◊¢◊ú◊ô◊ô◊î ◊§◊ï◊ò◊†◊¶◊ô◊ê◊ú◊ô◊™ ◊û◊î◊û◊ó◊ô◊® ◊î◊†◊ï◊õ◊ó◊ô.',tr_smartscore:'SmartScore ◊©◊ú TipRanks 1‚Äì10: ◊¶◊ô◊ï◊ü AI ◊î◊û◊©◊ú◊ë ◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù, ◊ó◊ì◊©◊ï◊™ ◊ï◊û◊ï◊°◊ì◊ô◊ô◊ù.',tr_news_bull:'% ◊õ◊™◊ë◊ï◊™ ◊ó◊ì◊©◊ï◊™ ◊ê◊ó◊®◊ï◊†◊ï◊™ ◊¢◊ù ◊°◊†◊ò◊ô◊û◊†◊ò ◊ó◊ô◊ï◊ë◊ô.',tr_blogger_bull:'% ◊ë◊ú◊ï◊í◊®◊ô◊ù ◊§◊ô◊†◊†◊°◊ô◊ô◊ù ◊¢◊ù ◊™◊ó◊ñ◊ô◊™ ◊ó◊ô◊ï◊ë◊ô◊™.',tr_insider:'◊õ◊ô◊ï◊ï◊ü ◊û◊°◊ó◊® ◊§◊†◊ô◊ù: ◊ó◊ô◊ï◊ë◊ô = ◊ß◊†◊ô◊ô◊î, ◊©◊ú◊ô◊ú◊ô = ◊û◊õ◊ô◊®◊î.',tr_hedge:'◊û◊í◊û◊™ ◊§◊¢◊ô◊ú◊ï◊™ ◊ß◊®◊†◊ï◊™ ◊í◊ô◊ì◊ï◊®.',tr_inv_chg_30d:'◊©◊ô◊†◊ï◊ô ◊ë◊î◊ó◊ñ◊ß◊ï◊™ ◊û◊©◊ß◊ô◊¢◊ô◊ù ◊û◊ï◊°◊ì◊ô◊ô◊ù ◊ë-30 ◊ô◊û◊ô◊ù.',tr_inv_chg_7d:'◊©◊ô◊†◊ï◊ô ◊ë◊î◊ó◊ñ◊ß◊ï◊™ ◊û◊©◊ß◊ô◊¢◊ô◊ù ◊û◊ï◊°◊ì◊ô◊ô◊ù ◊ë-7 ◊ô◊û◊ô◊ù.',breakout_score:'◊¶◊ô◊ï◊ü ◊§◊®◊ô◊¶◊î (0‚Äì110): ◊¶◊ô◊ï◊ü Trend Template ◊©◊ú ◊û◊ô◊†◊®◊ë◊ô◊†◊ô. ◊û◊ï◊ì◊ì ◊ó◊ï◊ñ◊ß Stage 2, ◊û◊ï◊û◊†◊ò◊ï◊ù RS ◊ï◊§◊†◊ì◊û◊†◊ò◊ú◊°.',breakout_rank:'◊ì◊ô◊®◊ï◊í ◊ë◊ô◊ü ◊õ◊ú ◊û◊ï◊¢◊û◊ì◊ô ◊î◊§◊®◊ô◊¶◊î ◊ë◊°◊®◊ô◊ß◊î.',breakout_phase:'◊©◊ú◊ë ◊©◊ï◊ß: 1=◊ë◊°◊ô◊°, 2=◊¢◊ú◊ô◊ô◊î (◊ñ◊ï◊ü ◊ß◊†◊ô◊ô◊î), 3=◊ó◊ú◊ï◊ß◊î (◊ñ◊ï◊ü ◊û◊õ◊ô◊®◊î), 4=◊ô◊®◊ô◊ì◊î.',breakout_rr:'◊ô◊ó◊° ◊°◊ô◊õ◊ï◊ô/◊°◊ô◊õ◊ï◊ü. ◊û◊ô◊†◊ô◊û◊ï◊ù 2:1 ◊†◊ì◊®◊© ◊ú◊î◊õ◊ú◊ú◊î. ◊í◊ë◊ï◊î ◊ô◊ï◊™◊® = ◊°◊ò◊ê◊§ ◊ò◊ï◊ë ◊ô◊ï◊™◊®.',breakout_rs:'◊ó◊ï◊ñ◊ß ◊ô◊ó◊°◊ô ◊û◊ï◊ú SPY (◊©◊ô◊§◊ï◊¢ 63 ◊ô◊ï◊ù). > 1 = ◊û◊ï◊ë◊ô◊ú ◊ê◊™ ◊î◊©◊ï◊ß.',breakout_stop:'◊û◊ó◊ô◊® ◊°◊ò◊ï◊§ ◊ú◊ï◊° ◊û◊ó◊ï◊©◊ë (ATR ◊ê◊ï ◊©◊§◊ú ◊™◊†◊ï◊§◊î). ◊î◊°◊ô◊õ◊ï◊ü ◊û◊ï◊í◊ë◊ú ◊ú◊û◊ß◊°◊ô◊û◊ï◊ù 10%.',has_vcp:'VCP = Volatility Contraction Pattern (◊û◊ô◊†◊®◊ë◊ô◊†◊ô). ◊°◊ì◊®◊™ ◊î◊™◊õ◊ï◊ï◊¶◊ï◊ô◊ï◊™ ◊û◊î◊ì◊ß◊ï◊™ = ◊¶◊ë◊ô◊®◊î ◊û◊ï◊°◊ì◊ô◊™.',vcp_quality:'◊¶◊ô◊ï◊ü ◊ê◊ô◊õ◊ï◊™ VCP (0‚Äì100). ◊í◊ë◊ï◊î ◊ô◊ï◊™◊® = ◊î◊™◊õ◊ï◊ï◊¶◊ï◊ô◊ï◊™ ◊î◊ì◊ï◊ß◊ï◊™ ◊ô◊ï◊™◊®, ◊°◊ò◊ê◊§ ◊ò◊ï◊ë ◊ô◊ï◊™◊®.',breakout_entry:'◊î◊¢◊®◊õ◊™ ◊ê◊ô◊õ◊ï◊™ ◊î◊õ◊†◊ô◊°◊î: Ideal / Good / OK.',p_eq:'◊§◊ô◊ú◊® ◊ê◊ô◊õ◊ï◊™ ◊®◊ï◊ï◊ó◊ô◊ù (0‚Äì100): ◊û◊ï◊ì◊ì ◊ê◊û◊ô◊†◊ï◊™ ◊ï◊ô◊¶◊ô◊ë◊ï◊™ ◊î◊®◊ï◊ï◊ó◊ô◊ù ◊î◊û◊ì◊ï◊ï◊ó◊ô◊ù.',p_piotroski:'◊§◊ô◊ú◊® Piotroski (0‚Äì100): ◊û◊ë◊ï◊°◊° ◊¢◊ú ◊¶◊ô◊ï◊ü ◊ë◊®◊ô◊ê◊ï◊™ ◊§◊ô◊†◊†◊°◊ô◊™ ◊û-9 ◊†◊ß◊ï◊ì◊ï◊™.',vs_sector:'◊¶◊ô◊ï◊ü ◊ß◊ï◊û◊§◊ï◊ñ◊ô◊ò ◊§◊ó◊ï◊™ ◊î◊ó◊¶◊ô◊ï◊ü ◊©◊ú ◊î◊°◊ß◊ò◊ï◊®. ◊ó◊ô◊ï◊ë◊ô = ◊û◊ï◊ë◊ô◊ú ◊ê◊™ ◊î◊¢◊û◊ô◊™◊ô◊ù.',coverage:'◊©◊ú◊û◊ï◊™ ◊†◊™◊ï◊†◊ô◊ù: % ◊û◊û◊ì◊ì◊ô ◊î◊ú◊ô◊ë◊î ◊î◊ñ◊û◊ô◊†◊ô◊ù ◊û◊û◊ß◊ï◊®◊ï◊™ ◊î◊†◊™◊ï◊†◊ô◊ù.'}},detailLabels:{Price:'◊û◊ó◊ô◊®',MktCap:'◊©◊ï◊ï◊ô ◊©◊ï◊ß',AltmanZ:'Altman Z',PiotroskiF:'Piotroski F',DivYield:'◊™◊©◊ï◊ê◊™ ◊ì◊ô◊ë.',vsSector:'◊û◊ï◊ú ◊°◊ß◊ò◊ï◊®',Beta:'◊ë◊ò◊ê',Analysts:'◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù',SmartScore:'◊¶◊ô◊ï◊ü ◊ó◊õ◊ù',Consensus:'◊ß◊ï◊†◊¶◊†◊ñ◊ï◊° TR',TRUpside:'◊ô◊¢◊ì TR',Coverage:'◊õ◊ô◊°◊ï◊ô'},sectors:{'Information Technology':'◊ò◊õ◊†◊ï◊ú◊ï◊í◊ô◊î','Health Care':'◊ë◊®◊ô◊ê◊ï◊™','Financials':'◊§◊ô◊†◊†◊°◊ô◊ù','Consumer Discretionary':'◊¶◊®◊ô◊õ◊î ◊û◊ó◊ñ◊ï◊®◊ô◊™','Communication Services':'◊™◊ß◊©◊ï◊®◊™','Industrials':'◊™◊¢◊©◊ô◊ô◊î','Consumer Staples':'◊¶◊®◊ô◊õ◊î ◊ë◊°◊ô◊°◊ô◊™','Energy':'◊ê◊†◊®◊í◊ô◊î','Real Estate':'◊†◊ì◊ú"◊ü','Materials':'◊ó◊ï◊û◊®◊ô◊ù','Utilities':'◊™◊©◊™◊ô◊ï◊™'},pillarNames:{VALUATION:'◊©◊ï◊ï◊ô',PROFITAB:'◊®◊ï◊ï◊ó◊ô◊ï◊™',GROWTH:'◊¶◊û◊ô◊ó◊î',EQ_QUAL:'◊ê◊ô◊õ◊ï◊™ ◊®◊ï◊ï◊ó',FCF:'FCF',HEALTH:'◊ë◊®◊ô◊ê◊ï◊™',MOMENTUM:'◊û◊ï◊û◊†◊ò◊ï◊ù',ANALYST:'◊ê◊†◊ú◊ô◊°◊ò◊ô◊ù',PIOTROSKI:'Piotroski'}}};

let lang='en';
let allData=[];
let view='score';
let sortKey='composite';
let sortDir='desc';
let pills={ss8:false, breakout:false, tr:false};

function setLang(l){
  lang=l;
  document.getElementById('btnEn').classList.toggle('active', l==='en');
  document.getElementById('btnHe').classList.toggle('active', l==='he');
  document.documentElement.lang = l==='he' ? 'he' : 'en';
  document.body.dir = l==='he' ? 'rtl' : 'ltr';
  applyI18n();
  render();
}
function tc(k){
  const map=(T[lang]||T.en);
  return map[k]||(T.en)[k]||k;
}
function tcol(k){
  return ((T[lang]||T.en).cols||T.en.cols)[k]||(T.en.cols)[k]||k;
}
function ttip(k){
  return ((T[lang]||T.en).tips||T.en.tips)[k]||(T.en.tips)[k]||'';
}
function ttab(k){
  return ((T[lang]||T.en).tabs||T.en.tabs)[k]||(T.en.tabs)[k]||k;
}
function tdtab(k){
  return ((T[lang]||T.en).dtabs||T.en.dtabs)[k]||(T.en.dtabs)[k]||k;
}
function tpillar(k){
  return ((T[lang]||T.en).pillarNames||T.en.pillarNames)[k]||(T.en.pillarNames)[k]||k;
}

function applyI18n(){
  document.getElementById('statLabelRanked').textContent=tc('ranked');
  document.getElementById('statLabelAvg').textContent=tc('avg');
  document.getElementById('statLabelTopSector').textContent=tc('topsec');
  document.getElementById('statLabelSS8').textContent=tc('ss8');
  document.getElementById('statCountHint').textContent=tc('stocks');
  document.getElementById('q').placeholder=tc('searchph');
  document.getElementById('btnReset').textContent=tc('reset');
  document.getElementById('pSS8Label').textContent=tc('ss8');
  document.getElementById('pTRLabel').textContent=tc('tr');
  document.getElementById('vtScore').textContent=ttab('score');
  document.getElementById('vtVal').textContent=ttab('valuation');
  document.getElementById('vtProf').textContent=ttab('profitability');
  document.getElementById('vtGrowth').textContent=ttab('growth');
  document.getElementById('vtCF').textContent=ttab('cashflow');
  document.getElementById('vtHealth').textContent=ttab('health');
  document.getElementById('vtMom').textContent=ttab('momentum');
  document.getElementById('vtAnalyst').textContent=ttab('analyst');
  document.getElementById('vtTR').textContent=ttab('tipranks');
  document.getElementById('vtBreakout').textContent=ttab('breakout');
}

function setView(v){
  view=v;
  document.querySelectorAll('.view-tab').forEach(t=>t.classList.toggle('active', t.dataset.view===v));
  render();
}

function togglePill(k){
  pills[k]=!pills[k];
  document.getElementById(k==='ss8'?'pSS8':k==='breakout'?'pBreakout':'pTR').classList.toggle('active', pills[k]);
  applyFilters();
}
function resetAll(){
  pills={ss8:false, breakout:false, tr:false};
  document.getElementById('pSS8').classList.remove('active');
  document.getElementById('pBreakout').classList.remove('active');
  document.getElementById('pTR').classList.remove('active');
  document.getElementById('q').value='';
  sortKey='composite'; sortDir='desc';
  render();
}

function fmt(n, digits=1){
  if(n===null||n===undefined||Number.isNaN(n)) return '‚Äî';
  const x=Number(n);
  if(!Number.isFinite(x)) return '‚Äî';
  return x.toFixed(digits);
}
function fmtInt(n){
  if(n===null||n===undefined||Number.isNaN(n)) return '‚Äî';
  const x=Number(n);
  if(!Number.isFinite(x)) return '‚Äî';
  return Math.round(x).toString();
}
function pct(n, digits=1){
  if(n===null||n===undefined||Number.isNaN(n)) return '‚Äî';
  const x=Number(n);
  if(!Number.isFinite(x)) return '‚Äî';
  return (x).toFixed(digits)+'%';
}
function money(n){
  if(n===null||n===undefined||Number.isNaN(n)) return '‚Äî';
  const x=Number(n);
  if(!Number.isFinite(x)) return '‚Äî';
  const abs=Math.abs(x);
  if(abs>=1e12) return (x/1e12).toFixed(2)+'T';
  if(abs>=1e9) return (x/1e9).toFixed(2)+'B';
  if(abs>=1e6) return (x/1e6).toFixed(2)+'M';
  if(abs>=1e3) return (x/1e3).toFixed(2)+'K';
  return x.toFixed(0);
}

let percentiles={};
function buildPercentiles(data){
  const keys=['composite','valuation','momentum','p_profitability','p_growth','p_eq','p_fcf','p_health','p_momentum','p_analyst','p_piotroski','smartscore'];
  keys.forEach(k=>{
    const arr=data.map(d=>Number(d[k])).filter(v=>Number.isFinite(v)).sort((a,b)=>a-b);
    percentiles[k]=arr;
  });
}
function quantileOf(k, val){
  const arr=percentiles[k]||[];
  if(!arr.length || !Number.isFinite(val)) return null;
  let lo=0, hi=arr.length-1;
  while(lo<hi){
    const mid=Math.floor((lo+hi)/2);
    if(arr[mid] < val) lo=mid+1; else hi=mid;
  }
  return (lo/(arr.length-1))*100;
}
function colorForPercentile(p){
  if(p===null) return {bg:'rgba(255,255,255,.06)', fg:'#cbd5e1'};
  if(p>=90) return {bg:'rgba(52,211,153,.12)', fg:'#baf7df'};
  if(p>=70) return {bg:'rgba(57,195,255,.12)', fg:'#cfefff'};
  if(p>=50) return {bg:'rgba(245,166,35,.10)', fg:'#ffe0ad'};
  if(p>=30) return {bg:'rgba(251,113,133,.10)', fg:'#ffd0d8'};
  return {bg:'rgba(251,113,133,.16)', fg:'#ffe3e8'};
}

function updateStats(data){
  document.getElementById('statCount').textContent = data.length.toString();
  const avg = data.reduce((a,b)=>a+(b.composite||0),0) / Math.max(1,data.length);
  document.getElementById('statAvg').textContent = fmt(avg,1);
  const ss8 = data.filter(d=>Number(d.tr_smartscore||d.smartscore||0) >= 8).length;
  document.getElementById('statSS8').textContent = ss8.toString();
}
function updateTopSector(){
  const secMap={};
  allData.forEach(d=>{
    if(!secMap[d.sector]) secMap[d.sector]=[];
    secMap[d.sector].push(d.composite||0);
  });
  const topSec=Object.entries(secMap)
    .map(([s,v])=>[s, v.reduce((a,b)=>a+b,0)/v.length])
    .sort((a,b)=>b[1]-a[1])[0]?.[0] || '‚Äî';
  const topMap=(T[lang]||T.en).topSectors||T.en.topSectors;
  document.getElementById('statTopSector').textContent = topMap[topSec]||topSec;
}

let filtered=[];
function applyFilters(){
  const q=(document.getElementById('q').value||'').trim().toLowerCase();
  filtered=allData.filter(d=>{
    if(q){
      const t=(d.ticker||'').toLowerCase();
      const c=(d.company||'').toLowerCase();
      if(!t.includes(q) && !c.includes(q)) return false;
    }
    if(pills.ss8){
      const ss=Number(d.tr_smartscore||d.smartscore);
      if(!(Number.isFinite(ss) && ss>=8)) return false;
    }
    if(pills.tr){
      const cov=Number(d.coverage);
      if(!(Number.isFinite(cov) && cov>0)) return false;
    }
    if(pills.breakout){
      const b=Number(d.breakout_score);
      if(!(Number.isFinite(b) && b>0)) return false;
    }
    return true;
  });
  render();
}

function setSort(k){
  if(sortKey===k){
    sortDir = (sortDir==='desc') ? 'asc' : 'desc';
  }else{
    sortKey=k;
    sortDir='desc';
  }
  render();
}

function sortData(data){
  const dir = sortDir==='desc' ? -1 : 1;
  return [...data].sort((a,b)=>{
    const av = a[sortKey]; const bv=b[sortKey];
    const an = Number(av); const bn=Number(bv);
    if(Number.isFinite(an) && Number.isFinite(bn)) return (an-bn)*dir;
    const as = (av??'').toString(); const bs=(bv??'').toString();
    return as.localeCompare(bs)*dir;
  });
}

function buildHeader(cols){
  const tr=document.getElementById('thead');
  tr.innerHTML='';
  cols.forEach(c=>{
    const th=document.createElement('th');
    th.textContent=tcol(c);
    th.title=ttip(c);
    th.onclick=()=>setSort(c);
    tr.appendChild(th);
  });
}

function rowHtml(d, idx){
  const p = quantileOf('composite', Number(d.composite));
  const sc = colorForPercentile(p);
  const barW = Math.max(0, Math.min(100, (Number(d.composite)||0)));
  const ss = Number(d.tr_smartscore||d.smartscore);
  const hasSS = Number.isFinite(ss);
  const ssTag = hasSS ? `<span class="tag ${ss>=8?'good':'bad'}">SS ${ss}</span>` : '';
  const trTag = (Number(d.coverage||0)>0) ? `<span class="tag good">TR</span>` : '';
  const bo = Number(d.breakout_score);
  const boTag = (Number.isFinite(bo)&&bo>0) ? `<span class="tag good">BO</span>` : '';

  const detail = detailHtml(d);

  return `<tr class="r" data-i="${idx}">
    <td class="kpi">${idx+1}</td>
    <td>
      <div class="ticker">${d.ticker||'‚Äî'}</div>
      <div class="company">${d.company||''}</div>
      <div style="margin-top:8px">${ssTag}${trTag}${boTag}</div>
      ${detail}
    </td>
    <td class="muted">${d.sector||'‚Äî'}</td>
    <td>
      <span class="score" title="${fmt(p,0)}th percentile">
        <span style="font-variant-numeric:tabular-nums; color:${sc.fg}">${fmt(d.composite,1)}</span>
        <span class="bar"><span style="width:${barW}%; background:linear-gradient(90deg, rgba(57,195,255,.85), rgba(245,166,35,.9))"></span></span>
      </span>
    </td>
    <td class="kpi">${fmt(d.valuation,0)}</td>
    <td class="kpi">${hasSS?ss:'‚Äî'}</td>
    <td class="muted">${d.tr_consensus||d.consensus||'‚Äî'}</td>
    <td class="kpi">${fmt(d.pe,1)}</td>
    <td class="kpi">${pct(d.perf_12m,1)}</td>
    <td class="kpi">${fmt(d.breakout_score,0)}</td>
  </tr>`;
}

function detailHtml(d){
  const ticker=d.ticker||'';
  const dtabs=`
    <div class="detail-tabs" id="dtabs-${ticker}">
      <div class="detail-tab active" data-dtab="overview" onclick="switchDetailTab('${ticker}','overview')">${tdtab('overview')}</div>
      <div class="detail-tab" data-dtab="pillars" onclick="switchDetailTab('${ticker}','pillars')">${tdtab('pillars')}</div>
      <div class="detail-tab" data-dtab="valuation" onclick="switchDetailTab('${ticker}','valuation')">${tdtab('valuation')}</div>
      <div class="detail-tab" data-dtab="tipranks" onclick="switchDetailTab('${ticker}','tipranks')">${tdtab('tipranks')}</div>
    </div>`;
  const price=fmt(d.price,2);
  const mcap=money(d.market_cap);
  const beta=fmt(d.beta,2);
  const z=fmt(d.altman_z,2);
  const f=fmt(d.piotroski_f,0);
  const dy=pct(d.div_yield,2);
  const vs=fmt(d.vs_sector,1);
  const cov=pct(d.coverage,0);

  const overview=`
    <div class="grid">
      <div class="kcard"><div class="k">${(T[lang]||T.en).detailLabels?.Price||'Price'}</div><div class="v">${price}</div><div class="s">USD</div></div>
      <div class="kcard"><div class="k">${(T[lang]||T.en).detailLabels?.MktCap||'Mkt Cap'}</div><div class="v">${mcap}</div><div class="s">USD</div></div>
      <div class="kcard"><div class="k">${(T[lang]||T.en).detailLabels?.Beta||'Beta'}</div><div class="v">${beta}</div><div class="s">volatility</div></div>
      <div class="kcard"><div class="k">${(T[lang]||T.en).detailLabels?.vsSector||'vs Sector'}</div><div class="v">${vs}</div><div class="s">median</div></div>
      <div class="kcard"><div class="k">${(T[lang]||T.en).detailLabels?.AltmanZ||'Altman Z'}</div><div class="v">${z}</div><div class="s">health</div></div>
      <div class="kcard"><div class="k">${(T[lang]||T.en).detailLabels?.PiotroskiF||'Piotroski F'}</div><div class="v">${f}</div><div class="s">0‚Äì9</div></div>
      <div class="kcard"><div class="k">${(T[lang]||T.en).detailLabels?.DivYield||'Div Yield'}</div><div class="v">${dy}</div><div class="s">income</div></div>
      <div class="kcard"><div class="k">${(T[lang]||T.en).detailLabels?.Coverage||'Coverage'}</div><div class="v">${cov}</div><div class="s">data</div></div>
    </div>`;

  const pillars = `
    <div class="pillars">
      ${pillCard('VALUATION', d.p_valuation ?? d.valuation, 'valuation')}
      ${pillCard('PROFITAB', d.p_profitability, 'p_profitability')}
      ${pillCard('GROWTH', d.p_growth, 'p_growth')}
      ${pillCard('EQ_QUAL', d.p_eq, 'p_eq')}
      ${pillCard('FCF', d.p_fcf, 'p_fcf')}
      ${pillCard('HEALTH', d.p_health, 'p_health')}
      ${pillCard('MOMENTUM', d.p_momentum, 'p_momentum')}
      ${pillCard('ANALYST', d.p_analyst, 'p_analyst')}
      ${pillCard('PIOTROSKI', d.p_piotroski, 'p_piotroski')}
    </div>`;

  const valuation = `
    <div class="grid">
      ${kcard('P/E', fmt(d.pe,2), 'trailing')}
      ${kcard('Fwd P/E', fmt(d.fwd_pe,2), 'forward')}
      ${kcard('PEG', fmt(d.peg,2), 'growth adj')}
      ${kcard('P/S', fmt(d.ps,2), 'sales')}
      ${kcard('P/B', fmt(d.pb,2), 'book')}
      ${kcard('EV/EBITDA', fmt(d.ev_ebitda,2), 'enterprise')}
      ${kcard('FCF Yield', pct(d.fcf_yield,2), 'value')}
      ${kcard('PT Upside', pct(d.pt_upside,1), 'analyst')}
    </div>`;

  const trCard1 = trCard('SmartScore', fmtInt(d.tr_smartscore||d.smartscore), 10);
  const trCard2 = trCard('News Bull', pct(d.tr_news_bull,0), 100);
  const trCard3 = trCard('Blogger Bull', pct(d.tr_blogger_bull,0), 100);
  const tipranks = `
    <div class="grid">
      ${kcard('TR Consensus', d.tr_consensus||'‚Äî', 'rating')}
      ${kcard('# Analysts', fmtInt(d.analysts), 'coverage')}
      ${kcard('TR PT Upside', pct(d.tr_pt_upside||d.pt_upside,1), 'target')}
      ${kcard('Insider', d.tr_insider||'‚Äî', 'signal')}
      ${kcard('Hedge Fund', d.tr_hedge||'‚Äî', 'signal')}
      ${kcard('Inv 30D', pct(d.tr_inv_chg_30d,1), 'inst')}
      ${kcard('Inv 7D', pct(d.tr_inv_chg_7d,1), 'inst')}
    </div>
    <div style="margin-top:10px; display:block">
      <div class="tr-grid">${trCard1}${trCard2}${trCard3}</div>
    </div>`;

  return `<div class="detail" id="detail-${ticker}">
    ${dtabs}
    <div id="dtab-${ticker}-overview" style="display:block">${overview}</div>
    <div id="dtab-${ticker}-pillars" style="display:none">${pillars}</div>
    <div id="dtab-${ticker}-valuation" style="display:none">${valuation}</div>
    <div id="dtab-${ticker}-tipranks" style="display:none">${tipranks}</div>
  </div>`;
}

function kcard(k,v,s){
  return `<div class="kcard"><div class="k">${k}</div><div class="v">${v}</div><div class="s">${s||''}</div></div>`;
}
function pillCard(name, val, key){
  const v=Number(val);
  const pctile=quantileOf(key, v);
  const sc=colorForPercentile(pctile);
  const w = Math.max(0, Math.min(100, v||0));
  const label = tpillar(name);
  return `<div class="pillcard">
    <div class="head">
      <div class="name">${label}</div>
      <div class="num" style="color:${sc.fg}">${fmt(v,0)}</div>
    </div>
    <div class="bar"><span style="width:${w}%;"></span></div>
    <div class="meta"><div>${fmt(pctile,0)}th pct</div><div>${tcol(key)}</div></div>
  </div>`;
}
function trCard(title, value, max){
  const n=Number(String(value).replace('%',''));
  const w = Number.isFinite(n) ? Math.max(0, Math.min(100, (n/max)*100)) : 0;
  return `<div class="tr-card"><div class="t">${title}</div><div class="v">${value}</div><div class="b"><span style="width:${w}%"></span></div></div>`;
}

function render(){
  const cols = ['rank','ticker','sector','composite','valuation','smartscore','consensus','pe','perf_12m','breakout_score'];
  buildHeader(cols);
  const data = sortData(filtered.length?filtered:allData);
  updateStats(data);
  updateTopSector();
  const tbody=document.getElementById('tbody');
  tbody.innerHTML = data.map((d,i)=>rowHtml(d,i)).join('');

  document.querySelectorAll('tr.r').forEach(tr=>{
    tr.addEventListener('click', ()=>{
      tr.classList.toggle('row-open');
      const t=tr.querySelector('.ticker')?.textContent || '';
      const det=document.getElementById(`detail-${t}`);
      if(det){
        det.style.display = det.style.display==='block' ? 'none' : 'block';
      }
    });
  });
}

async function loadData(){
  try{
    const r=await fetch('sp500_data.json?v='+Date.now());
    if(!r.ok) throw new Error('HTTP '+r.status);
    const json=await r.json();
    allData=json.data || [];
    document.getElementById('lastUpdated').innerHTML=`<span class="live-dot"></span>${json.generated||''}`;
    buildPercentiles(allData);
    applyI18n();
    document.getElementById('loading').style.display='none';
    document.getElementById('statsBar').style.display='grid';
    document.getElementById('controls').style.display='flex';
    document.getElementById('viewTabs').style.display='flex';
    filtered=[];
    render();
  }catch(e){
    document.getElementById('loading').style.display='none';
    document.getElementById('error-msg').style.display='block';
    console.error('loadData error:',e);
  }
}

function switchDetailTab(ticker,tab){
  const tc=document.getElementById(`dtabs-${ticker}`);
  if(!tc) return;
  tc.querySelectorAll('.detail-tab').forEach(t=>t.classList.toggle('active',t.dataset.dtab===tab));
  ['overview','pillars','valuation','tipranks'].forEach(t=>{
    const el=document.getElementById(`dtab-${ticker}-${t}`);
    if(el) el.style.display = (t===tab) ? 'block' : 'none';
  });
}

loadData();
</script>
</body>
</html>
