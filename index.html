<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S&P 500 Mozes Ranker</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#070c12; --surface:#0c1520; --surface2:#111d2b; --surface3:#162436;
  --border:#1d2e40; --border2:#243a50;
  --gold:#f5a623; --gold2:#ffc15e; --gold3:#fff3d6;
  --teal:#00d4aa; --teal2:#00f5c4; --red:#ff4757; --red2:#ff6b81;
  --blue:#4dabf7; --purple:#cc5de8; --green:#51cf66; --orange:#ff922b;
  --text:#dce8f4; --text2:#8aaccb; --text3:#4a6a8a; --text4:#2d4a65;
  --mono:'JetBrains Mono',monospace; --sans:'Inter',sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:var(--sans);min-height:100vh;font-size:15px;}
body.rtl{direction:rtl;}
header{padding:14px 28px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,#0a1520 0%,var(--bg) 100%);position:sticky;top:0;z-index:300;}
.logo-title{font-size:20px;font-weight:900;color:#fff;letter-spacing:-.5px;}
.logo-title .logo-accent{color:var(--gold);}
.logo-sub{font-family:var(--mono);font-size:10px;color:var(--text3);letter-spacing:1.5px;margin-top:2px;}
.header-right{display:flex;align-items:center;gap:14px;}
.live-dot{width:7px;height:7px;border-radius:50%;background:var(--teal);box-shadow:0 0 8px var(--teal);display:inline-block;margin-right:6px;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(1.5)}}
.last-updated{font-family:var(--mono);font-size:11px;color:var(--text2);}
.lang-wrap{display:flex;background:var(--surface);border:1px solid var(--border);border-radius:6px;overflow:hidden;}
.lang-btn{padding:5px 13px;font-family:var(--mono);font-size:11px;font-weight:700;cursor:pointer;transition:all .15s;border:none;background:transparent;color:var(--text3);letter-spacing:.5px;}
.lang-btn.active{background:var(--gold);color:#000;}
.stats-bar{display:grid;grid-template-columns:repeat(5,1fr);border-bottom:1px solid var(--border);}
.stat-item{padding:14px 24px;border-right:1px solid var(--border);}
.stat-item:last-child{border-right:none;}
.stat-label{font-size:11px;font-weight:600;color:var(--text3);letter-spacing:.8px;text-transform:uppercase;margin-bottom:5px;}
.stat-value{font-size:26px;font-weight:900;color:#fff;letter-spacing:-1px;}
.stat-accent{color:var(--gold);}
.controls{padding:12px 28px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;border-bottom:1px solid var(--border);background:var(--surface);position:sticky;top:61px;z-index:200;}
.search-wrap{position:relative;flex:0 0 230px;}
.search-icon{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--text3);font-size:14px;}
#search{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:8px 10px 8px 32px;font-family:var(--sans);font-size:13px;color:var(--text);outline:none;}
#search:focus{border-color:var(--gold);}
#search::placeholder{color:var(--text3);}
.filter-toggle{padding:7px 14px;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all .15s;}
.filter-toggle:hover,.filter-toggle.open{border-color:var(--teal);color:var(--teal);}
.filter-panel{display:none;padding:14px 28px;gap:14px;flex-wrap:wrap;align-items:flex-end;border-bottom:1px solid var(--border);background:#090f18;}
.filter-panel.open{display:flex;}
.filter-group{display:flex;flex-direction:column;gap:5px;}
.filter-label{font-size:11px;font-weight:600;color:var(--text3);letter-spacing:.5px;text-transform:uppercase;}
.filter-range{display:flex;align-items:center;gap:6px;}
.filter-input{width:78px;background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:6px 8px;font-family:var(--mono);font-size:12px;color:var(--text);outline:none;}
.filter-input:focus{border-color:var(--teal);}
.filter-range span{color:var(--text3);}
.filter-select{background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:6px 8px;font-size:12px;color:var(--text);outline:none;cursor:pointer;}
.filter-reset{padding:6px 14px;border-radius:4px;border:1px solid var(--border);background:transparent;color:var(--text3);font-size:12px;font-weight:600;cursor:pointer;}
.filter-reset:hover{border-color:var(--red);color:var(--red);}
.sector-filters{display:flex;gap:5px;flex-wrap:wrap;flex:1;}
.sector-btn{padding:5px 11px;border-radius:5px;border:1px solid var(--border);background:transparent;color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all .15s;white-space:nowrap;}
.sector-btn:hover{border-color:var(--gold);color:var(--gold);}
.sector-btn.active{background:var(--gold);border-color:var(--gold);color:#000;}
.count-badge{font-size:13px;font-weight:600;color:var(--text2);margin-left:auto;white-space:nowrap;}
.count-badge span{color:var(--gold);}
.view-tabs{padding:0 28px;display:flex;gap:2px;border-bottom:2px solid var(--border);background:var(--surface);position:sticky;top:107px;z-index:190;overflow-x:auto;}
.view-tabs::-webkit-scrollbar{height:3px;}
.view-tabs::-webkit-scrollbar-thumb{background:var(--border);}
.view-tab{padding:11px 18px;font-size:13px;font-weight:600;color:var(--text2);cursor:pointer;white-space:nowrap;border-bottom:3px solid transparent;margin-bottom:-2px;transition:all .2s;background:transparent;border-top:none;border-left:none;border-right:none;}
.view-tab:hover{color:var(--text);background:rgba(255,255,255,.03);}
.view-tab.active{color:var(--gold);border-bottom-color:var(--gold);background:rgba(245,166,35,.06);}
.table-wrap{overflow-x:auto;padding:0 28px 80px;}
table{width:100%;border-collapse:collapse;margin-top:12px;font-size:13px;table-layout:fixed;}
.col-rank{width:44px;}.col-ticker{width:76px;}.col-company{width:175px;}.col-sector{width:125px;}.col-data{width:105px;}
thead th{padding:10px 8px;text-align:center;font-size:11px;font-weight:700;letter-spacing:.4px;text-transform:uppercase;color:var(--text2);border-bottom:2px solid var(--border);white-space:nowrap;cursor:pointer;user-select:none;transition:color .15s;overflow:hidden;position:relative;}
thead th:hover{color:var(--gold2);}
thead th.sorted{color:var(--gold);}
thead th.sorted::after{content:' â†“';}
thead th.sorted.asc::after{content:' â†‘';}
.th-wrap{position:relative;display:inline-block;width:100%;}
.th-tip{visibility:hidden;opacity:0;position:fixed;background:#0d1e2e;border:1px solid var(--border2);color:var(--text);font-size:12px;font-family:var(--sans);font-weight:400;letter-spacing:0;text-transform:none;white-space:normal;padding:10px 14px;border-radius:7px;width:230px;line-height:1.6;z-index:9999;box-shadow:0 12px 40px #000d;pointer-events:none;transition:opacity .15s;}
thead th:hover .th-tip{visibility:visible;opacity:1;}
tbody tr{border-bottom:1px solid #0a1520;transition:background .1s;cursor:pointer;}
tbody tr:hover{background:var(--surface2);}
tbody tr.expanded{background:var(--surface2);}
td{padding:11px 8px;vertical-align:middle;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.td-rank{font-family:var(--mono);font-size:12px;font-weight:700;color:var(--text3);text-align:center;position:relative;}
.td-rank.top3{color:var(--gold2);}
.td-ticker{font-family:var(--mono);font-size:14px;font-weight:800;color:#fff;}
.td-ticker a{color:inherit;text-decoration:none;border-bottom:1px solid transparent;transition:all .15s;}
.td-ticker a:hover{color:var(--gold);border-color:var(--gold);}
.td-company{color:var(--text2);font-size:12px;font-weight:500;}
.sector-pill{display:inline-block;padding:3px 8px;border-radius:4px;font-size:11px;font-weight:600;white-space:nowrap;}
.score-cell{display:flex;align-items:center;gap:7px;}
.score-num{font-family:var(--mono);font-size:13px;font-weight:700;width:38px;text-align:right;flex-shrink:0;}
.score-bar-bg{flex:1;height:5px;background:var(--border);border-radius:3px;overflow:hidden;}
.score-bar-fill{height:100%;border-radius:3px;transition:width .3s;}
.td-num{font-family:var(--mono);font-size:12px;text-align:center;font-weight:500;}
.td-num.pos{color:var(--teal);}
.td-num.neg{color:var(--red2);}
.td-num.neutral{color:var(--text2);}
.td-num.hi{color:#74e8c0;}
.td-num.mid{color:var(--gold2);}
.ss-badge{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:6px;font-family:var(--mono);font-size:12px;font-weight:800;}
.stock-detail-row{display:none;background:#060c14;border-bottom:2px solid var(--border);}
.stock-detail-row.open{display:table-row;}
.stock-detail-inner{padding:20px 52px 28px;}
.detail-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;}
.detail-ticker-big{font-family:var(--mono);font-size:22px;font-weight:800;color:#fff;}
.detail-company-name{font-size:14px;font-weight:500;color:var(--text2);}
.detail-price{font-family:var(--mono);font-size:22px;font-weight:800;color:var(--gold);}
.detail-pill-sector{padding:4px 10px;border-radius:4px;font-size:11px;font-weight:700;}
.detail-tabs{display:flex;gap:3px;border-bottom:1px solid var(--border);margin-bottom:16px;}
.detail-tab{padding:7px 15px;font-size:12px;font-weight:600;color:var(--text3);cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;background:none;border-top:none;border-left:none;border-right:none;white-space:nowrap;}
.detail-tab:hover{color:var(--text);}
.detail-tab.active{color:var(--teal);border-bottom-color:var(--teal);}
.pillar-grid{display:grid;grid-template-columns:repeat(10,1fr);gap:10px;margin-bottom:20px;}
.pillar-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:12px;text-align:center;}
.pillar-card-name{font-size:9px;font-weight:700;color:var(--text3);letter-spacing:.8px;text-transform:uppercase;margin-bottom:6px;}
.pillar-card-score{font-size:24px;font-weight:900;margin-bottom:6px;}
.pillar-bar-bg{height:4px;background:var(--border);border-radius:2px;overflow:hidden;}
.pillar-bar-fill{height:100%;border-radius:2px;}
.metrics-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;}
.metric-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:11px 13px;}
.metric-label{font-size:10px;font-weight:700;color:var(--text3);letter-spacing:.5px;text-transform:uppercase;margin-bottom:4px;}
.metric-value{font-family:var(--mono);font-size:15px;font-weight:700;color:#fff;}
.metric-value.pos{color:var(--teal);}
.metric-value.neg{color:var(--red2);}
.metric-value.gold{color:var(--gold);}
.metric-sub{font-size:10px;color:var(--text3);margin-top:2px;}
.val-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;}
.val-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:12px;text-align:center;}
.val-label{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.4px;margin-bottom:6px;}
.val-num{font-family:var(--mono);font-size:18px;font-weight:800;color:#fff;}
.tr-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
.tr-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:14px;}
.tr-card-title{font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px;}
.tr-card-main{font-family:var(--mono);font-size:20px;font-weight:800;color:#fff;margin-bottom:4px;}
.tr-card-sub{font-size:12px;color:var(--text2);}
.ss-big{display:inline-flex;align-items:center;justify-content:center;width:48px;height:48px;border-radius:10px;font-family:var(--mono);font-size:22px;font-weight:800;margin-bottom:6px;}
.sentiment-bar{height:8px;border-radius:4px;background:var(--border);overflow:hidden;margin:6px 0;}
.sentiment-fill{height:100%;border-radius:4px;}
#loading{display:flex;flex-direction:column;align-items:center;justify-content:center;height:60vh;gap:20px;}
.spinner{width:44px;height:44px;border:3px solid var(--border);border-top-color:var(--gold);border-radius:50%;animation:spin .8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{font-size:13px;font-weight:600;color:var(--text2);letter-spacing:2px;animation:blink 1.5s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
#error-msg{display:none;text-align:center;padding:60px;color:var(--red);}
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* â”€â”€ Double Signal row â”€â”€ */
tbody tr.double-signal-row{background:transparent;border-left:none;}
tbody tr.double-signal-row:hover{background:var(--surface2);}
tbody tr.double-signal-row.expanded{background:var(--surface2);}
.ds-badge{position:absolute;top:1px;left:1px;font-size:8px;line-height:1;pointer-events:none;}

/* â”€â”€ Breakout-only row â”€â”€ */
tbody tr.breakout-only-row{border-left:3px solid var(--teal);}
tbody tr.breakout-only-row:hover{background:rgba(0,212,170,.04);}

/* â”€â”€ Sector combobox â”€â”€ */
#sectorSelect{background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:7px 11px;font-size:12px;font-weight:600;color:var(--text2);outline:none;cursor:pointer;min-width:190px;}
#sectorSelect:focus{border-color:var(--gold);}
#sectorSelect option{background:#0c1520;color:var(--text);}

/* â”€â”€ Breakout market-regime banner â”€â”€ */
.regime-banner{display:flex;align-items:center;gap:18px;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:10px 16px;margin-bottom:16px;flex-wrap:wrap;}
.regime-label{font-size:10px;font-weight:700;color:var(--text3);letter-spacing:.8px;text-transform:uppercase;}
.regime-value{font-family:var(--mono);font-size:13px;font-weight:700;color:#fff;}
.regime-risk-on{color:var(--teal);}
.regime-risk-off{color:var(--red);}
.regime-divider{width:1px;height:28px;background:var(--border);}

/* â”€â”€ v5.3: Stale data banner â”€â”€ */
.stale-banner{display:none;padding:10px 28px;background:linear-gradient(90deg,#2e2200,#1a1400);border-bottom:2px solid #f5a623;color:#ffc15e;font-size:13px;font-weight:600;align-items:center;gap:10px;}
.stale-banner.show{display:flex;}
.stale-icon{font-size:18px;}

/* â”€â”€ v5.3: Compare mode â”€â”€ */
.compare-bar{display:none;padding:10px 28px;background:linear-gradient(90deg,#0d2137,#0c1520);border-bottom:2px solid var(--blue);align-items:center;gap:12px;position:sticky;top:61px;z-index:250;}
.compare-bar.show{display:flex;}
.compare-chip{display:inline-flex;align-items:center;gap:5px;background:var(--surface2);border:1px solid var(--blue);border-radius:16px;padding:4px 12px;font-family:var(--mono);font-size:12px;font-weight:700;color:var(--blue);}
.compare-chip .remove{cursor:pointer;color:var(--text3);font-size:14px;margin-left:2px;}
.compare-chip .remove:hover{color:var(--red);}
.compare-btn{padding:6px 16px;border-radius:6px;border:1px solid var(--blue);background:var(--blue);color:#000;font-size:12px;font-weight:700;cursor:pointer;}
.compare-btn:disabled{opacity:.4;cursor:not-allowed;}
.compare-cancel{padding:6px 12px;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--text3);font-size:12px;cursor:pointer;}

/* â”€â”€ v5.3: Compare modal â”€â”€ */
.compare-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:999;overflow-y:auto;padding:40px;}
.compare-modal.show{display:block;}
.compare-inner{max-width:1200px;margin:0 auto;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:24px;}
.compare-close{position:absolute;top:16px;right:24px;font-size:24px;color:var(--text3);cursor:pointer;background:none;border:none;}
.compare-close:hover{color:#fff;}
.compare-grid{display:grid;gap:1px;background:var(--border);}
.compare-grid>div{background:var(--surface);padding:10px 14px;}
.compare-grid .cg-header{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;}
.compare-grid .cg-ticker{font-family:var(--mono);font-size:16px;font-weight:800;color:#fff;}
.compare-grid .cg-best{color:var(--teal);font-weight:800;}

/* â”€â”€ v5.3: Watchlist star â”€â”€ */
.star-btn{background:none;border:none;cursor:pointer;font-size:16px;padding:0 4px;opacity:.4;transition:all .15s;}
.star-btn:hover{opacity:.8;}
.star-btn.starred{opacity:1;color:var(--gold);}
tbody tr.watched{background:rgba(245,166,35,.03);}

/* â”€â”€ v5.3: Action buttons (export, theme) â”€â”€ */
.action-btn{padding:5px 11px;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--text3);font-size:11px;font-weight:600;cursor:pointer;transition:all .15s;}
.action-btn:hover{border-color:var(--gold);color:var(--gold);}

/* â”€â”€ v5.3: Light theme â”€â”€ */
:root[data-theme="light"]{
  --bg:#f4f6f9;--surface:#fff;--surface2:#f0f2f5;--surface3:#e8ecf0;
  --border:#d0d7de;--border2:#c0c8d0;
  --gold:#c07800;--gold2:#a06000;--gold3:#704000;
  --teal:#008866;--teal2:#006644;--red:#cc2233;--red2:#aa1122;
  --blue:#1a6fb5;--purple:#8b3aaf;--green:#2e8b40;--orange:#cc6600;
  --text:#1a2433;--text2:#4a5568;--text3:#718096;--text4:#a0aec0;
}
:root[data-theme="light"] header{background:linear-gradient(180deg,#e8ecf0,var(--bg));}
:root[data-theme="light"] .controls{background:var(--surface);}
:root[data-theme="light"] tbody tr:hover{background:#f0f4f8;}
:root[data-theme="light"] .stock-detail-row{background:#fafbfc;}
:root[data-theme="light"] .th-tip{background:#fff;border-color:var(--border);color:var(--text);}
</style>
</head>
<body>
<header>
  <div class="logo-block">
    <div class="logo-title">S&amp;P 500 <span class="logo-accent">Mozes</span> Ranker</div>
    <div class="logo-sub">v5.3 Â· 9-Pillar + Breakout Scanner</div>
  </div>
  <div class="header-right">
    <div class="last-updated" id="lastUpdated"><span class="live-dot"></span>Loading...</div>
    <button class="action-btn" id="btnExport" onclick="exportCSV()" title="Export filtered table to CSV" style="display:none">â¤“ CSV</button>
    <button class="action-btn" id="btnTheme" onclick="toggleTheme()" title="Toggle light/dark theme">â˜€</button>
    <div class="lang-wrap">
      <button class="lang-btn active" id="btnEn" onclick="setLang('en')">EN</button>
      <button class="lang-btn" id="btnHe" onclick="setLang('he')">×¢×‘</button>
    </div>
  </div>
</header>
<div class="stale-banner" id="staleBanner"><span class="stale-icon">âš </span><span id="staleText">Data may be outdated. Last update was more than 48 hours ago.</span></div>
<div class="compare-bar" id="compareBar">
  <span style="font-size:12px;font-weight:700;color:var(--blue)">âš– COMPARE:</span>
  <div id="compareChips" style="display:flex;gap:6px;flex-wrap:wrap"></div>
  <button class="compare-btn" id="compareGo" onclick="showCompareModal()" disabled>Compare</button>
  <button class="compare-cancel" onclick="clearCompare()">Cancel</button>
  <span style="font-size:11px;color:var(--text3);margin-left:auto">Click rows to add (max 4)</span>
</div>
<div class="compare-modal" id="compareModal"><div class="compare-inner" id="compareInner"></div></div>
<div class="stats-bar" id="statsBar" style="display:none">
  <div class="stat-item"><div class="stat-label" id="lbl-ranked">Stocks Ranked</div><div class="stat-value" id="statTotal">â€”</div></div>
  <div class="stat-item"><div class="stat-label" id="lbl-avg">Avg Composite</div><div class="stat-value stat-accent" id="statAvg">â€”</div></div>
  <div class="stat-item"><div class="stat-label" id="lbl-topsec">Top Sector</div><div class="stat-value" id="statTopSector" style="font-size:16px;margin-top:4px">â€”</div></div>
  <div class="stat-item"><div class="stat-label" id="lbl-ss8">SmartScore â‰¥ 8</div><div class="stat-value stat-accent" id="statSS8">â€”</div></div>
  <div class="stat-item"><div class="stat-label" id="lbl-tr">TR Coverage</div><div class="stat-value" id="statTR">â€”</div></div>
</div>
<div class="controls" id="controls" style="display:none">
  <div class="search-wrap"><span class="search-icon">âŒ•</span><input type="text" id="search" placeholder="Search ticker or companyâ€¦"></div>
  <button class="filter-toggle" id="filterToggle" onclick="toggleFilter()">âš™ <span id="lbl-filters">FILTERS</span></button>
  <button class="filter-toggle" id="btnCompareMode" onclick="toggleCompareMode()" style="display:none">âš– Compare</button>
  <select id="sectorSelect" onchange="onSectorChange(this.value)"><option value="ALL">ALL SECTORS</option></select>
  <div class="count-badge"><span id="showCount">â€”</span> <span id="lbl-stocks">stocks</span></div>
</div>
<div class="filter-panel" id="filterPanel">
  <div class="filter-group"><div class="filter-label" id="lbl-f-composite">Composite Score</div><div class="filter-range"><input type="number" id="fCompMin" placeholder="Min" class="filter-input" min="0" max="100"><span>â€“</span><input type="number" id="fCompMax" placeholder="Max" class="filter-input" min="0" max="100"></div></div>
  <div class="filter-group"><div class="filter-label" id="lbl-f-ss">SmartScore Min</div><select id="fSSMin" class="filter-select"><option value="">Any</option><option value="8">â‰¥ 8</option><option value="9">â‰¥ 9</option><option value="10">= 10</option></select></div>
  <div class="filter-group"><div class="filter-label" id="lbl-f-consensus">Consensus</div><select id="fConsensus" class="filter-select"><option value="">Any</option><option value="StrongBuy">Strong Buy</option><option value="Buy">Buy</option><option value="Hold">Hold</option></select></div>
  <div class="filter-group"><div class="filter-label" id="lbl-f-pe">P/E Max</div><input type="number" id="fPEMax" placeholder="e.g. 25" class="filter-input"></div>
  <div class="filter-group"><div class="filter-label" id="lbl-f-perf">12M Return Min %</div><input type="number" id="fPerfMin" placeholder="e.g. 10" class="filter-input"></div>
  <div class="filter-group"><div class="filter-label" id="lbl-f-valuation">Val. Score Min</div><input type="number" id="fValMin" placeholder="e.g. 60" class="filter-input"></div>
  <div class="filter-group"><div class="filter-label">Mkt Cap Min</div><select id="fMktCap" class="filter-select"><option value="">Any</option><option value="300000000000">Mega â‰¥$300B</option><option value="50000000000">Large â‰¥$50B</option><option value="10000000000" selected>Mid â‰¥$10B</option><option value="2000000000">Small â‰¥$2B</option></select></div>
  <button class="filter-reset" onclick="resetFilters()" id="lbl-f-reset">âœ• Reset</button>
</div>
<div class="view-tabs" id="viewTabs" style="display:none"></div>
<div id="loading"><div class="spinner"></div><div class="loading-text" id="loadingText">LOADING MARKET DATA...</div></div>
<div id="error-msg" style="font-size:14px;">âš  Could not load sp500_data.json<br><span style="color:var(--text2);font-size:12px;display:block;margin-top:8px">Run the GitHub Actions workflow first.</span></div>
<div class="table-wrap" id="tableWrap" style="display:none">
  <table id="mainTable"><thead id="tableHead"></thead><tbody id="tableBody"></tbody></table>
</div>
<script>

  function makeUrl(path){
    const u = new URL(path, window.location.href);
    // Always bust cache
    u.searchParams.set('v', Date.now().toString());
    return u.toString();
  }


const T={en:{ranked:'Stocks Ranked',avg:'Avg Composite',topsec:'Top Sector',ss8:'SmartScore â‰¥ 8',tr:'TR Coverage',stocks:'stocks',searchph:'Search ticker or companyâ€¦',filters:'FILTERS',reset:'âœ• Reset',fcomposite:'Composite Score',fss:'SmartScore Min',fconsensus:'Consensus',fpe:'P/E Max',fperf:'12M Return Min %',fval:'Val. Score Min',loading:'LOADING MARKET DATA...',allsectors:'ALL SECTORS',topSectors:{'Information Technology':'Info Tech','Communication Services':'Comm Svcs','Consumer Discretionary':'Cons Disc','Consumer Staples':'Cons Staples','Health Care':'Health'},tabs:{score:'ðŸ“Š Score',valuation:'ðŸ’° Valuation',profitability:'ðŸ’¹ Profitability',growth:'ðŸš€ Growth',cashflow:'ðŸ’µ Cash Flow',health:'ðŸ¦ Balance Sheet',momentum:'âš¡ Momentum',analyst:'ðŸ”­ Analyst',tipranks:'ðŸŽ¯ TipRanks',watchlist:'â­ Watchlist',breakout:'âš¡ Breakout'},dtabs:{overview:'Overview',pillars:'Pillars',valuation:'Valuation',tipranks:'TipRanks'},cols:{rank:'#',ticker:'Ticker',company:'Company',sector:'Sector',composite:'Composite',valuation:'Valuation',smartscore:'SmartScore',consensus:'Consensus',pe:'P/E',fwd_pe:'Fwd P/E',peg:'PEG',ps:'P/S',pb:'P/B',ev_ebitda:'EV/EBITDA',fcf_yield:'FCF Yield %',pt_upside:'PT Upside %',div_yield:'Div Yield %',pillar_prof:'Pillar',roe:'ROE %',roa:'ROA %',roic:'ROIC %',net_margin:'Net Margin %',gross_margin:'Gross Margin %',op_margin:'Op. Margin %',eq_score:'EQ Score',piotroski_f:'Piotroski F',pillar_growth:'Pillar',rev_growth:'Rev Growth %',eps_growth:'EPS Growth %',fcf_margin:'FCF Margin %',tr_asset_gr:'Asset Growth %',earn_rev:'Earn Rev (0-5)',eps_rev_90d:'EPS Est Î”90D %',pillar_fcf:'FCF Pillar',fcf_to_ni:'FCF/NI',payout_ratio:'Payout %',pillar_health:'Health Pillar',current_ratio:'Current Ratio',debt_equity:'Debt/Equity',altman_z:'Altman Z',beta:'Beta',pillar_mom:'Mom. Pillar',perf_12m:'12M %',perf_6m:'6M %',perf_3m:'3M %',perf_1m:'1M %',momentum:'Composite Mom.',tr_mom_12m:'TR Tech Mom.',pillar_analyst:'Analyst Pillar',analyst_mean:'Yahoo Rating',analysts:'# Analysts',tr_consensus:'TR Consensus',tr_pt_upside:'TR PT Upside %',tr_smartscore:'SmartScore',tr_news_bull:'News Bull. %',tr_blogger_bull:'Blogger Bull. %',tr_insider:'Insider',tr_hedge:'Hedge Fund',tr_inv_chg_30d:'Inv. 30D %',tr_inv_chg_7d:'Inv. 7D %',breakout_score:'Breakout Score',breakout_rank:'Scan Rank',breakout_phase:'Phase',breakout_rr:'Risk/Reward',breakout_rs:'Rel. Strength',breakout_stop:'Stop Loss',has_vcp:'VCP Pattern',vcp_quality:'VCP Quality',breakout_entry:'Entry Quality',vs_sector:'vs Sector',coverage:'Coverage %',p_profitability:'Profitab.',p_growth:'Growth',p_eq:'EQ Qual.',p_fcf:'×ª×–×¨×™×',p_health:'Health',p_momentum:'Momentum',p_analyst:'Analyst',p_piotroski:'Piotroski',short_ratio:'Short Ratio',insider_pct:'Insider %MCap',ma_regime:'MA Regime',pct_above_ma200:'% Above MA200',p_earn_rev:'Earn Rev.',p_rs:'Rel. Str.'},tips:{composite:'Weighted average of all 9 pillars (10â€“100). Higher = better overall quality + value.',valuation:'How cheap vs expensive vs sector peers. 100 = deeply undervalued, 0 = very expensive.',smartscore:'TipRanks SmartScore 1â€“10: AI aggregation of analyst ratings, news sentiment, insider trading and hedge fund activity.',pe:'Price / Earnings (trailing 12M). Lower = potentially cheaper relative to earnings.',fwd_pe:'Forward P/E on next 12M EPS estimate. More forward-looking than trailing P/E.',peg:'PEG Ratio = P/E Ã· EPS Growth. Below 1 = potentially undervalued relative to growth rate.',ps:'Price / Sales. Useful for high-growth companies with low or no profits.',pb:'Price / Book Value. Below 1 = trading below asset value.',ev_ebitda:'Enterprise Value / EBITDA. Key metric for comparing companies across different capital structures.',fcf_yield:'Free Cash Flow / Market Cap %. Higher = more cash generated per dollar invested.',pt_upside:'Analyst consensus price target vs current price. % upside potential to target.',div_yield:'Annual dividend / share price. Income return on investment.',pillar_prof:'Profitability Pillar (0â€“100): composite of ROE, ROA, ROIC, net/gross/operating margins.',p_profitability:'Profitability Pillar (0â€“100): composite of ROE, ROA, ROIC, net/gross/operating margins.',roe:'Return on Equity: net income / equity. Measures how efficiently equity is used to generate profit.',roa:'Return on Assets: net income / total assets. Efficiency of all assets in generating profit.',roic:'Return on Invested Capital (NOPAT / invested capital). Best measure of capital allocation quality.',net_margin:'Net income / revenue. % of each dollar of revenue that becomes profit.',gross_margin:'(Revenue âˆ’ COGS) / Revenue. Efficiency of core business before operating expenses.',op_margin:'Operating income / revenue. Efficiency before interest and taxes.',eq_score:'Earnings Quality Score: measures whether reported earnings are backed by real cash flow. Higher = more reliable earnings.',piotroski_f:'Piotroski F-Score (0â€“9): 9 binary financial health signals. â‰¥7 = strong, â‰¤2 = weak. Predicts stock returns.',pillar_growth:'Growth Pillar (0â€“100): composite of revenue growth, EPS growth, FCF/NI conversion, asset growth and analyst earnings revisions.',p_growth:'Growth Pillar (0â€“100): composite of revenue growth, EPS growth, FCF/NI conversion, asset growth and analyst earnings revisions.',rev_growth:'Year-over-year revenue growth. Core measure of top-line business momentum.',eps_growth:'Year-over-year EPS (earnings per share) growth. Measures profit expansion.',fcf_margin:'Free Cash Flow / Revenue. % of revenue converted into free cash flow.',tr_asset_gr:'Asset growth rate. Rapid asset growth can dilute returns and signal aggressive accounting.',earn_rev:'Earnings Revision Score (0â€“5): measures analyst EPS estimate revisions. Combines breadth (up vs down revisions in 30 days) and magnitude (% change in consensus EPS over 90 days). Based on Zacks research â€” one of the strongest short-term alpha factors.',eps_rev_90d:'% change in consensus EPS estimate over the past 90 days. Positive = analysts raising estimates, negative = cutting.',pillar_fcf:'FCF Pillar (0â€“100): measures FCF yield, FCF margin, FCF-to-net-income ratio, and dividend sustainability.',p_fcf:'FCF Pillar (0â€“100): measures FCF yield, FCF margin, FCF-to-net-income ratio, and dividend sustainability.',fcf_to_ni:'FCF / Net Income. Ratio > 1 = earnings are well backed by real cash. < 0.5 = low earnings quality.',payout_ratio:'Dividends paid / Net Income. High payout can limit reinvestment; payout > 100% is unsustainable.',pillar_health:'Balance Sheet Pillar (0â€“100): composite of current ratio, debt/equity and beta (low-volatility signal).',p_health:'Balance Sheet Pillar (0â€“100): composite of current ratio, debt/equity and beta (low-volatility signal).',current_ratio:'Current Assets / Current Liabilities. > 1.5 = healthy short-term liquidity.',debt_equity:'Total Debt / Equity. Higher = more leveraged. Acceptability depends heavily on industry.',altman_z:'Altman Z-Score predicts bankruptcy risk. > 3 = safe, 1.8â€“3 = grey zone, < 1.8 = distress.',beta:'Price volatility vs S&P 500. > 1 = amplified moves (more risk & potential reward). < 1 = more stable.',pillar_mom:'Momentum Pillar (0â€“100): composite of 12/6/3/1 month price returns vs sector peers.',p_momentum:'Momentum Pillar (0â€“100): composite of 12/6/3/1 month price returns vs sector peers.',perf_12m:'12-month price return. The strongest single predictor in factor-based momentum investing.',perf_6m:'6-month price return. Strong intermediate-term momentum signal.',perf_3m:'3-month price return. Recent trend confirmation.',perf_1m:'1-month price return. Short-term momentum; watch for mean reversion risk.',momentum:'Composite momentum: weighted average of 12M/6M/3M/1M returns (higher weight on 12M).',tr_mom_12m:'TipRanks 12-month technical momentum score based on price trend analysis.',pillar_analyst:'Analyst Pillar (0â€“100): analyst rating, number of analysts, price target upside and TipRanks consensus.',p_analyst:'Analyst Pillar (0â€“100): analyst rating, number of analysts, price target upside and TipRanks consensus.',analyst_mean:'Yahoo Finance analyst mean rating. 1=Strong Buy, 2=Buy, 3=Hold, 4=Sell, 5=Strong Sell.',analysts:'Number of Wall Street analysts providing coverage. More analysts = more reliable consensus.',tr_consensus:'TipRanks analyst consensus: Strong Buy / Moderate Buy / Hold / Sell based on all TipRanks analysts.',consensus:'TipRanks analyst consensus: Strong Buy / Moderate Buy / Hold / Sell.',tr_pt_upside:'TipRanks aggregated price target implied upside from current price.',tr_smartscore:'TipRanks SmartScore 1â€“10: AI aggregation of analyst, news, insider and hedge fund signals.',tr_news_bull:'% of recent news articles with bullish sentiment from TipRanks news analysis.',tr_blogger_bull:'% of financial bloggers with bullish outlook according to TipRanks blogger sentiment.',tr_insider:'Insider trading direction: Positive = recent net buying, Negative = recent net selling.',tr_hedge:'Hedge fund activity trend: are institutional funds adding or reducing positions?',tr_inv_chg_30d:'% change in institutional investor (hedge fund) holdings over the past 30 days.',tr_inv_chg_7d:'% change in institutional investor (hedge fund) holdings over the past 7 days.',breakout_score:'Breakout Score (0â€“110): Minervini Trend Template score. Measures Stage 2 uptrend strength, relative strength, volume and fundamentals.',breakout_rank:'Rank among all S&P 500 breakout candidates from latest scanner run.',breakout_phase:'Minervini market stage. 1=Base (accumulation), 2=Uptrend (BUY ZONE), 3=Distribution (caution), 4=Downtrend (avoid).',breakout_rr:'Risk/Reward ratio to analyst price target with ATR-based stop loss. Minimum 2:1 required. Higher = better setup.',breakout_rs:'Relative Strength vs SPY over 63 days. > 1 = outperforming the market. Key Minervini filter.',breakout_stop:'ATR-based stop loss price. Risk is limited to ~8â€“10% from entry. Position size accordingly.',has_vcp:'VCP = Volatility Contraction Pattern (Minervini). Series of progressively tighter price contractions = institutional accumulation.',vcp_quality:'VCP quality score (0â€“100). Higher = tighter and more well-formed contractions, better setup.',breakout_entry:'Entry quality assessment: Ideal = tight base near 52W high, Good = solid setup, OK = borderline.',p_eq:'Earnings Quality Pillar (0â€“100): measures reliability and sustainability of reported earnings vs. cash flow.',p_piotroski:'Piotroski F-Score Pillar (0â€“100): derived from 9-point binary financial health score.',vs_sector:'Composite score minus the sector median â€” how much this stock outperforms its sector peers.',coverage:'Data completeness: % of the 17 core financial metrics available from data sources. < 70% = limited data.',short_ratio:'Short Ratio = days to cover all short positions at average volume. High (>5) = crowded short, potential squeeze. Low (<2) = minimal short interest.',ma_regime:'MA Regime Signal (0â€“2.5): scores stocks by position relative to rising 200-day moving average. 2.0 = sweet spot (0-5% above rising MA200). 0 = below MA200 or over-extended (25%+ above).',pct_above_ma200:'Current price vs 200-day moving average. Positive = trading above, negative = below. Sweet spot: 0â€“15% above rising MA200.',p_earn_rev:'Earnings Revisions Pillar (0â€“100): measures analyst EPS revision activity. Combines revision breadth (up vs down), magnitude (% EPS change), and recent acceleration. Independent pillar â€” strongest short-term alpha factor.',p_rs:'Relative Strength Pillar (0â€“100): measures excess return vs S&P 500 across 12M/6M/3M timeframes. High = consistently outperforming the market.'},detailLabels:{Price:'Price',MktCap:'Mkt Cap',AltmanZ:'Altman Z',PiotroskiF:'Piotroski F',DivYield:'Div Yield',vsSector:'vs Sector',Beta:'Beta',Analysts:'# Analysts',SmartScore:'SmartScore',Consensus:'TR Consensus',TRUpside:'TR PT Upside',Coverage:'Coverage'},sectors:{'Information Technology':'IT','Health Care':'Health','Financials':'Financials','Consumer Discretionary':'Cons D','Communication Services':'Comm','Industrials':'Industrials','Consumer Staples':'Cons S','Energy':'Energy','Real Estate':'Real Est.','Materials':'Materials','Utilities':'Utilities'},pillarNames:{VALUATION:'VALUATION',PROFITAB:'PROFITAB.',GROWTH:'GROWTH',EARN_REV:'EARN REV.',EQ_QUAL:'EQ QUAL',FCF:'FCF',HEALTH:'HEALTH',MOMENTUM:'MOMENTUM',REL_STR:'REL. STR.',ANALYST:'ANALYST'}},he:{ranked:'×ž× ×™×•×ª ×ž×“×•×¨×’×•×ª',avg:'×¦×™×•×Ÿ ×ž×ž×•×¦×¢',topsec:'×¡×§×˜×•×¨ ×ž×•×‘×™×œ',ss8:'×¦×™×•×Ÿ ×—×›× â‰¥ 8',tr:'×›×™×¡×•×™ TipRanks',stocks:'×ž× ×™×•×ª',searchph:'×—×¤×© ×˜×™×§×¨ ××• ×—×‘×¨×”â€¦',filters:'×¤×™×œ×˜×¨×™×',reset:'âœ• ××™×¤×•×¡',fcomposite:'×¦×™×•×Ÿ ×§×•×ž×¤×•×–×™×˜',fss:'×¦×™×•×Ÿ ×—×›× ×ž×™× .',fconsensus:'×§×•× ×¦× ×–×•×¡',fpe:'P/E ×ž×§×¡×™×ž×•×',fperf:'×ª×©×•××” 12M ×ž×™× . %',fval:'×¦×™×•×Ÿ ×©×•×•×™ ×ž×™× .',loading:'×˜×•×¢×Ÿ × ×ª×•× ×™ ×©×•×§...',allsectors:'×›×œ ×”×¡×§×˜×•×¨×™×',topSectors:{'Information Technology':'×˜×›× ×•×œ×•×’×™×”','Communication Services':'×ª×§×©×•×¨×ª','Consumer Discretionary':'×¦×¨×™×›×” ×ž×—×–×•×¨×™×ª','Consumer Staples':'×¦×¨×™×›×” ×‘×¡×™×¡×™×ª','Health Care':'×‘×¨×™××•×ª'},tabs:{score:'ðŸ“Š ×¦×™×•×Ÿ',valuation:'ðŸ’° ×©×•×•×™',profitability:'ðŸ’¹ ×¨×•×•×—×™×•×ª',growth:'ðŸš€ ×¦×ž×™×—×”',cashflow:'ðŸ’µ ×ª×–×¨×™×',health:'ðŸ¦ ×ž××–×Ÿ',momentum:'âš¡ ×ž×•×ž× ×˜×•×',analyst:'ðŸ”­ ×× ×œ×™×¡×˜×™×',tipranks:'ðŸŽ¯ TipRanks',watchlist:'â­ ×¨×©×™×ž×ª ×ž×¢×§×‘',breakout:'âš¡ ×¤×¨×™×¦×”'},dtabs:{overview:'×¡×§×™×¨×”',pillars:'×¤×™×œ×¨×™×',valuation:'×©×•×•×™',tipranks:'TipRanks'},cols:{rank:'#',ticker:'×˜×™×§×¨',company:'×—×‘×¨×”',sector:'×¡×§×˜×•×¨',composite:'×¦×™×•×Ÿ ×§×•×ž×¤×•×–×™×˜',valuation:'×©×•×•×™',smartscore:'×¦×™×•×Ÿ ×—×›×',consensus:'×§×•× ×¦× ×–×•×¡',pe:'P/E',fwd_pe:'P/E ×¢×ª×™×“×™',peg:'PEG',ps:'P/S',pb:'P/B',ev_ebitda:'EV/EBITDA',fcf_yield:'×ª×©×•××ª FCF %',pt_upside:'×™×¢×“ ×ž×—×™×¨ %',div_yield:'×ª×©×•××ª ×“×™×‘. %',pillar_prof:'×¤×™×œ×¨',roe:'ROE %',roa:'ROA %',roic:'ROIC %',net_margin:'×ž×¨×’×³×™×Ÿ × ×˜×• %',gross_margin:'×ž×¨×’×³×™×Ÿ ×’×•×œ×ž×™ %',op_margin:'×ž×¨×’×³×™×Ÿ ×ª×¤×¢×•×œ×™ %',eq_score:'××™×›×•×ª ×¨×•×•×—',piotroski_f:'Piotroski F',pillar_growth:'×¤×™×œ×¨',rev_growth:'×¦×ž×™×—×ª ×”×›× ×¡×•×ª %',eps_growth:'×¦×ž×™×—×ª EPS %',fcf_margin:'×ž×¨×’×³×™×Ÿ FCF %',tr_asset_gr:'×¦×ž×™×—×ª × ×›×¡×™× %',earn_rev:'×©×™× ×•×™ ×ª×—×–×™×•×ª (0-5)',eps_rev_90d:'×©×™× ×•×™ EPS 90×™ %',pillar_fcf:'×¤×™×œ×¨ FCF',fcf_to_ni:'FCF/×¨×•×•×—',payout_ratio:'×™×—×¡ ×—×œ×•×§×” %',pillar_health:'×¤×™×œ×¨ ×‘×¨×™××•×ª',current_ratio:'×™×—×¡ ×©×•×˜×£',debt_equity:'×—×•×‘/×”×•×Ÿ',altman_z:'Altman Z',beta:'×‘×˜×',pillar_mom:'×¤×™×œ×¨ ×ž×•×ž× ×˜×•×',perf_12m:'12M %',perf_6m:'6M %',perf_3m:'3M %',perf_1m:'1M %',momentum:'×ž×•×ž× ×˜×•× ×ž×©×•×§×œ×œ',tr_mom_12m:'×ž×•×ž× ×˜×•× TR',pillar_analyst:'×¤×™×œ×¨ ×× ×œ×™×¡×˜×™×',analyst_mean:'×“×™×¨×•×’ Yahoo',analysts:'×ž×¡×³ ×× ×œ×™×¡×˜×™×',tr_consensus:'×§×•× ×¦× ×–×•×¡ TR',tr_pt_upside:'×™×¢×“ TR %',tr_smartscore:'×¦×™×•×Ÿ ×—×›×',tr_news_bull:'×—×“×©×•×ª ×—×™×•×‘×™×•×ª %',tr_blogger_bull:'×‘×œ×•×’×¨×™× ×—×™×•×‘×™×™× %',tr_insider:'×ž×¡×—×¨ ×¤× ×™×',tr_hedge:'×§×¨× ×•×ª ×’×™×“×•×¨',tr_inv_chg_30d:'×ž×•×¡×“×™ 30×™ %',tr_inv_chg_7d:'×ž×•×¡×“×™ 7×™ %',breakout_score:'×¦×™×•×Ÿ ×¤×¨×™×¦×”',breakout_rank:'×“×™×¨×•×’ ×¡×§×× ×¨',breakout_phase:'×¤××–×”',breakout_rr:'×¡×™×›×•×™/×¡×™×›×•×Ÿ',breakout_rs:'×—×•×–×§ ×™×—×¡×™',breakout_stop:'×¡×˜×•×¤ ×œ×•×¡',has_vcp:'×“×¤×•×¡ VCP',vcp_quality:'××™×›×•×ª VCP',breakout_entry:'××™×›×•×ª ×›× ×™×¡×”',vs_sector:'×ž×•×œ ×¡×§×˜×•×¨',coverage:'×›×™×¡×•×™ × ×ª×•× ×™× %',p_profitability:'×¨×•×•×—×™×•×ª',p_growth:'×¦×ž×™×—×”',p_eq:'××™×›×•×ª ×¨×•×•×—',p_fcf:'×ª×–×¨×™×',p_health:'×ž××–×Ÿ',p_momentum:'×ž×•×ž× ×˜×•×',p_analyst:'×× ×œ×™×¡×˜×™×',p_piotroski:'Piotroski',ma_regime:'×¡×™×’× ×œ MA',pct_above_ma200:'% ×ž×¢×œ MA200',p_earn_rev:'×©×™× ×•×™ ×ª×—×–×™×•×ª',p_rs:'×—×•×–×§ ×™×—×¡×™'},tips:{composite:'×ž×ž×•×¦×¢ ×ž×©×•×§×œ×œ ×©×œ 9 ×¤×™×œ×¨×™× (10â€“100). ×¦×™×•×Ÿ ×’×‘×•×” ×™×•×ª×¨ = ××™×›×•×ª ×›×•×œ×œ×ª ×˜×•×‘×” ×™×•×ª×¨ ×ž×©×™×œ×•×‘ ×©×œ ×©×•×•×™, ×¨×•×•×—×™×•×ª, ×¦×ž×™×—×” ×•×ž×•×ž× ×˜×•×.',valuation:'×¢×“ ×›×ž×” ×”×ž× ×™×” ×–×•×œ×” ×‘×™×—×¡ ×œ×¢×ž×™×ª×™×” ×‘×¡×§×˜×•×¨. 100 = ×–×•×œ×” ×ž××•×“, 0 = ×™×§×¨×” ×ž××•×“. ×ž×‘×•×¡×¡ ×¢×œ × ×™×ª×•×— ×™×—×¡×™ ×ž×¨×•×‘×™×.',smartscore:'×¦×™×•×Ÿ ×—×›× ×©×œ TipRanks ×‘×¡×§×œ×” 1â€“10: ××’×¨×’×¦×™×” ×©×œ ×“×™×¨×•×’×™ ×× ×œ×™×¡×˜×™×, ×¡× ×˜×™×ž× ×˜ ×—×“×©×•×ª, ×ž×¡×—×¨ ×¤× ×™× ×•×¤×¢×™×œ×•×ª ×§×¨× ×•×ª ×’×™×“×•×¨.',pe:'×ž×—×™×¨ ×ž× ×™×” ×—×œ×§×™ ×¨×•×•×— ×œ×ž× ×™×” (12 ×—×•×“×©×™× ××—×¨×•× ×™×). × ×ž×•×š ×™×•×ª×¨ = ×¤×•×˜× ×¦×™××œ×™×ª ×–×•×œ ×™×•×ª×¨ ×‘×™×—×¡ ×œ×¨×•×•×—×™×.',fwd_pe:'P/E ×¢×ª×™×“×™ ×¢×œ ×‘×¡×™×¡ ×ª×—×–×™×ª ×¨×•×•×— ×œ-12 ×—×•×“×©×™× ×”×‘××™×. ×ž×¡×ª×›×œ ×§×“×™×ž×” ×™×•×ª×¨ ×ž×”-P/E ×”×¨×’×™×œ.',peg:'×™×—×¡ PEG = P/E ×—×œ×§×™ ×¦×ž×™×—×ª EPS. ×ž×ª×—×ª ×œ-1 = ×¤×•×˜× ×¦×™××œ×™×ª ×–×•×œ ×‘×™×—×¡ ×œ×§×¦×‘ ×”×¦×ž×™×—×”.',ps:'×ž×—×™×¨ ×—×œ×§×™ ×ž×›×™×¨×•×ª ×œ×ž× ×™×”. ×©×™×ž×•×©×™ ×œ×—×‘×¨×•×ª ×¦×ž×™×—×” ×©×¢×“×™×™×Ÿ ×œ× ×¨×•×•×—×™×•×ª.',pb:'×ž×—×™×¨ ×—×œ×§×™ ×¢×¨×š ×¡×¤×¨×™× ×œ×ž× ×™×”. ×ž×ª×—×ª ×œ-1 = × ×¡×—×¨×ª ×ž×ª×—×ª ×œ×©×•×•×™ ×”× ×›×¡×™× × ×˜×•.',ev_ebitda:'×©×•×•×™ ×¤×™×¨×ž×” ×—×œ×§×™ EBITDA. ×ž×“×“ ×ž×¨×›×–×™ ×œ×”×©×•×•××ª ×—×‘×¨×•×ª ×¢× ×ž×‘× ×™ ×”×•×Ÿ ×©×•× ×™×, ×œ×œ× ×¢×™×•×•×ª ×ž×™×ž×•× ×™.',fcf_yield:'×ª×–×¨×™× ×ž×–×•×ž× ×™× ×—×•×¤×©×™ ×—×œ×§×™ ×©×•×•×™ ×©×•×§. ×’×‘×•×” ×™×•×ª×¨ = ×—×‘×¨×” ×ž×™×™×¦×¨×ª ×™×•×ª×¨ ×ž×–×•×ž×Ÿ ×œ×›×œ ×©×§×œ ×ž×•×©×§×¢.',pt_upside:'×™×¢×“ ×ž×—×™×¨ ×§×•× ×¦× ×–×•×¡ ×× ×œ×™×¡×˜×™× ×œ×¢×•×ž×ª ×”×ž×—×™×¨ ×”× ×•×›×—×™. % ×¤×•×˜× ×¦×™××œ ×¢×œ×™×™×” ×œ×¤×™ ×”×¢×¨×›×ª ×× ×œ×™×¡×˜×™×.',div_yield:'×“×™×‘×™×“× ×“ ×©× ×ª×™ ×—×œ×§×™ ×ž×—×™×¨ ×”×ž× ×™×”. ×ª×©×•××ª ×”×›× ×¡×” ×©×•×˜×¤×ª ×¢×œ ×”×”×©×§×¢×”.',pillar_prof:'×¤×™×œ×¨ ×¨×•×•×—×™×•×ª (0â€“100): ×ž×©×§×œ×œ ROE, ROA, ROIC ×•×ž×¨×’×³×™× ×™× × ×˜×•, ×’×•×œ×ž×™ ×•×ª×¤×¢×•×œ×™.',p_profitability:'×¤×™×œ×¨ ×¨×•×•×—×™×•×ª (0â€“100): ×ž×©×§×œ×œ ROE, ROA, ROIC ×•×ž×¨×’×³×™× ×™× × ×˜×•, ×’×•×œ×ž×™ ×•×ª×¤×¢×•×œ×™.',roe:'×ª×©×•××” ×¢×œ ×”×”×•×Ÿ ×”×¢×¦×ž×™: ×¨×•×•×— × ×§×™ ×—×œ×§×™ ×”×•×Ÿ ×¢×¦×ž×™. ×ž×•×“×“ ×¢×“ ×›×ž×” ×”×—×‘×¨×” ×ž× ×¦×œ×ª ××ª ×›×¡×£ ×‘×¢×œ×™ ×”×ž× ×™×•×ª.',roa:'×ª×©×•××” ×¢×œ ×”× ×›×¡×™×: ×¨×•×•×— × ×§×™ ×—×œ×§×™ ×¡×š ×”× ×›×¡×™×. ×™×¢×™×œ×•×ª ×›×œ×œ ×”× ×›×¡×™× ×‘×™×™×¦×•×¨ ×¨×•×•×—.',roic:'×ª×©×•××” ×¢×œ ×”×”×•×Ÿ ×”×ž×•×©×§×¢ (NOPAT / ×”×•×Ÿ ×ž×•×©×§×¢). ×”×ž×“×“ ×”×˜×•×‘ ×‘×™×•×ª×¨ ×œ××™×›×•×ª ×”×§×¦××ª ×”×•×Ÿ.',net_margin:'×¨×•×•×— × ×§×™ ×—×œ×§×™ ×”×›× ×¡×•×ª. ×›×ž×” ××’×•×¨×•×ª ×ž×›×œ ×©×§×œ ×”×›× ×¡×” ×”×•×¤×›×•×ª ×œ×¨×•×•×— × ×˜×•.',gross_margin:'(×”×›× ×¡×•×ª ×¤×—×•×ª ×¢×œ×•×ª ×ž×›×¨) ×—×œ×§×™ ×”×›× ×¡×•×ª. ×™×¢×™×œ×•×ª ×”×¤×¢×™×œ×•×ª ×”×‘×¡×™×¡×™×ª ×œ×¤× ×™ ×”×•×¦××•×ª ×ª×¤×¢×•×œ.',op_margin:'×¨×•×•×— ×ª×¤×¢×•×œ×™ ×—×œ×§×™ ×”×›× ×¡×•×ª. ×™×¢×™×œ×•×ª ×œ×¤× ×™ ×¨×™×‘×™×ª ×•×ž×¡×™×.',eq_score:'×¦×™×•×Ÿ ××™×›×•×ª ×¨×•×•×—×™×: ×‘×•×“×§ ×”×× ×”×¨×•×•×—×™× ×”×ž×“×•×•×—×™× ×ž×’×•×‘×™× ×‘×ª×–×¨×™× ×ž×–×•×ž× ×™× ××ž×™×ª×™. ×’×‘×•×” ×™×•×ª×¨ = ×¨×•×•×—×™× ××ž×™× ×™× ×™×•×ª×¨.',piotroski_f:'Piotroski F-Score (0â€“9): 9 ××™× ×“×™×§×˜×•×¨×™× ×‘×™× ××¨×™×™× ×œ×‘×¨×™××•×ª ×¤×™× × ×¡×™×ª. â‰¥7 = ×—×–×§, â‰¤2 = ×—×œ×©. ×ž× ×‘× ×ª×©×•××•×ª ×ž× ×™×•×ª.',pillar_growth:'×¤×™×œ×¨ ×¦×ž×™×—×” (0â€“100): ×ž×©×§×œ×œ ×¦×ž×™×—×ª ×”×›× ×¡×•×ª, ×¦×ž×™×—×ª EPS, ×”×ž×¨×ª ×¨×•×•×— ×œ×ª×–×¨×™×, ×¦×ž×™×—×ª × ×›×¡×™× ×•×©×™× ×•×™ ×ª×—×–×™×•×ª ×× ×œ×™×¡×˜×™×.',p_growth:'×¤×™×œ×¨ ×¦×ž×™×—×” (0â€“100): ×ž×©×§×œ×œ ×¦×ž×™×—×ª ×”×›× ×¡×•×ª, ×¦×ž×™×—×ª EPS, ×”×ž×¨×ª ×¨×•×•×— ×œ×ª×–×¨×™×, ×¦×ž×™×—×ª × ×›×¡×™× ×•×©×™× ×•×™ ×ª×—×–×™×•×ª ×× ×œ×™×¡×˜×™×.',rev_growth:'×¦×ž×™×—×ª ×”×›× ×¡×•×ª ×©× ×” ×¢×œ ×©× ×”. ×ž×“×“ ×ž×¨×›×–×™ ×œ×ª× ×•×¤×ª ×”×¤×¢×™×œ×•×ª.',eps_growth:'×¦×ž×™×—×ª ×¨×•×•×— ×œ×ž× ×™×” (EPS) ×©× ×” ×¢×œ ×©× ×”. ×ž×•×“×“ ×”×ª×¨×—×‘×•×ª ×”×¨×•×•×—.',fcf_margin:'×ª×–×¨×™× ×ž×–×•×ž× ×™× ×—×•×¤×©×™ ×—×œ×§×™ ×”×›× ×¡×•×ª. ×›×ž×” ×ž×”×›× ×¡×•×ª ×ž×•×ž×¨×•×ª ×œ×ª×–×¨×™× ×—×•×¤×©×™.',tr_asset_gr:'×§×¦×‘ ×¦×ž×™×—×ª ×¡×š ×”× ×›×¡×™×. ×¦×ž×™×—×” ×ž×”×™×¨×” ×ž×“×™ ×¢×œ×•×œ×” ×œ×“×œ×œ ×ª×©×•××•×ª ×•×œ×¨×ž×– ×¢×œ ×—×©×‘×•× ××•×ª ××’×¨×¡×™×‘×™×ª.',earn_rev:'×¦×™×•×Ÿ ×©×™× ×•×™ ×ª×—×–×™×•×ª ×¨×•×•×— (0â€“5): ×ž×•×“×“ ×©×™× ×•×™×™ ×ª×—×–×™×•×ª EPS ×©×œ ×× ×œ×™×¡×˜×™×. ×ž×©×œ×‘ ×¨×•×—×‘ (×›×ž×” ×× ×œ×™×¡×˜×™× ×”×¢×œ×•/×”×•×¨×™×“×• ×‘-30 ×™×•×) ×•×¢×•×¦×ž×” (% ×©×™× ×•×™ ×‘×ª×—×–×™×ª EPS ×”×§×•× ×¦× ×–×•×¡×™×ª ×‘-90 ×™×•×). ×ž×‘×•×¡×¡ ×¢×œ ×ž×—×§×¨ Zacks â€” ××—×“ ×”×’×•×¨×ž×™× ×”×—×–×§×™× ×‘×™×•×ª×¨ ×œ××œ×¤× ×‘×˜×•×•×— ×§×¦×¨.',eps_rev_90d:'% ×©×™× ×•×™ ×‘×ª×—×–×™×ª EPS ×§×•× ×¦× ×–×•×¡ ×‘-90 ×”×™×ž×™× ×”××—×¨×•× ×™×. ×—×™×•×‘×™ = ×× ×œ×™×¡×˜×™× ×ž×¢×œ×™× ×ª×—×–×™×•×ª, ×©×œ×™×œ×™ = ×ž×•×¨×™×“×™×.',pillar_fcf:'×¤×™×œ×¨ FCF (0â€“100): ×ž×•×“×“ ×ª×©×•××ª FCF, ×ž×¨×’×³×™×Ÿ FCF, ×™×—×¡ FCF ×œ×¨×•×•×— × ×§×™, ×•×™×¦×™×‘×•×ª ×“×™×‘×™×“× ×“.',p_fcf:'×¤×™×œ×¨ ×ª×–×¨×™× (Free Cash Flow) (0â€“100): ×ž×•×“×“ ×ª×©×•××ª FCF, ×ž×¨×’×³×™×Ÿ FCF, ×™×—×¡ FCF ×œ×¨×•×•×— × ×§×™, ×•×™×¦×™×‘×•×ª ×“×™×‘×™×“× ×“.',fcf_to_ni:'FCF ×—×œ×§×™ ×¨×•×•×— × ×§×™. ×ž×¢×œ 1 = ×¨×•×•×—×™× ×ž×’×•×‘×™× ×”×™×˜×‘ ×‘×ž×–×•×ž×Ÿ ××ž×™×ª×™. ×ž×ª×—×ª ×œ-0.5 = ××™×›×•×ª ×¨×•×•×—×™× × ×ž×•×›×”.',payout_ratio:'×“×™×‘×™×“× ×“×™× ×©×©×•×œ×ž×• ×—×œ×§×™ ×¨×•×•×— × ×§×™. ×™×—×¡ ×’×‘×•×” ×ž×“×™ ×ž×’×‘×™×œ ×”×©×§×¢×” ×—×•×–×¨×ª; ×ž×¢×œ 100% â€” ×‘×œ×ª×™ ×‘×¨-×§×™×™×ž×.',pillar_health:'×¤×™×œ×¨ ×ž××–×Ÿ (0â€“100): ×ž×©×œ×‘ ×™×—×¡ ×©×•×˜×£, ×—×•×‘/×”×•×Ÿ ×•×‘×˜× (××•×ª ×ª× ×•×“×ª×™×•×ª × ×ž×•×›×”).',p_health:'×¤×™×œ×¨ ×ž××–×Ÿ (Balance Sheet) (0â€“100): ×ž×©×œ×‘ ×™×—×¡ ×©×•×˜×£, ×—×•×‘/×”×•×Ÿ ×•×‘×˜× (××•×ª ×ª× ×•×“×ª×™×•×ª × ×ž×•×›×”).',current_ratio:'× ×›×¡×™× ×©×•×˜×¤×™× ×—×œ×§×™ ×”×ª×—×™×™×‘×•×™×•×ª ×©×•×˜×¤×•×ª. ×ž×¢×œ 1.5 = × ×–×™×œ×•×ª ×‘×¨×™××” ×œ×˜×•×•×— ×§×¦×¨.',debt_equity:'×—×•×‘ ×›×•×œ×œ ×—×œ×§×™ ×”×•×Ÿ ×¢×¦×ž×™. ×’×‘×•×” ×™×•×ª×¨ = ×ž×ž×•× ×£ ×™×•×ª×¨. ×”×¡×‘×™×¨×•×ª ×ž×©×ª× ×” ×‘×™×Ÿ ×¢× ×¤×™×.',altman_z:'Altman Z-Score ×ž× ×‘× ×¡×™×›×•×Ÿ ×¤×©×™×˜×ª ×¨×’×œ. ×ž×¢×œ 3 = ×‘×˜×•×—, 1.8â€“3 = ××–×•×¨ ××¤×•×¨, ×ž×ª×—×ª ×œ-1.8 = ×ž×¦×•×§×”.',beta:'×ª× ×•×“×ª×™×•×ª ×ž×—×™×¨ ×”×ž× ×™×” ×‘×™×—×¡ ×œ-S&P 500. ×ž×¢×œ 1 = ×ª× ×•×¢×•×ª ×ž×•×’×‘×¨×•×ª (×™×•×ª×¨ ×¡×™×›×•×Ÿ ×•×ª×©×•××” ×¤×•×˜× ×¦×™××œ×™×ª). ×ž×ª×—×ª ×œ-1 = ×™×¦×™×‘ ×™×•×ª×¨.',pillar_mom:'×¤×™×œ×¨ ×ž×•×ž× ×˜×•× (0â€“100): ×ž×©×§×œ×œ ×ª×©×•××•×ª 12/6/3/1 ×—×•×“×©×™× ×‘×™×—×¡ ×œ×¢×ž×™×ª×™ ×”×¡×§×˜×•×¨.',p_momentum:'×¤×™×œ×¨ ×ž×•×ž× ×˜×•× (0â€“100): ×ž×©×§×œ×œ ×ª×©×•××•×ª 12/6/3/1 ×—×•×“×©×™× ×‘×™×—×¡ ×œ×¢×ž×™×ª×™ ×”×¡×§×˜×•×¨.',perf_12m:'×ª×©×•××ª ×ž×—×™×¨ ×œ-12 ×—×•×“×©×™×. ×”×’×•×¨× ×”×ž× ×‘× ×”×˜×•×‘ ×‘×™×•×ª×¨ ×‘×”×©×§×¢×” ×ž×‘×•×¡×¡×ª ×ž×•×ž× ×˜×•×.',perf_6m:'×ª×©×•××ª ×ž×—×™×¨ ×œ-6 ×—×•×“×©×™×. ××•×ª ×ž×•×ž× ×˜×•× ×—×–×§ ×œ×˜×•×•×— ×‘×™× ×•× ×™.',perf_3m:'×ª×©×•××ª ×ž×—×™×¨ ×œ-3 ×—×•×“×©×™×. ××™×©×•×¨ ×ž×’×ž×” ×œ×˜×•×•×— ×§×¦×¨-×‘×™× ×•× ×™.',perf_1m:'×ª×©×•××ª ×ž×—×™×¨ ×œ-1 ×—×•×“×©. ×ž×•×ž× ×˜×•× ×§×¦×¨ ×ž×•×¢×“; ×©×™× ×œ×‘ ×œ×¡×™×›×•×Ÿ ×—×–×¨×” ×œ×ž×ž×•×¦×¢.',momentum:'×ž×•×ž× ×˜×•× ×ž×©×•×§×œ×œ: ×ž×ž×•×¦×¢ ×ª×©×•××•×ª 12M/6M/3M/1M ×¢× ×ž×©×§×œ ×’×‘×•×” ×™×•×ª×¨ ×œ-12 ×—×•×“×©×™×.',tr_mom_12m:'×¦×™×•×Ÿ ×ž×•×ž× ×˜×•× ×˜×›× ×™ ×©×œ TipRanks ×œ×˜×•×•×— 12 ×—×•×“×©×™×, ×ž×‘×•×¡×¡ ×¢×œ × ×™×ª×•×— ×ž×’×ž×ª ×ž×—×™×¨.',pillar_analyst:'×¤×™×œ×¨ ×× ×œ×™×¡×˜×™× (0â€“100): ×ž×©×§×œ×œ ×“×™×¨×•×’ ×× ×œ×™×¡×˜×™×, ×ž×¡×¤×¨ ×× ×œ×™×¡×˜×™×, ×¤×•×˜× ×¦×™××œ ×™×¢×“ ×ž×—×™×¨ ×•×§×•× ×¦× ×–×•×¡ TipRanks.',p_analyst:'×¤×™×œ×¨ ×× ×œ×™×¡×˜×™× (0â€“100): ×ž×©×§×œ×œ ×“×™×¨×•×’ ×× ×œ×™×¡×˜×™×, ×ž×¡×¤×¨ ×× ×œ×™×¡×˜×™×, ×¤×•×˜× ×¦×™××œ ×™×¢×“ ×ž×—×™×¨ ×•×§×•× ×¦× ×–×•×¡ TipRanks.',analyst_mean:'×“×™×¨×•×’ ×ž×ž×•×¦×¢ ×©×œ Yahoo Finance. 1=×§× ×™×™×” ×—×–×§×”, 2=×§× ×™×™×”, 3=×”×—×–×§×”, 4=×ž×›×™×¨×”, 5=×ž×›×™×¨×” ×—×–×§×”.',analysts:'×ž×¡×¤×¨ ×× ×œ×™×¡×˜×™× ×©×œ ×•×•×œ ×¡×˜×¨×™×˜ ×”×ž×›×¡×™× ××ª ×”×ž× ×™×”. ×™×•×ª×¨ ×× ×œ×™×¡×˜×™× = ×§×•× ×¦× ×–×•×¡ ××ž×™×Ÿ ×™×•×ª×¨.',tr_consensus:'×§×•× ×¦× ×–×•×¡ ×× ×œ×™×¡×˜×™ TipRanks: ×§× ×™×™×” ×—×–×§×” / ×§× ×™×™×” ×ž×ª×•× ×” / ×”×—×–×§×” / ×ž×›×™×¨×”.',consensus:'×§×•× ×¦× ×–×•×¡ ×× ×œ×™×¡×˜×™ TipRanks: ×§× ×™×™×” ×—×–×§×” / ×§× ×™×™×” ×ž×ª×•× ×” / ×”×—×–×§×” / ×ž×›×™×¨×”.',tr_pt_upside:'×™×¢×“ ×ž×—×™×¨ ×ž×¦×¨×¤×™ ×©×œ TipRanks â€” % ×¢×œ×™×™×” ×¤×•×˜× ×¦×™××œ×™×ª ×ž×”×ž×—×™×¨ ×”× ×•×›×—×™.',tr_smartscore:'×¦×™×•×Ÿ ×—×›× ×©×œ TipRanks 1â€“10: ××’×¨×’×¦×™×” ×©×œ × ×™×ª×•×— ×× ×œ×™×¡×˜×™×, ×—×“×©×•×ª, ×ž×¡×—×¨ ×¤× ×™× ×•×¤×¢×™×œ×•×ª ×ž×•×¡×“×™×ª.',tr_news_bull:'% ×ž×›×ª×‘×•×ª ×”×—×“×©×•×ª ×”××—×¨×•× ×•×ª ×¢× ×¡× ×˜×™×ž× ×˜ ×—×™×•×‘×™ ×œ×¤×™ × ×™×ª×•×— TipRanks.',tr_blogger_bull:'% ×ž×”×‘×œ×•×’×¨×™× ×”×¤×™× × ×¡×™×™× ×¢× ×ª×—×–×™×ª ×—×™×•×‘×™×ª ×œ×¤×™ TipRanks.',tr_insider:'×›×™×•×•×Ÿ ×ž×¡×—×¨ ×¤× ×™×: ×—×™×•×‘×™ = ×§× ×™×•×ª × ×˜×• ××—×¨×•× ×•×ª ×©×œ ×‘×¢×œ×™ ×¢× ×™×™×Ÿ, ×©×œ×™×œ×™ = ×ž×›×™×¨×•×ª × ×˜×•.',tr_hedge:'×ž×’×ž×ª ×¤×¢×™×œ×•×ª ×§×¨× ×•×ª ×’×™×“×•×¨: ×”×× ×ž×•×¡×“×™×™× ×ž×’×“×™×œ×™× ××• ×ž×§×˜×™× ×™× ×¤×•×–×™×¦×™×•×ª?',tr_inv_chg_30d:'% ×©×™× ×•×™ ×‘×”×—×–×§×•×ª ×ž×©×§×™×¢×™× ×ž×•×¡×“×™×™× (×§×¨× ×•×ª ×’×™×“×•×¨) ×‘-30 ×”×™×ž×™× ×”××—×¨×•× ×™×.',tr_inv_chg_7d:'% ×©×™× ×•×™ ×‘×”×—×–×§×•×ª ×ž×©×§×™×¢×™× ×ž×•×¡×“×™×™× (×§×¨× ×•×ª ×’×™×“×•×¨) ×‘-7 ×”×™×ž×™× ×”××—×¨×•× ×™×.',breakout_score:'×¦×™×•×Ÿ ×¤×¨×™×¦×” (0â€“110): ×¦×™×•×Ÿ Trend Template ×©×œ ×ž×™× ×¨×‘×™× ×™. ×ž×•×“×“ ×—×•×–×§ Stage 2, ×—×•×–×§ ×™×—×¡×™, × ×¤×— ×•×¤× ×“×ž× ×˜×œ×¡.',breakout_rank:'×“×™×¨×•×’ ×‘×™×Ÿ ×›×œ ×ž×•×¢×ž×“×™ ×”×¤×¨×™×¦×” ×‘-S&P 500 ×ž×¨×™×¦×ª ×”×¡×§× ×¨ ×”××—×¨×•× ×”.',breakout_phase:'×©×œ×‘ ×©×•×§ ×œ×¤×™ ×ž×™× ×¨×‘×™× ×™. 1=×‘×¡×™×¡ (×¦×‘×™×¨×”), 2=×¢×œ×™×™×” (×–×•×Ÿ ×§× ×™×™×”), 3=×—×œ×•×§×” (×–×”×™×¨×•×ª), 4=×™×¨×™×“×” (×”×™×ž× ×¢).',breakout_rr:'×™×—×¡ ×¡×™×›×•×™/×¡×™×›×•×Ÿ ×œ×™×¢×“ ×ž×—×™×¨ ×× ×œ×™×¡×˜×™× ×¢× ×¡×˜×•×¤ ×œ×•×¡ ×ž×‘×•×¡×¡ ATR. ×ž×™× ×™×ž×•× 2:1 × ×“×¨×©. ×’×‘×•×” ×™×•×ª×¨ = ×¡×˜××¤ ×˜×•×‘ ×™×•×ª×¨.',breakout_rs:'×—×•×–×§ ×™×—×¡×™ ×ž×•×œ SPY ×‘-63 ×™×•×. ×ž×¢×œ 1 = ×ž×•×‘×™×œ ××ª ×”×©×•×§. ×¤×™×œ×˜×¨ ×ž×¤×ª×— ×©×œ ×ž×™× ×¨×‘×™× ×™.',breakout_stop:'×ž×—×™×¨ ×¡×˜×•×¤ ×œ×•×¡ ×ž×—×•×©×‘ ×œ×¤×™ ATR. ×”×¡×™×›×•×Ÿ ×ž×•×’×‘×œ ×œ×›-8â€“10% ×ž× ×§×•×“×ª ×”×›× ×™×¡×”. ×’×•×“×œ ×¤×•×–×™×¦×™×” ×‘×”×ª××.',has_vcp:'VCP = Volatility Contraction Pattern (×ž×™× ×¨×‘×™× ×™). ×¡×“×¨×ª ×”×ª×›×•×•×¦×•×™×•×ª ×ž×—×™×¨ ×”×“×•×§×•×ª ×™×•×ª×¨ ×•×™×•×ª×¨ = ×¦×‘×™×¨×” ×ž×•×¡×“×™×ª.',vcp_quality:'×¦×™×•×Ÿ ××™×›×•×ª VCP (0â€“100). ×’×‘×•×” ×™×•×ª×¨ = ×”×ª×›×•×•×¦×•×™×•×ª ×”×“×•×§×•×ª ×•×ž×¡×•×“×¨×•×ª ×™×•×ª×¨, ×¡×˜××¤ ×˜×•×‘ ×™×•×ª×¨.',breakout_entry:'×”×¢×¨×›×ª ××™×›×•×ª ×”×›× ×™×¡×”: Ideal = ×‘×¡×™×¡ ×”×“×•×§ ×œ×™×“ ×©×™× 52 ×©×‘×•×¢×•×ª, Good = ×¡×˜××¤ ×ž×•×¦×§, OK = ×’×‘×•×œ×™.',p_eq:'×¤×™×œ×¨ ××™×›×•×ª ×¨×•×•×—×™× (0â€“100): ×ž×•×“×“ ××ž×™× ×•×ª ×•×™×¦×™×‘×•×ª ×”×¨×•×•×—×™× ×”×ž×“×•×•×—×™× ×‘×™×—×¡ ×œ×ª×–×¨×™× ×”×ž×–×•×ž× ×™×.',p_piotroski:'×¤×™×œ×¨ Piotroski (0â€“100): × ×’×–×¨ ×ž×¦×™×•×Ÿ ×”×‘×¨×™××•×ª ×”×¤×™× × ×¡×™×ª ×”×‘×™× ××¨×™ ×‘-9 × ×§×•×“×•×ª.',vs_sector:'×¦×™×•×Ÿ ×§×•×ž×¤×•×–×™×˜ ×¤×—×•×ª ×”×—×¦×™×•×Ÿ ×©×œ ×”×¡×§×˜×•×¨ â€” ×›×ž×” ×”×ž× ×™×” ×ž×•×‘×™×œ×” ××ª ×¢×ž×™×ª×™×” ×‘×¡×§×˜×•×¨.',coverage:'×©×œ×ž×•×ª × ×ª×•× ×™×: % ×ž-17 ×”×ž×“×“×™× ×”×¤×™× × ×¡×™×™× ×”×‘×¡×™×¡×™×™× ×©×–×ž×™× ×™× ×ž×ž×§×•×¨×•×ª ×”× ×ª×•× ×™×. ×ž×ª×—×ª ×œ-70% = × ×ª×•× ×™× ×—×œ×§×™×™×.',ma_regime:'×¡×™×’× ×œ ×ž×ž×•×¦×¢ × ×¢ (0â€“2.5): ×ž×¦×™×™×Ÿ ××ª ×ž×™×§×•× ×”×ž× ×™×” ×‘×™×—×¡ ×œ×ž×ž×•×¦×¢ × ×¢ 200 ×¢×•×œ×”. 2.0 = × ×§×•×“×ª ×ž×ª×•×§ (0-5% ×ž×¢×œ MA200 ×¢×•×œ×”). 0 = ×ž×ª×—×ª ×œ-MA200 ××• ×ž×ª×•×— ×ž×“×™ (25%+ ×ž×¢×œ).',pct_above_ma200:'×ž×—×™×¨ × ×•×›×—×™ ×ž×•×œ ×ž×ž×•×¦×¢ × ×¢ 200. ×—×™×•×‘×™ = × ×¡×—×¨ ×ž×¢×œ, ×©×œ×™×œ×™ = ×ž×ª×—×ª. × ×§×•×“×ª ×ž×ª×•×§: 0â€“15% ×ž×¢×œ MA200 ×¢×•×œ×”.',p_earn_rev:'×¤×™×œ×¨ ×©×™× ×•×™ ×ª×—×–×™×•×ª (0â€“100): ×ž×•×“×“ ×¤×¢×™×œ×•×ª ×©×™× ×•×™ ×ª×—×–×™×•×ª EPS ×©×œ ×× ×œ×™×¡×˜×™×. ×ž×©×œ×‘ ×¨×•×—×‘ (×”×¢×œ××•×ª ×ž×•×œ ×”×•×¨×“×•×ª), ×¢×•×¦×ž×” (% ×©×™× ×•×™ EPS), ×•×”××¦×” ××—×¨×•× ×”. ×¤×™×œ×¨ ×¢×¦×ž××™ â€” ×”×’×•×¨× ×”×—×–×§ ×‘×™×•×ª×¨ ×œ××œ×¤× ×‘×˜×•×•×— ×§×¦×¨.',p_rs:'×¤×™×œ×¨ ×—×•×–×§ ×™×—×¡×™ (0â€“100): ×ž×•×“×“ ×ª×©×•××” ×¢×•×“×¤×ª ×ž×•×œ S&P 500 ×¢×œ ×¤× ×™ 12M/6M/3M. ×’×‘×•×” = ×ž×•×‘×™×œ ××ª ×”×©×•×§ ×‘××•×¤×Ÿ ×¢×§×‘×™.',short_ratio:'Short Ratio = ×™×ž×™× ×œ×›×™×¡×•×™ ×›×œ ×¤×•×–×™×¦×™×•×ª ×”×©×•×¨×˜ ×‘× ×¤×— ×ž×ž×•×¦×¢. ×’×‘×•×” (>5) = ×©×•×¨×˜ ×¦×¤×•×£, ×¤×•×˜× ×¦×™××œ ×œ×¡×§×•×•×™×–. × ×ž×•×š (<2) = ×¢× ×™×™×Ÿ ×©×•×¨×˜ ×ž×™× ×™×ž×œ×™.'},detailLabels:{Price:'×ž×—×™×¨',MktCap:'×©×•×•×™ ×©×•×§',AltmanZ:'Altman Z',PiotroskiF:'Piotroski F',DivYield:'×ª×©×•××ª ×“×™×‘.',vsSector:'×ž×•×œ ×¡×§×˜×•×¨',Beta:'×‘×˜×',Analysts:'×× ×œ×™×¡×˜×™×',SmartScore:'×¦×™×•×Ÿ ×—×›×',Consensus:'×§×•× ×¦× ×–×•×¡ TR',TRUpside:'×™×¢×“ TR',Coverage:'×›×™×¡×•×™'},sectors:{'Information Technology':'×˜×›× ×•×œ×•×’×™×”','Health Care':'×‘×¨×™××•×ª','Financials':'×¤×™× × ×¡×™×','Consumer Discretionary':'×¦×¨×™×›×” ×ž×—×–×•×¨×™×ª','Communication Services':'×ª×§×©×•×¨×ª','Industrials':'×ª×¢×©×™×™×”','Consumer Staples':'×¦×¨×™×›×” ×‘×¡×™×¡×™×ª','Energy':'×× ×¨×’×™×”','Real Estate':'× ×“×œ"×Ÿ','Materials':'×—×•×ž×¨×™×','Utilities':'×ª×©×ª×™×•×ª'},pillarNames:{VALUATION:'×©×•×•×™',PROFITAB:'×¨×•×•×—×™×•×ª',GROWTH:'×¦×ž×™×—×”',EARN_REV:'×©×™× ×•×™ ×ª×—×–×™×•×ª',EQ_QUAL:'××™×›×•×ª ×¨×•×•×—',FCF:'×ª×–×¨×™×',HEALTH:'×ž××–×Ÿ',MOMENTUM:'×ž×•×ž× ×˜×•×',REL_STR:'×—×•×–×§ ×™×—×¡×™',ANALYST:'×× ×œ×™×¡×˜×™×'}}};

let lang='en';
function setLang(l){lang=l;document.body.classList.toggle('rtl',l==='he');document.getElementById('btnEn').classList.toggle('active',l==='en');document.getElementById('btnHe').classList.toggle('active',l==='he');applyI18n();if(allData.length)renderTable();}
function tl(k){return(T[lang]||T.en)[k]||(T.en)[k]||k;}
function tc(k){return((T[lang]||T.en).cols||T.en.cols)[k]||(T.en.cols)[k]||k;}
function tt(k){return((T[lang]||T.en).tips||T.en.tips)[k]||(T.en.tips)[k]||'';}
function ttab(k){return((T[lang]||T.en).tabs||T.en.tabs)[k]||(T.en.tabs)[k]||k;}
function tdtab(k){return((T[lang]||T.en).dtabs||T.en.dtabs)[k]||(T.en.dtabs)[k]||k;}
function tpillar(k){return((T[lang]||T.en).pillarNames||T.en.pillarNames)[k]||(T.en.pillarNames)[k]||k;}
function applyI18n(){const ids={'lbl-ranked':'ranked','lbl-avg':'avg','lbl-topsec':'topsec','lbl-ss8':'ss8','lbl-tr':'tr','lbl-stocks':'stocks','lbl-f-composite':'fcomposite','lbl-f-ss':'fss','lbl-f-consensus':'fconsensus','lbl-f-pe':'fpe','lbl-f-perf':'fperf','lbl-f-valuation':'fval','lbl-f-reset':'reset','lbl-filters':'filters','loadingText':'loading'};Object.entries(ids).forEach(([id,key])=>{const el=document.getElementById(id);if(el)el.textContent=tl(key);});document.getElementById('search').placeholder=tl('searchph');buildSectorSelect();buildViewTabs();if(allData.length)updateTopSector();}

const SECTOR_COLORS={'Information Technology':{bg:'#0d2137',color:'#4fc3f7'},'Health Care':{bg:'#0d2118',color:'#69f0ae'},'Financials':{bg:'#1a1a0d',color:'#fff176'},'Consumer Discretionary':{bg:'#1a100d',color:'#ffab91'},'Communication Services':{bg:'#150d1a',color:'#ce93d8'},'Industrials':{bg:'#0d1a1a',color:'#80deea'},'Consumer Staples':{bg:'#1a160d',color:'#ffcc80'},'Energy':{bg:'#1a0d0d',color:'#ef9a9a'},'Real Estate':{bg:'#0d1a13',color:'#a5d6a7'},'Materials':{bg:'#0d1318',color:'#90caf9'},'Utilities':{bg:'#120d1a',color:'#b39ddb'}};

function buildViews(){return{
score:[{key:'composite',lk:'composite',tk:'composite',fmt:scoreBar},{key:'valuation',lk:'valuation',tk:'valuation',fmt:v=>n(v,1),cls:valCls},{key:'p_profitability',lk:'p_profitability',tk:'p_profitability',fmt:v=>n(v,1),cls:scoreCls},{key:'p_growth',lk:'p_growth',tk:'p_growth',fmt:v=>n(v,1),cls:scoreCls},{key:'p_fcf',lk:'p_fcf',tk:'p_fcf',fmt:v=>n(v,1),cls:scoreCls},{key:'p_health',lk:'p_health',tk:'p_health',fmt:v=>n(v,1),cls:scoreCls},{key:'p_momentum',lk:'p_momentum',tk:'p_momentum',fmt:v=>n(v,1),cls:scoreCls},{key:'p_analyst',lk:'p_analyst',tk:'p_analyst',fmt:v=>n(v,1),cls:scoreCls},{key:'p_earn_rev',lk:'p_earn_rev',tk:'p_earn_rev',fmt:v=>n(v,1),cls:scoreCls},{key:'p_rs',lk:'p_rs',tk:'p_rs',fmt:v=>n(v,1),cls:scoreCls},{key:'p_eq',lk:'p_eq',tk:'p_eq',fmt:v=>n(v,1),cls:scoreCls},{key:'ma_regime',lk:'ma_regime',tk:'ma_regime',fmt:v=>n(v,1),cls:v=>{const x=parseFloat(v);return isNaN(x)?'neutral':x>=1.5?'positive':x>=0.5?'neutral':'negative'}},{key:'tr_smartscore',lk:'smartscore',tk:'smartscore',fmt:ssBadge},{key:'coverage',lk:'coverage',tk:'coverage',fmt:v=>n(v,0,'%'),cls:'neutral'},{key:'vs_sector',lk:'vs_sector',tk:'vs_sector',fmt:v=>n(v,1),cls:signCls}],
valuation:[{key:'valuation',lk:'valuation',tk:'valuation',fmt:v=>n(v,1),cls:valCls},{key:'pe',lk:'pe',tk:'pe',fmt:v=>n(v,1),cls:'neutral'},{key:'fwd_pe',lk:'fwd_pe',tk:'fwd_pe',fmt:v=>n(v,1),cls:'neutral'},{key:'peg',lk:'peg',tk:'peg',fmt:v=>n(v,2),cls:'neutral'},{key:'ps',lk:'ps',tk:'ps',fmt:v=>n(v,2),cls:'neutral'},{key:'pb',lk:'pb',tk:'pb',fmt:v=>n(v,2),cls:'neutral'},{key:'ev_ebitda',lk:'ev_ebitda',tk:'ev_ebitda',fmt:v=>n(v,1),cls:'neutral'},{key:'fcf_yield',lk:'fcf_yield',tk:'fcf_yield',fmt:v=>n(v,1,'%'),cls:signCls},{key:'pt_upside',lk:'pt_upside',tk:'pt_upside',fmt:v=>n(v,1,'%'),cls:signCls},{key:'div_yield',lk:'div_yield',tk:'div_yield',fmt:v=>n(v,2,'%'),cls:'neutral'}],
profitability:[{key:'p_profitability',lk:'pillar_prof',tk:'composite',fmt:v=>n(v,1),cls:scoreCls},{key:'roe',lk:'roe',tk:'roe',fmt:v=>n(v,1,'%'),cls:pctDistCls('roe')},{key:'roa',lk:'roa',tk:'roa',fmt:v=>n(v,1,'%'),cls:pctDistCls('roa')},{key:'roic',lk:'roic',tk:'roic',fmt:v=>n(v,1,'%'),cls:pctDistCls('roic')},{key:'net_margin',lk:'net_margin',tk:'net_margin',fmt:v=>n(v,1,'%'),cls:pctDistCls('net_margin')},{key:'gross_margin',lk:'gross_margin',tk:'gross_margin',fmt:v=>n(v,1,'%'),cls:pctDistCls('gross_margin')},{key:'op_margin',lk:'op_margin',tk:'op_margin',fmt:v=>n(v,1,'%'),cls:pctDistCls('op_margin')},{key:'eq_score',lk:'eq_score',tk:'eq_score',fmt:v=>n(v,1),cls:'neutral'},{key:'piotroski_f',lk:'piotroski_f',tk:'piotroski_f',fmt:v=>n(v,0),cls:'neutral'}],
growth:[{key:'p_growth',lk:'pillar_growth',tk:'composite',fmt:v=>n(v,1),cls:scoreCls},{key:'rev_growth',lk:'rev_growth',tk:'rev_growth',fmt:v=>n(v,1,'%'),cls:pctDistCls('rev_growth')},{key:'eps_growth',lk:'eps_growth',tk:'eps_growth',fmt:v=>n(v,1,'%'),cls:pctDistCls('eps_growth')},{key:'earn_rev_score',lk:'earn_rev',tk:'earn_rev',fmt:v=>n(v,1),cls:v=>{const x=parseFloat(v);return isNaN(x)?'neutral':x>=3.5?'positive':x>=2?'neutral':'negative'}},{key:'eps_rev_90d',lk:'eps_rev_90d',tk:'eps_rev_90d',fmt:v=>n(v,1,'%'),cls:signCls},{key:'fcf_margin',lk:'fcf_margin',tk:'fcf_margin',fmt:v=>n(v,1,'%'),cls:pctDistCls('fcf_margin')},{key:'tr_asset_gr',lk:'tr_asset_gr',tk:'tr_asset_gr',fmt:v=>n(v,1,'%'),cls:pctDistCls('tr_asset_gr')}],
cashflow:[{key:'p_fcf',lk:'pillar_fcf',tk:'composite',fmt:v=>n(v,1),cls:scoreCls},{key:'fcf_yield',lk:'fcf_yield',tk:'fcf_yield',fmt:v=>n(v,1,'%'),cls:signCls},{key:'fcf_margin',lk:'fcf_margin',tk:'fcf_margin',fmt:v=>n(v,1,'%'),cls:signCls},{key:'fcf_to_ni',lk:'fcf_to_ni',tk:'fcf_to_ni',fmt:v=>n(v,2),cls:'neutral'},{key:'div_yield',lk:'div_yield',tk:'div_yield',fmt:v=>n(v,2,'%'),cls:'neutral'},{key:'payout_ratio',lk:'payout_ratio',tk:'payout_ratio',fmt:v=>n(v,1,'%'),cls:'neutral'}],
health:[{key:'p_health',lk:'pillar_health',tk:'composite',fmt:v=>n(v,1),cls:scoreCls},{key:'current_ratio',lk:'current_ratio',tk:'current_ratio',fmt:v=>n(v,2),cls:'neutral'},{key:'debt_equity',lk:'debt_equity',tk:'debt_equity',fmt:v=>n(v,2),cls:'neutral'},{key:'piotroski_f',lk:'piotroski_f',tk:'piotroski_f',fmt:v=>n(v,0),cls:'neutral'},{key:'beta',lk:'beta',tk:'beta',fmt:v=>n(v,2),cls:'neutral'}],
momentum:[{key:'p_momentum',lk:'pillar_mom',tk:'composite',fmt:v=>n(v,1),cls:scoreCls},{key:'perf_12m',lk:'perf_12m',tk:'perf_12m',fmt:v=>n(v,1,'%'),cls:pctDistCls('perf_12m')},{key:'perf_6m',lk:'perf_6m',tk:'perf_6m',fmt:v=>n(v,1,'%'),cls:pctDistCls('perf_6m')},{key:'perf_3m',lk:'perf_3m',tk:'perf_3m',fmt:v=>n(v,1,'%'),cls:pctDistCls('perf_3m')},{key:'perf_1m',lk:'perf_1m',tk:'perf_1m',fmt:v=>n(v,1,'%'),cls:signCls},{key:'momentum',lk:'momentum',tk:'momentum',fmt:v=>n(v,1,'%'),cls:pctDistCls('momentum')},{key:'ma_regime',lk:'ma_regime',tk:'ma_regime',fmt:v=>n(v,1),cls:v=>{const x=parseFloat(v);return isNaN(x)?'neutral':x>=1.5?'positive':x>=0.5?'neutral':'negative'}},{key:'pct_above_ma200',lk:'pct_above_ma200',tk:'pct_above_ma200',fmt:v=>n(v,1,'%'),cls:signCls},{key:'short_ratio',lk:'short_ratio',tk:'short_ratio',fmt:v=>n(v,1),cls:'neutral'},{key:'beta',lk:'beta',tk:'beta',fmt:v=>n(v,2),cls:'neutral'},{key:'tr_mom_12m',lk:'tr_mom_12m',tk:'tr_mom_12m',fmt:v=>n(v,1,'%'),cls:signCls}],
analyst:[{key:'p_analyst',lk:'pillar_analyst',tk:'composite',fmt:v=>n(v,1),cls:scoreCls},{key:'analyst_mean',lk:'analyst_mean',tk:'analyst_mean',fmt:v=>n(v,2),cls:'neutral'},{key:'analysts',lk:'analysts',tk:'analysts',fmt:v=>n(v,0),cls:'neutral'},{key:'pt_upside',lk:'pt_upside',tk:'pt_upside',fmt:v=>n(v,1,'%'),cls:signCls},{key:'tr_consensus',lk:'tr_consensus',tk:'consensus',fmt:consensusFmt},{key:'tr_pt_upside',lk:'tr_pt_upside',tk:'tr_pt_upside',fmt:v=>n(v,1,'%'),cls:signCls}],
breakout:[{key:'breakout_score',lk:'breakout_score',tk:'breakout_score',fmt:v=>breakoutScoreBadge(v)},{key:'breakout_rank',lk:'breakout_rank',tk:'breakout_rank',fmt:v=>n(v,0),cls:'neutral'},{key:'breakout_phase',lk:'breakout_phase',tk:'breakout_phase',fmt:v=>phaseBadge(v)},{key:'breakout_rr',lk:'breakout_rr',tk:'breakout_rr',fmt:v=>n(v,1,'x'),cls:'neutral'},{key:'breakout_rs',lk:'breakout_rs',tk:'breakout_rs',fmt:v=>n(v,3),cls:rsCls},{key:'breakout_stop',lk:'breakout_stop',tk:'breakout_stop',fmt:v=>valid(v)?'$'+parseFloat(v).toFixed(2):'â€”',cls:'neutral'},{key:'has_vcp',lk:'has_vcp',tk:'has_vcp',fmt:v=>v?'<span style="color:var(--gold);font-weight:700">âœ¦ VCP</span>':'â€”'},{key:'vcp_quality',lk:'vcp_quality',tk:'vcp_quality',fmt:v=>n(v,0),cls:'neutral'},{key:'breakout_entry',lk:'breakout_entry',tk:'breakout_entry',fmt:v=>v||'â€”'}],
tipranks:[{key:'tr_smartscore',lk:'tr_smartscore',tk:'smartscore',fmt:ssBadge},{key:'tr_consensus',lk:'tr_consensus',tk:'consensus',fmt:consensusFmt},{key:'tr_pt_upside',lk:'tr_pt_upside',tk:'tr_pt_upside',fmt:v=>n(v,1,'%'),cls:signCls},{key:'tr_news_bull',lk:'tr_news_bull',tk:'tr_news_bull',fmt:v=>n(v,0,'%'),cls:'neutral'},{key:'tr_blogger_bull',lk:'tr_blogger_bull',tk:'tr_blogger_bull',fmt:v=>n(v,0,'%'),cls:'neutral'},{key:'tr_insider',lk:'tr_insider',tk:'tr_insider',fmt:v=>v||'â€”'},{key:'tr_hedge',lk:'tr_hedge',tk:'tr_hedge',fmt:v=>v||'â€”'},{key:'tr_inv_chg_30d',lk:'tr_inv_chg_30d',tk:'tr_inv_chg_30d',fmt:v=>n(v,1,'%'),cls:signCls},{key:'tr_inv_chg_7d',lk:'tr_inv_chg_7d',tk:'tr_inv_chg_7d',fmt:v=>n(v,1,'%'),cls:signCls}],
watchlist:[{key:'composite',lk:'composite',tk:'composite',fmt:scoreBar},{key:'valuation',lk:'valuation',tk:'valuation',fmt:v=>n(v,1),cls:valCls},{key:'tr_smartscore',lk:'smartscore',tk:'smartscore',fmt:ssBadge},{key:'perf_12m',lk:'perf_12m',tk:'perf_12m',fmt:v=>n(v,1,'%'),cls:pctDistCls('perf_12m')},{key:'vs_sector',lk:'vs_sector',tk:'vs_sector',fmt:v=>n(v,1),cls:signCls},{key:'pe',lk:'pe',tk:'pe',fmt:v=>n(v,1),cls:'neutral'}],
};}

function breakoutScoreBadge(v){if(!valid(v))return'<span style="color:var(--text4)">â€”</span>';const f=parseFloat(v);const c=f>=100?'#ffd700':f>=90?'var(--teal)':f>=75?'var(--gold)':'var(--text2)';return`<span style="color:${c};font-family:var(--mono);font-weight:800;font-size:13px">${f.toFixed(1)}</span>`;}
function phaseBadge(v){if(!valid(v))return'<span style="color:var(--text4)">â€”</span>';const colors={1:'#ffd600',2:'var(--teal)',3:'var(--orange)',4:'var(--red)'};const labels={1:'Base',2:'Uptrend',3:'Top',4:'Down'};const c=colors[v]||'var(--text2)';return`<span style="color:${c};font-weight:700">P${v} <span style="font-size:10px;opacity:.7">${labels[v]||''}</span></span>`;}
function rsCls(v){if(!valid(v))return'neutral';return parseFloat(v)>=1?'pos':parseFloat(v)>=0.9?'mid':'neg';}
function n(v,dec=1,suf=''){if(v===null||v===undefined||isNaN(Number(v)))return'<span style="color:var(--text4)">â€”</span>';return parseFloat(v).toFixed(dec)+suf;}
function valid(v){return v!==null&&v!==undefined&&!isNaN(Number(v))&&v!=='';}
function signCls(v){if(!valid(v))return'neutral';return parseFloat(v)>0?'pos':parseFloat(v)<0?'neg':'neutral';}
function scoreCls(v){if(!valid(v))return'neutral';return parseFloat(v)>=65?'pos':parseFloat(v)>=40?'neutral':'neg';}
function valCls(v){if(!valid(v))return'neutral';return parseFloat(v)>=60?'pos':parseFloat(v)<=30?'neg':'neutral';}
function altmanCls(v){if(!valid(v))return'neutral';return parseFloat(v)>=3?'pos':parseFloat(v)>=1.8?'neutral':'neg';}

let _fieldP={};
function buildPercentiles(data){const keys=['roe','roa','roic','net_margin','gross_margin','op_margin','rev_growth','eps_growth','fcf_margin','tr_asset_gr','perf_12m','perf_6m','perf_3m','perf_1m','momentum'];keys.forEach(k=>{const vals=data.map(d=>d[k]).filter(v=>valid(v)).map(Number).sort((a,b)=>a-b);if(!vals.length){_fieldP[k]={p25:0,p50:0,p75:0};return;}const p=pct=>vals[Math.floor(pct*(vals.length-1))];_fieldP[k]={p25:p(.25),p50:p(.5),p75:p(.75)};});}
function pctDistCls(field){return v=>{if(!valid(v))return'neutral';const p=_fieldP[field];if(!p)return signCls(v);const f=parseFloat(v);if(f>=p.p75)return'pos';if(f>=p.p50)return'hi';if(f>=p.p25)return'mid';return'neg';};}

function scoreColor(v){if(!valid(v))return'var(--text4)';const f=parseFloat(v);if(f>=70)return'var(--teal)';if(f>=55)return'var(--gold)';if(f>=40)return'var(--orange)';return'var(--red)';}
function pillarColor(v){if(!valid(v))return'var(--text4)';const f=parseFloat(v);if(f>=65)return'var(--teal)';if(f>=45)return'var(--gold)';return'var(--red)';}
function ssColorFn(v){if(!v)return{bg:'#1e2e42',color:'var(--text3)'};if(v>=8)return{bg:'#0d3320',color:'#00e676'};if(v>=6)return{bg:'#1a2e0d',color:'#76ff03'};if(v>=4)return{bg:'#2e2400',color:'#ffd600'};return{bg:'#2e0d0d',color:'#ff5252'};}
function scoreBar(v){const c=scoreColor(v);const num=valid(v)?parseFloat(v).toFixed(1):'â€”';return`<div class="score-cell"><span class="score-num" style="color:${c}">${num}</span><div class="score-bar-bg"><div class="score-bar-fill" style="width:${valid(v)?parseFloat(v):0}%;background:${c}"></div></div></div>`;}
function ssBadge(v){const c=ssColorFn(v);return`<span class="ss-badge" style="background:${c.bg};color:${c.color}">${v||'â€”'}</span>`;}
function consensusFmt(v){if(!v)return'<span style="color:var(--text4)">â€”</span>';const c=v==='StrongBuy'?'#00e676':v.includes('Buy')?'#69f0ae':v==='Hold'?'#ffd600':'#ff5252';return`<span style="color:${c};font-size:12px;font-weight:600">${v.replace('Moderate','Mod ').replace('Strong','Str. ')}</span>`;}

let allData=[],currentSector='ALL',currentSearch='',currentView='score',sortCol='rank',sortAsc=true;
let breakoutMeta=null,breakoutTopSignals=[];

async function loadData(){
  try{
    const [r1,r2]=await Promise.all([
      fetch(makeUrl("sp500_data.json")),
      fetch(makeUrl("breakout_signals.json")).catch(()=>null)
    ]);
    if(!r1.ok)throw new Error(`HTTP ${r1.status}`);
    const json=await r1.json();
    allData=json.data;
    document.getElementById('lastUpdated').innerHTML=`<span class="live-dot"></span>${json.generated||''}`;
    checkDataFreshness(json.generated);
    // Load breakout signals metadata
    if(r2&&r2.ok){
      const bj=await r2.json();
      breakoutMeta=bj;
      breakoutTopSignals=bj.top_signals||[];
      // Enrich allData with top signals data (in case not merged)
      breakoutTopSignals.forEach(sig=>{
        const stock=allData.find(d=>d.ticker===sig.ticker);
        if(stock&&!valid(stock.breakout_score)){
          stock.breakout_score=sig.breakout_score;
          stock.breakout_rank=sig.rank;
          stock.breakout_phase=sig.phase;
          stock.breakout_entry=sig.entry_quality;
          stock.breakout_rr=sig.risk_reward;
          stock.breakout_rs=sig.rs;
          stock.breakout_stop=sig.stop_loss;
          stock.has_vcp=sig.has_vcp;
          stock.vcp_quality=sig.vcp_quality;
          stock._breakout_reasons=sig.reasons||[];
        }
      });
    }
    buildPercentiles(allData);
    init();
  }catch(e){
    document.getElementById('loading').style.display='none';
    document.getElementById('error-msg').style.display='block';
  }
}

function updateTopSector(){const secMap={};allData.forEach(d=>{if(!secMap[d.sector])secMap[d.sector]=[];secMap[d.sector].push(d.composite||0);});const topSec=Object.entries(secMap).map(([s,v])=>[s,v.reduce((a,b)=>a+b,0)/v.length]).sort((a,b)=>b[1]-a[1])[0][0];const topMap=(T[lang]||T.en).topSectors||T.en.topSectors;document.getElementById('statTopSector').textContent=topMap[topSec]||topSec;}

function init(){
  document.getElementById('loading').style.display='none';
  document.getElementById('statsBar').style.display='grid';
  document.getElementById('controls').style.display='flex';
  document.getElementById('viewTabs').style.display='flex';
  document.getElementById('tableWrap').style.display='block';
  const nn=allData.length;
  const avg=(allData.reduce((a,b)=>a+(b.composite||0),0)/nn).toFixed(1);
  const ss8=allData.filter(d=>d.tr_smartscore>=8).length;
  const trCov=allData.filter(d=>d.tr_smartscore).length;
  document.getElementById('statTotal').textContent=nn;
  document.getElementById('statAvg').textContent=avg;
  document.getElementById('statSS8').textContent=ss8;
  document.getElementById('statTR').textContent=Math.round(trCov/nn*100)+'%';
  updateTopSector();buildSectorSelect();buildViewTabs();
  document.getElementById('btnExport').style.display='inline-flex';
  document.getElementById('btnCompareMode').style.display='inline-flex';
  document.getElementById('search').addEventListener('input',e=>{currentSearch=e.target.value.toLowerCase();renderTable();});
  ['fCompMin','fCompMax','fSSMin','fConsensus','fPEMax','fPerfMin','fValMin'].forEach(id=>{const el=document.getElementById(id);if(el){el.addEventListener('change',renderTable);el.addEventListener('input',renderTable);}});
  renderTable();
}

function onSectorChange(val){currentSector=val;renderTable();}
function buildSectorSelect(){
  const sel=document.getElementById('sectorSelect');
  const prev=currentSector||'ALL';
  sel.innerHTML='';
  const allOpt=document.createElement('option');allOpt.value='ALL';allOpt.textContent=tl('allsectors');sel.appendChild(allOpt);
  const sMap=(T[lang]||T.en).sectors||T.en.sectors;
  Object.keys(SECTOR_COLORS).filter(s=>allData.some(d=>d.sector===s)).forEach(s=>{
    const opt=document.createElement('option');opt.value=s;opt.textContent=lang==='he'?(sMap[s]||s):s;sel.appendChild(opt);
  });
  sel.value=prev;
}

function buildViewTabs(){const c=document.getElementById('viewTabs');c.innerHTML='';const bCount=allData.filter(d=>valid(d.breakout_score)).length;const bTotal=breakoutMeta?breakoutMeta.total_buy_signals:null;const wCount=watchlist.size;Object.keys(buildViews()).forEach(view=>{const btn=document.createElement('button');btn.className='view-tab'+(view===currentView?' active':'');if(view==='breakout'){const num=bTotal||bCount;btn.innerHTML=`${ttab(view)} <span style="background:var(--teal);color:#000;font-size:9px;font-weight:900;padding:1px 6px;border-radius:8px;margin-left:3px">${num}</span>`;}else if(view==='watchlist'&&wCount>0){btn.innerHTML=`${ttab(view)} <span style="background:var(--gold);color:#000;font-size:9px;font-weight:900;padding:1px 6px;border-radius:8px;margin-left:3px">${wCount}</span>`;}else{btn.textContent=ttab(view);}btn.dataset.view=view;btn.addEventListener('click',()=>{document.querySelectorAll('.view-tab').forEach(t=>t.classList.remove('active'));btn.classList.add('active');currentView=view;sortCol='rank';sortAsc=true;renderTable();});c.appendChild(btn);});}

function toggleFilter(){const panel=document.getElementById('filterPanel'),btn=document.getElementById('filterToggle');const open=panel.classList.toggle('open');btn.classList.toggle('open',open);}
function resetFilters(){['fCompMin','fCompMax','fSSMin','fConsensus','fPEMax','fPerfMin','fValMin'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});const mc=document.getElementById('fMktCap');if(mc)mc.value='10000000000';renderTable();}
function getFilters(){return{compMin:parseFloat(document.getElementById('fCompMin').value)||null,compMax:parseFloat(document.getElementById('fCompMax').value)||null,ssMin:parseFloat(document.getElementById('fSSMin').value)||null,consensus:document.getElementById('fConsensus').value||null,peMax:parseFloat(document.getElementById('fPEMax').value)||null,perfMin:parseFloat(document.getElementById('fPerfMin').value)||null,valMin:parseFloat(document.getElementById('fValMin').value)||null,mktCapMin:parseFloat(document.getElementById('fMktCap').value)||null};}

function applyFilter(){let data=[...allData];const f=getFilters();if(currentSector!=='ALL')data=data.filter(d=>d.sector===currentSector);if(currentSearch){const q=currentSearch.toUpperCase();const exactTicker=data.find(d=>d.ticker===q);if(exactTicker){data=[exactTicker];}else{data=data.filter(d=>d.ticker.startsWith(q)||(d.company||'').toLowerCase().includes(currentSearch));}}if(f.compMin!==null)data=data.filter(d=>(d.composite||0)>=f.compMin);if(f.compMax!==null)data=data.filter(d=>(d.composite||0)<=f.compMax);if(f.ssMin!==null)data=data.filter(d=>(d.tr_smartscore||0)>=f.ssMin);if(f.consensus)data=data.filter(d=>(d.tr_consensus||'')===f.consensus||(d.tr_consensus||'').includes(f.consensus.replace('Buy','').trim()));if(f.peMax!==null)data=data.filter(d=>valid(d.pe)&&parseFloat(d.pe)<=f.peMax);if(f.perfMin!==null)data=data.filter(d=>valid(d.perf_12m)&&parseFloat(d.perf_12m)>=f.perfMin);if(f.valMin!==null)data=data.filter(d=>(d.valuation||0)>=f.valMin);
if(f.mktCapMin!==null)data=data.filter(d=>d.market_cap&&d.market_cap>=f.mktCapMin);
  // Breakout tab: only stocks with a real breakout score
  if(currentView==='breakout')data=data.filter(d=>valid(d.breakout_score));
  // Watchlist tab: only starred stocks
  if(currentView==='watchlist')data=data.filter(d=>watchlist.has(d.ticker));
  // Default sort for breakout = breakout_score descending
  const effCol=(currentView==='breakout'&&sortCol==='rank')?'breakout_score':sortCol;
  const effAsc=(currentView==='breakout'&&sortCol==='rank')?false:sortAsc;
  data.sort((a,b)=>{let av=a[effCol],bv=b[effCol];if(typeof av==='string')return effAsc?(av||'').localeCompare(bv||''):(bv||'').localeCompare(av||'');if(!valid(av))return 1;if(!valid(bv))return-1;return effAsc?parseFloat(av)-parseFloat(bv):parseFloat(bv)-parseFloat(av);});
  return data;
}

function renderTable(){
  const filtered=applyFilter();
  document.getElementById('showCount').innerHTML=`<span>${filtered.length}</span>`;
  const VIEWS=buildViews(),cols=VIEWS[currentView];
  const thead=document.getElementById('tableHead');
  const mkth=(lk,col,w,tkOv)=>{const sorted=sortCol===col?(' sorted'+(sortAsc?' asc':'')):'';const tip=tt(tkOv||lk)||'';return`<th class="${sorted} col-${w}" data-col="${col}"><div class="th-wrap">${tc(lk)}<span class="th-tip">${tip}</span></div></th>`;};
  let hRow='<tr>'+mkth('rank','rank','rank')+mkth('ticker','ticker','ticker')+mkth('company','company','company')+mkth('sector','sector','sector');
  cols.forEach(c=>{const sorted=sortCol===c.key?(' sorted'+(sortAsc?' asc':'')):'';const tip=tt(c.tk)||'';hRow+=`<th class="${sorted} col-data" data-col="${c.key}"><div class="th-wrap">${tc(c.lk)}<span class="th-tip">${tip}</span></div></th>`;});
  hRow+='</tr>';thead.innerHTML=hRow;
  thead.querySelectorAll('th[data-col]').forEach(th=>{
    th.addEventListener('mouseenter',()=>{const tip=th.querySelector('.th-tip');if(!tip)return;const rect=th.getBoundingClientRect();tip.style.top=Math.max(8,rect.top-tip.offsetHeight-8)+'px';tip.style.left=Math.min(rect.left+rect.width/2-115,window.innerWidth-240)+'px';});
    th.addEventListener('click',()=>{const col=th.dataset.col;if(sortCol===col)sortAsc=!sortAsc;else{sortCol=col;sortAsc=['rank','ticker','company','sector'].includes(col);}renderTable();});
  });
  // Breakout tab regime banner
  const tbody=document.getElementById('tableBody');tbody.innerHTML='';
  if(currentView==='breakout'&&breakoutMeta){
    const regime=breakoutMeta.market_regime||'';
    const isRiskOn=regime.toUpperCase().includes('RISK-ON');
    const regimeClass=isRiskOn?'regime-risk-on':'regime-risk-off';
    const bannerRow=document.createElement('tr');
    bannerRow.innerHTML=`<td colspan="99" style="padding:12px 8px 4px">
      <div class="regime-banner">
        <div><div class="regime-label">Market Regime</div><div class="regime-value ${regimeClass}">${regime||'â€”'}</div></div>
        <div class="regime-divider"></div>
        <div><div class="regime-label">Total BUY Signals</div><div class="regime-value" style="color:var(--teal)">${breakoutMeta.total_buy_signals||0}</div></div>
        <div class="regime-divider"></div>
        <div><div class="regime-label">Phase 2 Stocks</div><div class="regime-value">${breakoutMeta.phase2_pct||0}%</div></div>
        <div class="regime-divider"></div>
        <div><div class="regime-label">Scanner Date</div><div class="regime-value" style="font-size:11px">${breakoutMeta.scan_date||'â€”'}</div></div>
        <div style="margin-left:auto;font-size:11px;color:var(--text3)">Showing top signals merged into S&P 500 data Â· ${breakoutMeta.total_buy_signals||0} total signals detected</div>
      </div>
    </td>`;
    tbody.appendChild(bannerRow);
  }
  filtered.forEach(d=>{
    const sc=SECTOR_COLORS[d.sector]||{bg:'#1a1a1a',color:'#999'};
    const sMap=(T[lang]||T.en).sectors||T.en.sectors;
    const sLabel=lang==='he'?(sMap[d.sector]||d.sector):(d.sector||'');
    const isBreakout=valid(d.breakout_score);
    const doubleSignal=isBreakout&&(d.composite||0)>=65;
    const dsBadge=doubleSignal?'<span class="ds-badge" title="Double Signal: Breakout + High Composite">âš¡</span>':'';
    const isStarred=watchlist.has(d.ticker);
    const starBtn=`<button class="star-btn ${isStarred?'starred':''}" onclick="toggleStar('${d.ticker}',event)" title="Add to watchlist">${isStarred?'â˜…':'â˜†'}</button>`;
    let cells=`<td class="td-rank ${d.rank<=3?'top3':''}">${dsBadge}${d.rank}</td><td class="td-ticker" style="vertical-align:middle"><div style="display:flex;align-items:center">${starBtn}<a href="https://finance.yahoo.com/quote/${d.ticker}" target="_blank" onclick="event.stopPropagation()">${d.ticker}</a></div></td><td class="td-company" title="${d.company||''}">${(d.company||'').substring(0,24)}</td><td><span class="sector-pill" style="background:${sc.bg};color:${sc.color}">${sLabel}</span></td>`;
    cols.forEach(c=>{const raw=d[c.key];const content=c.fmt?c.fmt(raw):(valid(raw)?raw:'â€”');const cls=c.cls?(typeof c.cls==='function'?c.cls(raw):c.cls):'';cells+=`<td class="td-num ${cls}">${content}</td>`;});
    const tr=document.createElement('tr');
    if(doubleSignal)tr.classList.add('double-signal-row');
    else if(isBreakout)tr.classList.add('breakout-only-row');
    if(isStarred)tr.classList.add('watched');
    tr.innerHTML=cells;
    const detailRow=document.createElement('tr');detailRow.className='stock-detail-row';
    detailRow.innerHTML=`<td colspan="99">${buildDetailPanel(d)}</td>`;
    tr.addEventListener('click',()=>{
      if(compareMode){addToCompare(d.ticker);return;}
      const isOpen=detailRow.classList.contains('open');document.querySelectorAll('.stock-detail-row.open').forEach(r=>r.classList.remove('open'));document.querySelectorAll('tr.expanded').forEach(r=>r.classList.remove('expanded'));if(!isOpen){detailRow.classList.add('open');tr.classList.add('expanded');}
    });
    tbody.appendChild(tr);tbody.appendChild(detailRow);
  });
}

function buildDetailPanel(d){
  const sc=SECTOR_COLORS[d.sector]||{bg:'#1a1a1a',color:'#999'};
  const sMap=(T[lang]||T.en).sectors||T.en.sectors;
  const sLabel=lang==='he'?(sMap[d.sector]||d.sector):d.sector;
  const ss=ssColorFn(d.tr_smartscore);
  const DL=(T[lang]||T.en).detailLabels||T.en.detailLabels;
  const isBreakout=valid(d.breakout_score);
  const doubleSignal=isBreakout&&(d.composite||0)>=65;
  const pillarDefs=[['VALUATION',d.p_valuation],['PROFITAB',d.p_profitability],['GROWTH',d.p_growth],['EARN_REV',d.p_earn_rev],['EQ_QUAL',d.p_eq],['FCF',d.p_fcf],['HEALTH',d.p_health],['MOMENTUM',d.p_momentum],['REL_STR',d.p_rs],['ANALYST',d.p_analyst]];
  const pillarGrid=pillarDefs.map(([k,v])=>`<div class="pillar-card"><div class="pillar-card-name">${tpillar(k)}</div><div class="pillar-card-score" style="color:${pillarColor(v)}">${valid(v)?parseFloat(v).toFixed(0):'â€”'}</div><div class="pillar-bar-bg"><div class="pillar-bar-fill" style="width:${valid(v)?parseFloat(v):0}%;background:${pillarColor(v)}"></div></div></div>`).join('');
  const mf=(label,val,cls='',sub='')=>`<div class="metric-card"><div class="metric-label">${label}</div><div class="metric-value ${cls}">${val}</div>${sub?`<div class="metric-sub">${sub}</div>`:''}</div>`;
  const metricsGrid=[mf(DL.Price,valid(d.price)?'$'+parseFloat(d.price).toFixed(2):'â€”','gold'),mf(DL.MktCap,valid(d.market_cap)?'$'+(d.market_cap/1e9).toFixed(1)+'B':'â€”'),mf(DL.DivYield,valid(d.div_yield)?parseFloat(d.div_yield).toFixed(2)+'%':'â€”'),mf(DL.Beta,valid(d.beta)?parseFloat(d.beta).toFixed(2):'â€”'),mf(DL.PiotroskiF,valid(d.piotroski_f)?d.piotroski_f:'â€”','','0â€“9'),mf(DL.Analysts,d.analysts||'â€”'),mf(DL.vsSector,valid(d.vs_sector)?(parseFloat(d.vs_sector)>0?'+':'')+parseFloat(d.vs_sector).toFixed(1):'â€”',signCls(d.vs_sector)),mf(DL.Coverage,valid(d.coverage)?parseFloat(d.coverage).toFixed(0)+'%':'â€”'),mf('ROE %',valid(d.roe)?parseFloat(d.roe).toFixed(1)+'%':'â€”',signCls(d.roe)),mf('Net Margin',valid(d.net_margin)?parseFloat(d.net_margin).toFixed(1)+'%':'â€”',signCls(d.net_margin)),mf('Rev Growth',valid(d.rev_growth)?parseFloat(d.rev_growth).toFixed(1)+'%':'â€”',signCls(d.rev_growth)),mf('Earn Rev',valid(d.earn_rev_score)?parseFloat(d.earn_rev_score).toFixed(1):'â€”',parseFloat(d.earn_rev_score)>=3.5?'positive':parseFloat(d.earn_rev_score)>=2?'':'negative','0â€“5')].join('');
  const valCards=[{l:'P/E',v:d.pe,dec:1},{l:'Fwd P/E',v:d.fwd_pe,dec:1},{l:'P/B',v:d.pb,dec:2},{l:'EV/EBITDA',v:d.ev_ebitda,dec:1},{l:'FCF Yield',v:d.fcf_yield,suf:'%',dec:1}].map(({l,v,dec,suf=''})=>`<div class="val-card"><div class="val-label">${l}</div><div class="val-num ${signCls(v)}">${valid(v)?parseFloat(v).toFixed(dec)+suf:'â€”'}</div></div>`).join('');
  const ptUpside=valid(d.pt_upside)?`<div class="val-card"><div class="val-label">PT Upside</div><div class="val-num ${signCls(d.pt_upside)}">${parseFloat(d.pt_upside).toFixed(1)}%</div></div>`:'';
  const trBull=valid(d.tr_news_bull)?parseFloat(d.tr_news_bull):null;
  const trBlogger=valid(d.tr_blogger_bull)?parseFloat(d.tr_blogger_bull):null;
  const trCard1=`<div class="tr-card"><div class="tr-card-title">SmartScore</div><div class="ss-big" style="background:${ss.bg};color:${ss.color}">${d.tr_smartscore||'â€”'}</div><div class="tr-card-sub">${(d.tr_consensus||'â€”').replace('Moderate','Mod ').replace('Strong','Str. ')}</div></div>`;
  const trCard2=`<div class="tr-card"><div class="tr-card-title">News Sentiment</div><div class="tr-card-main" style="color:${trBull&&trBull>50?'var(--teal)':'var(--red2)'}">${trBull!==null?trBull.toFixed(0)+'%':'â€”'}</div><div class="sentiment-bar"><div class="sentiment-fill" style="width:${trBull||0}%;background:${trBull&&trBull>50?'var(--teal)':'var(--red2)'}"></div></div><div class="tr-card-sub">Bullish news Â· ${trBlogger!==null?trBlogger.toFixed(0)+'%':'â€”'} bloggers</div></div>`;
  const trCard3=`<div class="tr-card"><div class="tr-card-title">Institutional & Insider</div><div class="tr-card-main">${d.tr_insider||'â€”'}</div><div class="tr-card-sub">Insider trading direction</div><div style="margin-top:8px"><div class="tr-card-title">30D Change</div><div class="metric-value ${signCls(d.tr_inv_chg_30d)}" style="font-size:16px">${valid(d.tr_inv_chg_30d)?parseFloat(d.tr_inv_chg_30d).toFixed(1)+'%':'â€”'}</div></div></div>`;
  // Breakout panel
  const reasons=d._breakout_reasons&&d._breakout_reasons.length?`<div style="margin-top:14px"><div style="font-size:10px;font-weight:700;color:var(--text3);letter-spacing:.8px;text-transform:uppercase;margin-bottom:6px">Scanner Reasons</div>${d._breakout_reasons.map(r=>`<div style="font-size:12px;color:var(--text2);padding:3px 0;border-bottom:1px solid var(--border)">âœ“ ${r}</div>`).join('')}</div>`:'';
  const bm=(label,val,cls='')=>`<div class="metric-card"><div class="metric-label">${label}</div><div class="metric-value ${cls}" style="font-size:13px">${val}</div></div>`;
  const dsBanner=doubleSignal?`<div style="display:inline-flex;align-items:center;gap:8px;background:linear-gradient(135deg,#f5a623,#ff6b35);color:#000;font-weight:900;font-size:11px;padding:5px 14px;border-radius:20px;margin-bottom:14px">âš¡ DOUBLE SIGNAL â€” Top Breakout Scanner + High Composite Score</div>`:'';
  const breakoutContent=isBreakout?`${dsBanner}
    <div class="metrics-grid" style="grid-template-columns:repeat(6,1fr)">
      ${bm('Breakout Score',breakoutScoreBadge(d.breakout_score))}
      ${bm('Scan Rank',valid(d.breakout_rank)?'#'+parseInt(d.breakout_rank):'â€”')}
      ${bm('Phase',phaseBadge(d.breakout_phase))}
      ${bm('Risk / Reward',valid(d.breakout_rr)?parseFloat(d.breakout_rr).toFixed(1)+'x':'â€”')}
      ${bm('Rel. Strength',valid(d.breakout_rs)?parseFloat(d.breakout_rs).toFixed(3):'â€”',rsCls(d.breakout_rs))}
      ${bm('Stop Loss',valid(d.breakout_stop)?'$'+parseFloat(d.breakout_stop).toFixed(2):'â€”','neg')}
    </div>
    <div class="metrics-grid" style="grid-template-columns:repeat(4,1fr);margin-top:8px">
      ${bm('VCP Pattern',d.has_vcp?'<span style="color:var(--gold);font-weight:800">âœ¦ YES</span>':'No')}
      ${bm('VCP Quality',valid(d.vcp_quality)?parseFloat(d.vcp_quality).toFixed(0)+'/100':'â€”')}
      ${bm('Entry Quality',d.breakout_entry||'â€”')}
      ${bm('Composite Score',valid(d.composite)?parseFloat(d.composite).toFixed(1):'â€”',scoreCls(d.composite))}
    </div>${reasons}`:
    `<div style="text-align:center;padding:30px;color:var(--text3);font-size:13px">âš¡ No breakout scanner data for this stock<br><span style="font-size:11px;margin-top:6px;display:block">Scanner detects Minervini Stage 2 setups â€” this stock did not qualify in the last run</span></div>`;
  const bkTabStyle=isBreakout?`color:var(--teal);`:'';
  const bkTabBadge=isBreakout?`<span style="background:var(--teal);color:#000;font-size:8px;font-weight:900;padding:1px 5px;border-radius:6px;margin-left:4px">${doubleSignal?'âš¡':'âœ“'}</span>`:'';
  return`<div class="stock-detail-inner">
    <div class="detail-header">
      <div>
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:4px">
          <span class="detail-ticker-big">${d.ticker}</span>
          <span class="detail-pill-sector" style="background:${sc.bg};color:${sc.color}">${sLabel}</span>
          ${doubleSignal?'<span class="ds-badge">âš¡ SIGNAL</span>':''}
        </div>
        <div class="detail-company-name">${d.company||''}</div>
      </div>
      <div style="text-align:right">
        <div class="detail-price">${valid(d.price)?'$'+parseFloat(d.price).toFixed(2):'â€”'}</div>
        <div style="font-size:12px;color:var(--text2);margin-top:2px">Rank #${d.rank} Â· Score ${valid(d.composite)?parseFloat(d.composite).toFixed(1):'â€”'}</div>
        <a href="https://finance.yahoo.com/quote/${d.ticker}" target="_blank" style="font-size:11px;color:var(--teal);text-decoration:none;display:inline-block;margin-top:4px">Open Yahoo Finance â†—</a>
      </div>
    </div>
    <div class="detail-tabs" id="dtabs-${d.ticker}">
      <button class="detail-tab active" data-dtab="overview" onclick="switchDetailTab('${d.ticker}','overview')">Overview</button>
      <button class="detail-tab" data-dtab="pillars" onclick="switchDetailTab('${d.ticker}','pillars')">Pillars</button>
      <button class="detail-tab" data-dtab="valuation" onclick="switchDetailTab('${d.ticker}','valuation')">Valuation</button>
      <button class="detail-tab" data-dtab="tipranks" onclick="switchDetailTab('${d.ticker}','tipranks')">TipRanks</button>
      <button class="detail-tab" data-dtab="breakout" onclick="switchDetailTab('${d.ticker}','breakout')" style="${bkTabStyle}">âš¡ Breakout${bkTabBadge}</button>
    </div>
    <div id="dtab-${d.ticker}-overview"><div class="metrics-grid">${metricsGrid}</div></div>
    <div id="dtab-${d.ticker}-pillars" style="display:none"><div class="pillar-grid">${pillarGrid}</div></div>
    <div id="dtab-${d.ticker}-valuation" style="display:none"><div class="val-grid">${valCards}${ptUpside}</div></div>
    <div id="dtab-${d.ticker}-tipranks" style="display:none"><div class="tr-grid">${trCard1}${trCard2}${trCard3}</div></div>
    <div id="dtab-${d.ticker}-breakout" style="display:none">${breakoutContent}</div>
  </div>`;
}

function switchDetailTab(ticker,tab){const tc=document.getElementById(`dtabs-${ticker}`);if(!tc)return;tc.querySelectorAll('.detail-tab').forEach(t=>{t.classList.toggle('active',t.dataset.dtab===tab);});['overview','pillars','valuation','tipranks','breakout'].forEach(t=>{const el=document.getElementById(`dtab-${ticker}-${t}`);if(el)el.style.display=t===tab?'block':'none';});}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  v5.3: STALE DATA CHECK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkDataFreshness(generatedStr){
  if(!generatedStr)return;
  try{
    const gen=new Date(generatedStr.replace(' UTC','Z'));
    const hours=(Date.now()-gen.getTime())/3600000;
    if(hours>48){
      const banner=document.getElementById('staleBanner');
      const days=Math.floor(hours/24);
      document.getElementById('staleText').textContent=
        lang==='he'?`âš  ×”× ×ª×•× ×™× ×¢×©×•×™×™× ×œ×”×™×•×ª ×ž×™×•×©× ×™×. ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ ×œ×¤× ×™ ${days} ×™×ž×™×.`
        :`âš  Data may be outdated. Last update was ${days} day${days>1?'s':''} ago.`;
      banner.classList.add('show');
    }
  }catch(e){}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  v5.3: WATCHLIST (localStorage)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let watchlist=new Set();
function loadWatchlist(){try{const w=JSON.parse(localStorage.getItem('mozes_watchlist')||'[]');watchlist=new Set(w);}catch(e){watchlist=new Set();}}
function saveWatchlist(){try{localStorage.setItem('mozes_watchlist',JSON.stringify([...watchlist]));}catch(e){}}
function toggleStar(ticker,ev){
  ev.stopPropagation();
  if(watchlist.has(ticker))watchlist.delete(ticker);else watchlist.add(ticker);
  saveWatchlist();renderTable();
}
loadWatchlist();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  v5.3: COMPARE MODE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let compareMode=false, compareList=[];
function toggleCompareMode(){
  compareMode=!compareMode;
  document.getElementById('btnCompareMode').classList.toggle('open',compareMode);
  document.getElementById('compareBar').classList.toggle('show',compareMode);
  if(!compareMode)clearCompare();
}
function addToCompare(ticker){
  if(!compareMode||compareList.length>=4||compareList.includes(ticker))return;
  compareList.push(ticker);
  updateCompareBar();
}
function removeFromCompare(ticker){
  compareList=compareList.filter(t=>t!==ticker);
  updateCompareBar();
}
function clearCompare(){
  compareList=[];
  updateCompareBar();
}
function updateCompareBar(){
  const chips=document.getElementById('compareChips');
  chips.innerHTML=compareList.map(t=>`<span class="compare-chip">${t}<span class="remove" onclick="removeFromCompare('${t}')">Ã—</span></span>`).join('');
  document.getElementById('compareGo').disabled=compareList.length<2;
}
function showCompareModal(){
  if(compareList.length<2)return;
  const stocks=compareList.map(t=>allData.find(d=>d.ticker===t)).filter(Boolean);
  const metrics=[
    {label:'Composite',key:'composite',fmt:v=>n(v,1)},
    {label:'Valuation',key:'valuation',fmt:v=>n(v,1)},
    {label:'SmartScore',key:'tr_smartscore',fmt:v=>n(v,0)},
    {label:'P/E',key:'pe',fmt:v=>n(v,1)},
    {label:'Fwd P/E',key:'fwd_pe',fmt:v=>n(v,1)},
    {label:'ROE %',key:'roe',fmt:v=>n(v,1)},
    {label:'ROIC %',key:'roic',fmt:v=>n(v,1)},
    {label:'Rev Growth %',key:'rev_growth',fmt:v=>n(v,1)},
    {label:'EPS Growth %',key:'eps_growth',fmt:v=>n(v,1)},
    {label:'Earn Rev (0-5)',key:'earn_rev_score',fmt:v=>n(v,1)},
    {label:'FCF Yield %',key:'fcf_yield',fmt:v=>n(v,1)},
    {label:'FCF Margin %',key:'fcf_margin',fmt:v=>n(v,1)},
    {label:'EQ Score',key:'eq_score',fmt:v=>n(v,1)},
    {label:'Debt/Equity',key:'debt_equity',fmt:v=>n(v,1)},
    {label:'Altman Z',key:'altman_z',fmt:v=>n(v,2)},
    {label:'Beta',key:'beta',fmt:v=>n(v,2)},
    {label:'12M Return %',key:'perf_12m',fmt:v=>n(v,1)},
    {label:'MA Regime',key:'ma_regime',fmt:v=>n(v,1)},
    {label:'% Above MA200',key:'pct_above_ma200',fmt:v=>n(v,1)},
    {label:'Short Ratio',key:'short_ratio',fmt:v=>n(v,1)},
    {label:'Insider %MCap',key:'insider_pct_mcap',fmt:v=>n(v,2)},
    {label:'Piotroski F',key:'piotroski_f',fmt:v=>n(v,0)},
    {label:'vs Sector',key:'vs_sector',fmt:v=>n(v,1)},
  ];
  const cols=stocks.length+1;
  let html=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
    <div style="font-size:18px;font-weight:800;color:#fff">âš– Compare ${stocks.length} Stocks</div>
    <button class="compare-close" onclick="document.getElementById('compareModal').classList.remove('show')">âœ•</button>
  </div>`;
  html+=`<div class="compare-grid" style="grid-template-columns:160px repeat(${stocks.length},1fr)">`;
  // Header row
  html+=`<div class="cg-header">Metric</div>`;
  stocks.forEach(s=>{
    const sc=SECTOR_COLORS[s.sector]||{bg:'#1a1a1a',color:'#999'};
    html+=`<div style="text-align:center"><div class="cg-ticker">${s.ticker}</div><div style="font-size:11px;color:var(--text2)">${(s.company||'').substring(0,20)}</div><span class="sector-pill" style="background:${sc.bg};color:${sc.color};font-size:10px;margin-top:4px;display:inline-block">${s.sector}</span></div>`;
  });
  // Metric rows
  metrics.forEach(m=>{
    const vals=stocks.map(s=>({raw:parseFloat(s[m.key]),fmt:m.fmt(s[m.key])}));
    const validVals=vals.filter(v=>!isNaN(v.raw));
    const bestIdx=validVals.length?vals.indexOf(vals.reduce((best,cur)=>{
      // For most metrics, higher is better. Exceptions:
      const lowerBetter=['pe','fwd_pe','debt_equity','beta','short_ratio'].includes(m.key);
      if(isNaN(cur.raw))return best;
      if(isNaN(best.raw))return cur;
      return lowerBetter?(cur.raw<best.raw?cur:best):(cur.raw>best.raw?cur:best);
    })):-1;
    html+=`<div class="cg-header">${m.label}</div>`;
    vals.forEach((v,i)=>{
      const cls=i===bestIdx&&!isNaN(v.raw)?'cg-best':'';
      html+=`<div class="${cls}" style="text-align:center;font-family:var(--mono);font-size:13px">${v.fmt}</div>`;
    });
  });
  html+='</div>';
  document.getElementById('compareInner').innerHTML=html;
  document.getElementById('compareModal').classList.add('show');
}
// Close modal on backdrop click
document.addEventListener('click',e=>{
  const modal=document.getElementById('compareModal');
  if(modal.classList.contains('show')&&e.target===modal)modal.classList.remove('show');
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  v5.3: EXPORT CSV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportCSV(){
  const filtered=applyFilter();
  if(!filtered.length)return;
  const VIEWS=buildViews(),cols=VIEWS[currentView];
  const headers=['Rank','Ticker','Company','Sector',...cols.map(c=>tc(c.lk))];
  const rows=filtered.map(d=>{
    const base=[d.rank,d.ticker,`"${(d.company||'').replace(/"/g,'""')}"`,d.sector];
    cols.forEach(c=>{const raw=d[c.key];base.push(valid(raw)?raw:'');});
    return base.join(',');
  });
  const csv='\uFEFF'+headers.join(',')+'\n'+rows.join('\n');
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;a.download=`sp500_mozes_${currentView}_${new Date().toISOString().slice(0,10)}.csv`;
  a.click();URL.revokeObjectURL(url);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  v5.3: THEME TOGGLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleTheme(){
  const root=document.documentElement;
  const current=root.getAttribute('data-theme')||'dark';
  const next=current==='dark'?'light':'dark';
  root.setAttribute('data-theme',next);
  document.getElementById('btnTheme').textContent=next==='dark'?'â˜€':'ðŸŒ™';
  try{localStorage.setItem('mozes_theme',next);}catch(e){}
}
// Restore saved theme
try{const saved=localStorage.getItem('mozes_theme');if(saved){document.documentElement.setAttribute('data-theme',saved);if(saved==='light')document.getElementById('btnTheme').textContent='ðŸŒ™';}}catch(e){}

loadData();
</script>
</body>
</html>
