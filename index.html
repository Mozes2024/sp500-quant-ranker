<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S&P 500 Mozes Ranker v5.3</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#070c12; --surface:#0c1520; --surface2:#111d2b; --surface3:#162436;
  --border:#1d2e40; --border2:#243a50;
  --gold:#f5a623; --gold2:#ffc15e; --teal:#00d4aa; --red:#ff4757;
  --text:#dce8f4; --text2:#8aaccb; --text3:#4a6a8a;
  --mono:'JetBrains Mono',monospace; --sans:'Inter',sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:var(--sans);min-height:100vh;font-size:15px;}
/* כל ה-CSS שלך נשאר בדיוק כמו שהיה (אני לא משנה אותו כדי שלא יהיו באגים) */
.ss-badge,.breakout-badge{display:inline-flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:8px;font-family:var(--mono);font-size:13px;font-weight:800;}
.breakout-badge.gold{background:#ffd700;color:#000;}
.phase-badge{font-size:11px;padding:2px 6px;border-radius:4px;font-weight:700;}
</style>
</head>
<body>

<!-- כל ה-HTML שלך (header, stats, controls, filter, view-tabs, loading, table-wrap) נשאר בדיוק כמו שהיה -->

<header>
  <div class="logo-block">
    <div class="logo-title">S&amp;P 500 <span class="logo-accent">Mozes</span> Ranker</div>
    <div class="logo-sub">v5.3 · 9-Pillar + Breakout Scanner</div>
  </div>
  <div class="header-right">
    <div class="last-updated" id="lastUpdated"><span class="live-dot"></span>Loading...</div>
  </div>
</header>

<!-- stats-bar, controls, filter-panel, view-tabs, loading, error-msg, table-wrap - הכל כמו שהיה -->

<div class="table-wrap" id="tableWrap" style="display:none">
  <table id="mainTable"><thead id="tableHead"></thead><tbody id="tableBody"></tbody></table>
</div>

<script>
// ====================== I18N + ALL YOUR ORIGINAL CODE ======================
const T = { /* כל ה-T שלך נשאר בדיוק */ };
// ... (כל ה-T, SECTOR_COLORS, formatters ישנים - הכל כמו שהיה) ...

// ====================== NEW FORMATTERS FOR BREAKOUT ======================
function breakoutScoreBadge(v){
  if(!valid(v)) return '<span style="color:var(--text4)">—</span>';
  const f=parseFloat(v);
  const c=f>=95?'#ffd700':f>=85?'var(--teal)':f>=70?'var(--gold)':'var(--text2)';
  return `<span class="breakout-badge" style="background:${c};color:#000">${f.toFixed(1)}</span>`;
}
function phaseBadge(v){
  if(!valid(v)) return '—';
  const colors={1:'#ffd600',2:'#00e676',3:'#ffab40',4:'#ff5252'};
  const labels={1:'Base',2:'Uptrend',3:'Top',4:'Down'};
  return `<span class="phase-badge" style="background:${colors[v]||'#333'};color:#fff">P${v} ${labels[v]||''}</span>`;
}
function rsCls(v){if(!valid(v))return'neutral';return parseFloat(v)>=1.05?'pos':parseFloat(v)>=0.95?'mid':'neg';}

// ====================== BUILD VIEWS - FULL WITH BREAKOUT ======================
function buildViews(){
  return {
    score: [
      {key:'composite', lk:'composite', tk:'composite', fmt:scoreBar},
      {key:'breakout_score', lk:'breakout_score', tk:'breakout_score', fmt:breakoutScoreBadge},
      {key:'valuation', lk:'valuation', tk:'valuation', fmt:v=>n(v,1), cls:valCls},
      {key:'p_profitability', lk:'p_profitability', tk:'p_profitability', fmt:v=>n(v,1), cls:scoreCls},
      {key:'p_growth', lk:'p_growth', tk:'p_growth', fmt:v=>n(v,1), cls:scoreCls},
      {key:'p_fcf', lk:'p_fcf', tk:'p_fcf', fmt:v=>n(v,1), cls:scoreCls},
      {key:'p_health', lk:'p_health', tk:'p_health', fmt:v=>n(v,1), cls:scoreCls},
      {key:'p_momentum', lk:'p_momentum', tk:'p_momentum', fmt:v=>n(v,1), cls:scoreCls},
      {key:'p_analyst', lk:'p_analyst', tk:'p_analyst', fmt:v=>n(v,1), cls:scoreCls},
      {key:'p_piotroski', lk:'p_piotroski', tk:'p_piotroski', fmt:v=>n(v,1), cls:scoreCls},
      {key:'p_eq', lk:'p_eq', tk:'p_eq', fmt:v=>n(v,1), cls:scoreCls},
      {key:'tr_smartscore', lk:'smartscore', tk:'smartscore', fmt:ssBadge},
      {key:'vs_sector', lk:'vs_sector', tk:'vs_sector', fmt:v=>n(v,1), cls:signCls},
    ],
    valuation: [ /* כל העמודות של Valuation כמו שהיו */ ],
    profitability: [ /* כמו שהיו */ ],
    growth: [ /* כמו שהיו */ ],
    cashflow: [ /* כמו שהיו */ ],
    health: [ /* כמו שהיו */ ],
    momentum: [ /* כמו שהיו */ ],
    analyst: [ /* כמו שהיו */ ],
    breakout: [
      {key:'breakout_score', lk:'breakout_score', tk:'breakout_score', fmt:breakoutScoreBadge},
      {key:'breakout_rank', lk:'breakout_rank', tk:'breakout_rank', fmt:v=>n(v,0)},
      {key:'breakout_phase', lk:'breakout_phase', tk:'breakout_phase', fmt:phaseBadge},
      {key:'breakout_rr', lk:'breakout_rr', tk:'breakout_rr', fmt:v=>n(v,1,'x')},
      {key:'breakout_rs', lk:'breakout_rs', tk:'breakout_rs', fmt:v=>n(v,2), cls:rsCls},
      {key:'breakout_stop', lk:'breakout_stop', tk:'breakout_stop', fmt:v=>valid(v)?'$'+n(v,2):'—'},
      {key:'has_vcp', lk:'has_vcp', tk:'has_vcp', fmt:v=>v?'✅ VCP':'—'},
      {key:'vcp_quality', lk:'vcp_quality', tk:'vcp_quality', fmt:v=>n(v,0)},
      {key:'breakout_entry', lk:'breakout_entry', tk:'breakout_entry', fmt:v=>v||'—'},
      {key:'breakout_reasons', lk:'breakout_reasons', tk:'breakout_reasons', fmt:v=>v?v.substring(0,60)+'...':'—'},
    ],
    tipranks: [ /* כמו שהיו */ ]
  };
}

// ====================== DETAIL PANEL עם BREAKOUT CARD ======================
function buildDetailPanel(d){
  // ... כל הקוד הקיים שלך ...
  // בסוף ה-overview הוסף:
  let breakoutHTML = valid(d.breakout_score) ? `
    <div style="margin-top:20px;background:var(--surface);border:2px solid var(--gold);border-radius:12px;padding:18px">
      <div style="color:var(--gold);font-weight:700;font-size:15px;margin-bottom:12px">⚡ BREAKOUT SIGNAL</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:14px">
        <div><b>Score</b><br>${breakoutScoreBadge(d.breakout_score)}</div>
        <div><b>Phase</b><br>${phaseBadge(d.breakout_phase)}</div>
        <div><b>R/R</b><br><span style="color:var(--teal)">${n(d.breakout_rr,1,'x')}</span></div>
        <div><b>RS</b><br><span style="color:${parseFloat(d.breakout_rs||0)>=1?'var(--teal)':'var(--red)'}">${n(d.breakout_rs,2)}</span></div>
        <div><b>Stop</b><br>$${n(d.breakout_stop,2)}</div>
        <div><b>VCP</b><br>${d.has_vcp?'<span style="color:#ffd700">YES</span>':'—'}</div>
        <div><b>Entry</b><br>${d.breakout_entry||'—'}</div>
      </div>
      ${d.breakout_reasons?`<div style="margin-top:12px;font-size:12px;color:var(--text2)">${d.breakout_reasons}</div>`:''}
    </div>` : '';

  // הוסף את breakoutHTML בסוף ה-overview
  return `...${breakoutHTML}...`; // שים אותו במקום המתאים ב-detail
}

// ====================== שאר הקוד שלך (loadData, init, renderTable וכו') ======================
// ... (הכל בדיוק כמו שהיה אצלך) ...

loadData();
</script>
</body>
</html>
